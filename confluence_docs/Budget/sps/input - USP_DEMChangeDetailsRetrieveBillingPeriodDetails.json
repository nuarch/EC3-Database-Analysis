{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "input",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "USP_DEMChangeDetailsRetrieveBillingPeriodDetails",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Low",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "USP_DEMChangeDetailsRetrieveBillingPeriodDetails",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to retrieve billing period details from a view named "
        },
        {
          "type": "text",
          "text": "vwDEMChangeDetails",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " within the "
        },
        {
          "type": "text",
          "text": "input",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " schema. It allows filtering based on either "
        },
        {
          "type": "text",
          "text": "DEMChangeDetailEntityID",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " or "
        },
        {
          "type": "text",
          "text": "DEMChangeID",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", or retrieves all records if neither parameter is specified with a valid ID. The results are ordered by specific columns to ensure consistent output."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Low"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The procedure is straightforward, involving simple conditional logic to determine which records to retrieve based on the input parameters. It performs basic SELECT operations with ORDER BY clauses, without any complex joins, subqueries, or data transformations."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@demChangeDetailEntityId AS INT = -1",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This parameter is used to filter the results by "
                },
                {
                  "type": "text",
                  "text": "DEMChangeDetailEntityID",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". A default value of "
                },
                {
                  "type": "text",
                  "text": "-1",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " indicates that this filter should not be applied unless a valid ID is provided."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@demChangeId AS INT = -1",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This parameter is used to filter the results by "
                },
                {
                  "type": "text",
                  "text": "DEMChangeID",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". Similarly, a default value of "
                },
                {
                  "type": "text",
                  "text": "-1",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " indicates that this filter should not be applied unless a valid ID is provided."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure begins by setting "
                },
                {
                  "type": "text",
                  "text": "NOCOUNT ON",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to prevent the sending of DONE_IN_PROC messages, which can reduce network traffic."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It sets the transaction isolation level to "
                },
                {
                  "type": "text",
                  "text": "READ UNCOMMITTED",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", allowing dirty reads and potentially improving performance by not acquiring shared locks."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure checks the input parameters:"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "If "
                        },
                        {
                          "type": "text",
                          "text": "@demChangeDetailEntityId",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " is greater than "
                        },
                        {
                          "type": "text",
                          "text": "-1",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ", it retrieves records where "
                        },
                        {
                          "type": "text",
                          "text": "DEMChangeDetailEntityID",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " matches the provided ID."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "If "
                        },
                        {
                          "type": "text",
                          "text": "@demChangeDetailEntityId",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " is not specified (i.e., "
                        },
                        {
                          "type": "text",
                          "text": "-1",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": "), but "
                        },
                        {
                          "type": "text",
                          "text": "@demChangeId",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " is greater than "
                        },
                        {
                          "type": "text",
                          "text": "-1",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ", it retrieves records where "
                        },
                        {
                          "type": "text",
                          "text": "DEMChangeID",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " matches the provided ID."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "If neither parameter is specified with a valid ID, it retrieves all records from the view."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The results are ordered by specified columns to ensure a consistent and logical output."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The use of "
                },
                {
                  "type": "text",
                  "text": "READ UNCOMMITTED",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " can improve performance by reducing locking overhead, but it may lead to reading uncommitted or dirty data."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure performs a simple SELECT operation, which is generally efficient, but performance can be impacted by the size of the "
                },
                {
                  "type": "text",
                  "text": "vwDEMChangeDetails",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " view and the presence of indexes on the columns used in the WHERE clause and ORDER BY clause."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The ORDER BY clause can be costly if the dataset is large and the columns are not indexed appropriately."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Using "
                },
                {
                  "type": "text",
                  "text": "READ UNCOMMITTED",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " can lead to reading inconsistent data, which might not be suitable for all business scenarios, especially where data accuracy is critical."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "If the view "
                },
                {
                  "type": "text",
                  "text": "vwDEMChangeDetails",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is complex or involves multiple joins, the performance might degrade, especially if the underlying tables are large."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure does not handle cases where both parameters are provided with valid IDs, which might lead to unexpected results if the calling application does not ensure proper parameter usage."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The default values of "
                },
                {
                  "type": "text",
                  "text": "-1",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " for the parameters assume that valid IDs are always positive integers, which should be validated in the application logic to prevent misuse."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE PROCEDURE [input].[USP_DEMChangeDetailsRetrieveBillingPeriodDetails]\n(\r\n    @demChangeDetailEntityId AS INT = -1,\r\n\t@demChangeId AS INT = -1\r\n)\r\nAS\r\nBEGIN\r\n\tSET NOCOUNT ON;\r\n\tSET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\r\n\r\n\tIF @demChangeDetailEntityId > -1\r\n\tBEGIN\r\n\t\tSELECT [DEMChangeID]\r\n\t\t\t,[DEMChangeDetailEntityID]\r\n\t\t\t,[AgencyCode]\r\n\t\t\t,[BudgetGroupID]\r\n\t\t\t,[DistinctAccountCount]\r\n\t\t\t,[BillingPeriod]\r\n\t\t\t,[DemandUsage]\r\n\t\t\t,[EnergyUsage]\r\n\t\t\t,[EnergyUsagePeakPercentage]\r\n\t\t\t,[EnergyUsagePeak]\r\n\t\t\t,[EnergyUsageOffPeak]\r\n\t\t\t,[EnergyUsageReactivePower]\r\n\t\t\t,[StreetLightingFacilityPoints]\r\n\t\t\t,[Notes]\r\n\t\tFROM [input].[vwDEMChangeDetails]\r\n\t\tWHERE DEMChangeDetailEntityID = @demChangeDetailEntityId\r\n\t\tORDER BY DEMChangeID ASC, AgencyCode ASC, BudgetGroupID ASC, BillingPeriod ASC;\r\n\tEND\r\n\tELSE IF @demChangeId > -1\r\n\tBEGIN\r\n\t\tSELECT [DEMChangeID]\r\n\t\t\t,[DEMChangeDetailEntityID]\r\n\t\t\t,[AgencyCode]\r\n\t\t\t,[BudgetGroupID]\r\n\t\t\t,[DistinctAccountCount]\r\n\t\t\t,[BillingPeriod]\r\n\t\t\t,[DemandUsage]\r\n\t\t\t,[EnergyUsage]\r\n\t\t\t,[EnergyUsagePeakPercentage]\r\n\t\t\t,[EnergyUsagePeak]\r\n\t\t\t,[EnergyUsageOffPeak]\r\n\t\t\t,[EnergyUsageReactivePower]\r\n\t\t\t,[StreetLightingFacilityPoints]\r\n\t\t\t,[Notes]\r\n\t\tFROM [input].[vwDEMChangeDetails]\r\n\t\tWHERE DEMChangeID = @demChangeId\r\n\t\tORDER BY DEMChangeDetailEntityID ASC, AgencyCode ASC, BudgetGroupID ASC, BillingPeriod ASC;\r\n\tEND\r\n\tELSE\r\n\tBEGIN\r\n\t\tSELECT [DEMChangeID]\r\n\t\t\t,[DEMChangeDetailEntityID]\r\n\t\t\t,[AgencyCode]\r\n\t\t\t,[BudgetGroupID]\r\n\t\t\t,[DistinctAccountCount]\r\n\t\t\t,[BillingPeriod]\r\n\t\t\t,[DemandUsage]\r\n\t\t\t,[EnergyUsage]\r\n\t\t\t,[EnergyUsagePeakPercentage]\r\n\t\t\t,[EnergyUsagePeak]\r\n\t\t\t,[EnergyUsageOffPeak]\r\n\t\t\t,[EnergyUsageReactivePower]\r\n\t\t\t,[StreetLightingFacilityPoints]\r\n\t\t\t,[Notes]\r\n\t\tFROM [input].[vwDEMChangeDetails]\r\n\t\tORDER BY DEMChangeID ASC, DEMChangeDetailEntityID ASC, AgencyCode ASC, BudgetGroupID ASC, BillingPeriod ASC;\r\n\tEND;\r\nEND;\r"
        }
      ]
    }
  ]
}