{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "ManualBill",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Function Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "DetermineProjectedToOrFromDate",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The "
        },
        {
          "type": "text",
          "text": "DetermineProjectedToOrFromDate",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " function is a scalar function in Microsoft SQL Server. Scalar functions return a single value and are often used to encapsulate logic that can be reused across multiple queries or stored procedures. This function is designed to calculate and return a specific date based on the input parameters provided. The function's purpose is to determine a projected date either \"to\" or \"from\" a given reference date, likely based on business rules or calculations involving time intervals."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level of this function is considered medium. This is due to the potential involvement of date calculations, conditional logic, and possibly multiple operations to determine the correct projected date. The complexity is not high because scalar functions typically involve straightforward logic, but it is not low because date calculations can introduce nuances that require careful handling."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The function accepts the following input parameters:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@ReferenceDate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This parameter represents the base date from which the calculation will be performed. It is likely of the "
                },
                {
                  "type": "text",
                  "text": "DATETIME",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " or "
                },
                {
                  "type": "text",
                  "text": "DATE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " data type."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@Interval",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This parameter specifies the time interval to be added or subtracted from the "
                },
                {
                  "type": "text",
                  "text": "@ReferenceDate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". It could be an integer representing days, months, or another unit of time."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@Direction",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This parameter indicates whether the calculation should project \"to\" or \"from\" the "
                },
                {
                  "type": "text",
                  "text": "@ReferenceDate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". It is likely a string or integer that specifies the direction of the date calculation."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Return Type"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The return type of the function is a "
        },
        {
          "type": "text",
          "text": "DATETIME",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " or "
        },
        {
          "type": "text",
          "text": "DATE",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ". This is because the function's purpose is to return a specific date calculated based on the input parameters. The structure of the return type is a single date value."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The business logic of the function involves:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Receiving the "
                },
                {
                  "type": "text",
                  "text": "@ReferenceDate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", "
                },
                {
                  "type": "text",
                  "text": "@Interval",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", and "
                },
                {
                  "type": "text",
                  "text": "@Direction",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " as inputs."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Evaluating the "
                },
                {
                  "type": "text",
                  "text": "@Direction",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to determine whether to add or subtract the "
                },
                {
                  "type": "text",
                  "text": "@Interval",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " from the "
                },
                {
                  "type": "text",
                  "text": "@ReferenceDate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Performing the date arithmetic to calculate the projected date."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Returning the calculated date as the result."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The workflow involves conditional checks to ensure the correct operation (addition or subtraction) is performed based on the "
        },
        {
          "type": "text",
          "text": "@Direction",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " parameter."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Performance Considerations"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Scalar functions can have performance implications, especially when used in SELECT statements that process large datasets. This is because scalar functions are executed row-by-row, which can lead to slower performance compared to set-based operations. To mitigate this, it is advisable to use scalar functions judiciously and consider alternatives like inline table-valued functions if performance becomes an issue."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Date Calculations",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Incorrect handling of date calculations can lead to inaccurate results, especially around leap years, month-end boundaries, and daylight saving time changes."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Parameter Validation",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The function should include validation for input parameters to ensure they are within expected ranges and formats. For example, "
                },
                {
                  "type": "text",
                  "text": "@Direction",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " should be validated to ensure it only accepts valid values."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Performance",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": As mentioned, scalar functions can impact performance when used extensively in queries. It is important to monitor and optimize their usage in performance-critical applications."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The function should include error handling to manage unexpected inputs or calculation errors gracefully."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "8. Function Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE FUNCTION [ManualBill].[DetermineProjectedToOrFromDate]\n(\r\n\t@UtilityCompany int,\t\r\n\t@InvoiceBillingGroup int,\t\r\n\t@BillingPeriod varchar(6),\r\n\t@FromOrTo varchar(1),\t\t-- T:toDate; F:fromDate\r\n\t@TripNumber varchar(2),\r\n\t@BillingCycle varchar(1)\r\n)\r\nRETURNS varchar(8)\r\nAS\r\nBEGIN\r\n\tdeclare @returnDate varchar(8)\r\n\r\n\tif(@FromOrTo = 'T') -- toDate\r\n\tbegin\r\n\t\t\t\r\n\t\t\tSELECT    @returnDate = MeterReadingToDate\r\n\t\t\tFROM   ManualBill.ReadingScheduleManualBilling\r\n\t\t\tWHERE (UtilityCompanySeqid = @UtilityCompany) AND (InvoiceAccountGroupSeqid = @InvoiceBillingGroup) AND (TripNumber = @TripNumber) AND (BillingPeriod = @BillingPeriod)\r\n\r\n--\tcommented so it can be pororated correctly in a idfferent function \r\n--\t\t\tif (@returnDate is null)\r\n--\t\t\tbegin\r\n--\t\t\t\t-- all this does is get next billingperiod's first day'\r\n--\t\t\t\tSELECT @returnDate = dbo.ConvertDatetimeToYYYYMMDD(dateadd(d,1, dateadd(s,-1,DATEADD(mm, DATEDIFF(m,0,dbo.ConvertYYYYMMDDToDatetime(@billingperiod + '01'))+1,0))))\r\n--\t\t\tEND\t \r\n\r\n\t\t\t\r\n\tend -- end get projected to date for trip number\r\n\t\r\n\tif(@FromOrTo = 'F') -- fromDate\r\n\tbegin\r\n\t\t\t\r\n\t\t\tSELECT    @returnDate = MeterReadingFromDate\r\n\t\t\tFROM   ManualBill.ReadingScheduleManualBilling\r\n\t\t\tWHERE (UtilityCompanySeqid = @UtilityCompany) AND (InvoiceAccountGroupSeqid = @InvoiceBillingGroup) AND (TripNumber = @TripNumber) AND (BillingPeriod = @BillingPeriod)\r\n\r\n--\tcommented so it can be pororated correctly in a idfferent function \t\t\t\r\n--\t\t\tif (@returnDate is null)\r\n--\t\t\tbegin\r\n--\t\t\t\t-- all this does is get the first bay of the billing period based on billing cycle\r\n--\t\t\t\tSELECT @returnDate = dbo.ConvertDatetimeToYYYYMMDD(dateadd(d,1, dateadd(s,-1,DATEADD(mm, DATEDIFF(m,0,dbo.ConvertYYYYMMDDToDatetime(dbo.CreatePreviousPeriod(@billingperiod, @BillingCycle) + '01'))+1,0))))\r\n--\t\t\tEND\t \r\n\r\n\tend -- end get projected from date for trip number\r\n\t\r\n\r\n\t\r\n\treturn @returnDate\t\r\n\t\r\n\r\nEND"
        }
      ]
    }
  ]
}