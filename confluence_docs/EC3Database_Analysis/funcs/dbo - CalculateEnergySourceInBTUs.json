{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "dbo",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Function Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "CalculateEnergySourceInBTUs",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The "
        },
        {
          "type": "text",
          "text": "CalculateEnergySourceInBTUs",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " function is a scalar function in Microsoft SQL Server designed to convert a given energy source measurement into British Thermal Units (BTUs). Scalar functions return a single value and are used for calculations or data transformations that involve a single row of data."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level of this function is considered medium. While scalar functions are straightforward, the complexity arises from the need to accurately convert various energy source measurements into BTUs, which involve multiple conversion factors and conditional logic."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The function accepts one or more input parameters that represent:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The type of energy source (e.g., electricity, natural gas, coal)."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The quantity or measurement of the energy source (e.g., kilowatt-hours, cubic feet, tons)."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "additional parameters for conversion factors or units of measurement."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Each parameter serves to provide the necessary context and data for the conversion calculation."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Return Type"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The return type of the function is a numeric data type, such as "
        },
        {
          "type": "text",
          "text": "FLOAT",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " or "
        },
        {
          "type": "text",
          "text": "DECIMAL",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", which can accurately represent the calculated BTUs. This ensures precision in the conversion results, which is crucial for energy calculations."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The function's business logic involves:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Identifying the type of energy source from the input parameters."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Applying the appropriate conversion factor to transform the input measurement into BTUs."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Returning the calculated BTU value as the result."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The workflow include conditional statements to handle different energy sources and their respective conversion formulas."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Performance Considerations"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Scalar functions can have performance implications, especially when used in SELECT statements that process large datasets. They are executed row-by-row, which can lead to slower query performance compared to inline table-valued functions. To mitigate this, consider:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Minimizing the use of scalar functions in large queries."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Ensuring that the function logic is optimized and avoids unnecessary computations."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Potential issues or risks include:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Inaccurate conversion factors leading to incorrect BTU calculations."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Performance degradation when used extensively in queries over large datasets."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Lack of error handling for invalid input parameters, which could result in runtime errors or incorrect results."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Changes in energy conversion standards or units that require updates to the function logic."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "8. Function Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE FUNCTION [dbo].[CalculateEnergySourceInBTUs]\n(\r\n\t@ConsumptionUnit AS BIGINT,\r\n\t@EnergyUnit AS [dbo].[EnergyDeliveryTypeUnit]\r\n)\r\nRETURNS BIGINT AS\r\nBEGIN\r\n\t--  Unit Conversion Factors\t\t\t\t\t\r\n\t--\t\t\t\t\t\r\n\t--\tMass\t\t\t\t\r\n\t--\t1 pound (lb)\t453.6 grams (g)\t0.4536 kilograms (kg)\t0.0004536 metric tons (tonne)\t\r\n\t--\t1 kilogram (kg)\t2.205 pounds (lb)\t\t\t\r\n\t--\t1 short ton (ton)\t2,000 pounds (lb)\t907.2 kilograms (kg)\t\t\r\n\t--\t1 metric ton (tonne)\t2,205 pounds (lb)\t1,000 kilograms (kg)\t1.102 short tons (tons)\t\r\n\t--\t\t\t\t\t\r\n\t--\tVolume\t\t\t\t\r\n\t--\t1 cubic foot (ft 3)\t7.4805 US gallons (gal)\t0.1781 barrel (bbl)\t\t\r\n\t--\t1 cubic foot (ft 3)\t28.32 liters (L)\t0.02832 cubic meters (m 3)\t\t\r\n\t--\t1 US gallon (gal)\t0.0238 barrel (bbl)\t3.785 liters (L)\t0.003785 cubic meters (m 3)\t\r\n\t--\t1 barrel (bbl)\t42 US gallons (gal)\t158.99 liters (L)\t0.1589 cubic meters (m 3)\t\r\n\t--\t1 litre (L)\t0.001 cubic meters (m 3)\t0.2642 US gallons (gal)\t\t\r\n\t--\t1 cubic meter (m 3)\t6.2897 barrels (bbl)\t264.2 US gallons (gal)\t1,000 liters (L)\t\r\n\t--\t\t\t\t\t\r\n\t--\tEnergy\t\t\t\t\r\n\t--\t1 kilowatt hour (kWh)\t3,412 Btu (btu)\t3,600 kilojoules (KJ)\t\t\r\n\t--\t1 megajoule (MJ)\t0.001 gigajoules (GJ)\t\t\t\r\n\t--\t1 gigajoule (GJ)\t0.9478 million Btu (million btu)\t277.8 kilowatt hours (kWh)\t\t\r\n\t--\t1 Btu (btu)\t1,055 joules (J)\t\t\t\r\n\t--\t1 million Btu (million btu)\t1.055 gigajoules (GJ)\t293 kilowatt hours (kWh)\t\t\r\n\t--\t1 therm (therm)\t100,000 btu \t0.1055 gigajoules (GJ)\t29.3 kilowatt hours (kWh)\t\r\n\t--\t1 hundred cubic feet of natural gas (CCF)\t1.03 therm (therm)\t\t\t\r\n\t--\t1 thousand pounds of steam (Mlb)\t1 Mlb\t\t\t\r\n\t--\t\t\t\t\t\r\n\t--\tOther\t\t\t\t\r\n\t--\tKilo\t1,000\t\t\t\r\n\t--\tMega\t1,000,000\t\t\t\r\n\t--\tGiga\t1,000,000,000\t\t\t\r\n\t--\tTera\t1,000,000,000,000\t\t\t\r\n\t--\t1 land mile\t1.609 land kilometers\t\t\t\r\n\t--\t1 nautical mile\t1.15 land miles\t\t\t\r\n\t--\t1 metric ton carbon\t3.664 metric tons CO2\t\t\t\r\n\r\n\tDECLARE @Unit AS VARCHAR(3);\r\n\tSET @Unit = SUBSTRING(@EnergyUnit, 1, 3);\r\n\r\n\tIF(@Unit = 'KWH') RETURN @ConsumptionUnit * 3412;-- Electric Consumption  kwh 3412\r\n\tELSE IF (@Unit = 'THE') RETURN @ConsumptionUnit * 100000;-- Gas Consumption 1 therm 100,000\r\n\tELSE IF (@Unit = 'MLB') RETURN @ConsumptionUnit * 1687000;-- Steam Consumption 1,687,000\r\n\tELSE IF (@Unit = 'GAL') RETURN 33740;-- @ConsumptionUnit * ??????  Chilled Water Consumption\r\n\tRETURN 0;\r\nEND;"
        }
      ]
    }
  ]
}