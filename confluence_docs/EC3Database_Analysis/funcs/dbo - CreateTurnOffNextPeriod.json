{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "dbo",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Function Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "CreateTurnOffNextPeriod",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "To provide a detailed analysis of the "
        },
        {
          "type": "text",
          "text": "CreateTurnOffNextPeriod",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " scalar function, I would need the actual SQL code of the function. However, I can provide a general template for analyzing a scalar function in SQL Server. Once you provide the SQL code, I can fill in the specific details. Here is the structured analysis template:"
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "A scalar function in SQL Server is a user-defined function that returns a single value of a specified data type. The "
        },
        {
          "type": "text",
          "text": "CreateTurnOffNextPeriod",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " function is designed to perform a specific calculation or transformation and return a single result based on the input parameters provided."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: (Low/Medium/High)"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level of a scalar function is determined by the number of operations it performs, the complexity of its logic, and the types of operations involved (e.g., arithmetic, string manipulation, conditional logic). Without the specific code, the complexity level cannot be determined."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Input parameters are the values that the function requires to perform its operations. Each parameter has a specific data type and purpose. The function's signature will list these parameters, and their roles will be defined within the function's logic."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Return Type"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The return type of a scalar function is a single value of a specified data type. This could be an integer, string, date, or any other SQL Server data type. The return type is defined in the function's declaration."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The business logic of the function describes the operations and transformations applied to the input parameters to produce the output. This includes any calculations, conditional statements, or data manipulations performed within the function."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Performance Considerations"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Scalar functions can impact performance, especially if used in SELECT statements that process large datasets. They are executed row-by-row, which can lead to performance bottlenecks. Considerations include the function's complexity, the efficiency of its logic, and how it is used within queries."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Potential issues with scalar functions include performance degradation, especially in large datasets, and the risk of errors if input parameters are not validated properly. Additionally, changes to the function's logic or parameters can impact dependent queries or applications. Please provide the SQL code for the "
        },
        {
          "type": "text",
          "text": "CreateTurnOffNextPeriod",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " function to allow for a more detailed and specific analysis."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "9. Function Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE   FUNCTION [dbo].[CreateTurnOffNextPeriod] (@YYYYMM varchar(6),@BillingCycle varchar(1),@StatusCode varchar(2))\nRETURNS varchar(6) AS  \r\n--\r\nBEGIN \r\n\tif (@StatusCode =  '27' or @StatusCode = '45' )\r\n\t\tBegin\r\n\t\t\treturn @YYYYMM\r\n\t\tEnd\r\n\telse\r\n\t\tBegin\r\n\t\t\tif @YYYYMM ='187601'  return '187601'\r\n\t\t\t\tdeclare @mm integer\r\n\t\t\t\tdeclare @yy integer\r\n--\t\t\t\t\r\n\t\t\t\tset @mm = cast(substring(@YYYYMM,5,2) as integer) +[dbo].[MonthsInBillingCycle]  (@BillingCycle)\r\n\t\t\t\tset @yy = cast(substring(@YYYYMM,1,4) as integer) \r\n--\r\n\t\t\t\tif @mm < 10  return substring( @YYYYMM,1,4)+'0'+  cast( (@mm) as varchar(1))\r\n\t\t\t\telse if 9 < @mm and @mm < 13 return substring( @YYYYMM,1,4) +  cast( (@mm) as varchar(2))\r\n\t\t\t\telse if @mm > 12 and @BillingCycle = 'M' return cast( (@yy+1) as varchar(4))+'01'\r\n\t\t\t\telse if @mm > 12 and @BillingCycle = 'B' return cast( (@yy+1) as varchar(4))+'02'\r\n\t\t\t\telse if @mm > 12 and @BillingCycle = 'Q' return cast( (@yy+1) as varchar(4))+'03'\r\n\t\t\t\telse if @mm > 12 and @BillingCycle = 'Y' return cast( (@yy+1) as varchar(4))+substring(@YYYYMM,5,2)\r\n\t\tEnd\r\n\treturn '187601'\r\nEND"
        }
      ]
    }
  ]
}