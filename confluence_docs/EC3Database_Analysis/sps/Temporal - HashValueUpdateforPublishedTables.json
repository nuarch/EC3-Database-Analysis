{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Temporal",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "HashValueUpdateforPublishedTables",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "High",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "HashValueUpdateforPublishedTables",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to update hash values for various tables within a database schema named "
        },
        {
          "type": "text",
          "text": "Published",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ". These hash values are generated using the "
        },
        {
          "type": "text",
          "text": "HASHBYTES",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " function with the 'MD5' algorithm, which creates a hash from a concatenation of multiple columns' values. The procedure targets several tables, updating hash values for records where the hash is currently "
        },
        {
          "type": "text",
          "text": "NULL",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " and the "
        },
        {
          "type": "text",
          "text": "PublishedBillingPeriod",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " matches the provided parameter. This process is likely used to ensure data integrity and facilitate data synchronization or versioning in a temporal data management context."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: High"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity of this stored procedure is high due to the following reasons:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It involves multiple updates across several tables."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Each update operation involves complex subqueries that concatenate numerous columns into XML format before hashing."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure handles a large number of columns, which increases the complexity of understanding and maintaining the code."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The use of XML and hashing functions adds computational overhead."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@PublishedBillingPeriod AS VARCHAR(6)",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This parameter specifies the billing period for which the hash values should be updated. It is used to filter records in each table update operation, ensuring that only relevant records are processed."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "orderedList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Initialization",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure begins by setting "
                },
                {
                  "type": "text",
                  "text": "NOCOUNT ON",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to prevent the message that shows the number of rows affected by SQL statements from being returned."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Update Operations",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure performs a series of "
                },
                {
                  "type": "text",
                  "text": "UPDATE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " operations on different tables within the "
                },
                {
                  "type": "text",
                  "text": "Published",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " schema:"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "AccountLevelRawDataForCurrentPeriod",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ": Updates "
                        },
                        {
                          "type": "text",
                          "text": "hashValue",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " and "
                        },
                        {
                          "type": "text",
                          "text": "HashValue2",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " using a hash of selected columns."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "AccountLevelSummaryByAgency",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ", "
                        },
                        {
                          "type": "text",
                          "text": "AccountLevelSummaryByCityWide",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ", "
                        },
                        {
                          "type": "text",
                          "text": "AccountLevelSummaryByFacility",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ", "
                        },
                        {
                          "type": "text",
                          "text": "AccountLevelSummaryForDollarsBtusAndCo2",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ": Updates "
                        },
                        {
                          "type": "text",
                          "text": "hashValue",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " using a hash of selected columns."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "AccountMeterLevelRawDataForCurrentPeriod",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ": Updates "
                        },
                        {
                          "type": "text",
                          "text": "hashValue",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " using a hash of selected columns."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "EnergyUsageSummaryGroupByAgencyAndEnergyType",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ": Updates "
                        },
                        {
                          "type": "text",
                          "text": "hashValue",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " using a hash of selected columns."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "FiscalYearPivotByAgencyAndFacilityDollarsAndUsage",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ", "
                        },
                        {
                          "type": "text",
                          "text": "FiscalYearPivotByAgencyDollarsAndUsage",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ", "
                        },
                        {
                          "type": "text",
                          "text": "FiscalYearPivotByAgencyFacilityAndAccountDollarsAndUsage",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ": Updates "
                        },
                        {
                          "type": "text",
                          "text": "hashValue1",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " and "
                        },
                        {
                          "type": "text",
                          "text": "hashValue2",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " using hashes of selected columns."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "FiscalYearPivotByEncoreMonthlyPayments",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ": Updates "
                        },
                        {
                          "type": "text",
                          "text": "hashValue",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " using a hash of selected columns."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Condition",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Each update is conditional, only affecting rows where the hash value is "
                },
                {
                  "type": "text",
                  "text": "NULL",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and the "
                },
                {
                  "type": "text",
                  "text": "PublishedBillingPeriod",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " matches the input parameter."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hashing Overhead",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The use of "
                },
                {
                  "type": "text",
                  "text": "HASHBYTES",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " with a large number of columns can be computationally expensive, especially if the tables are large."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "XML Conversion",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The conversion of column values to XML format before hashing adds additional processing time."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Indexing",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Ensuring that "
                },
                {
                  "type": "text",
                  "text": "PublishedBillingPeriod",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is indexed can improve the performance of the "
                },
                {
                  "type": "text",
                  "text": "WHERE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " clause filtering."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Batch Processing",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If tables are large, consider processing in batches to reduce transaction size and lock contention."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hash Collisions",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Although unlikely with MD5, hash collisions can occur, potentially leading to incorrect data integrity checks."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Scalability",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": As data volume grows, the performance of this procedure may degrade due to the computational complexity of hashing large datasets."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Security",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": MD5 is not considered secure for cryptographic purposes. If security is a concern, consider using a more secure hashing algorithm."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure lacks error handling, which could lead to silent failures if an error occurs during execution."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Maintenance",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The large number of columns involved in each hash operation makes the procedure difficult to maintain and prone to errors if the schema changes."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "--**************************************************************************************\n--* Description:\tGenerates HashValue used for transfering the published data to versioned (temporal) tables\r\n--*\r\n--* AUTHOR:       zd\r\n--* Created On:   2016-03-15\r\n--**************************************************************************************\r\n--* Date       Tech Description of Change\r\n--* ---------- ---\t-------------------------------------------------------------\r\n--* 03/15/2016 zd  First Version \r\n--* 11/21/2016 zd  added fields to include in has for  AccountLevelRawDataForCurrentPeriod AND AccountMeterLevelRawDataForCurrentPeriod\r\n--* 10/05/2017 zd Added ZECsCharge for AccountMeterLevelRawDataForCurrentPeriod\r\n--* 05/09/2019 zd unique account seq id is added to UPDATE Published.AccountMeterLevelRawDataForCurrentPeriod\r\n--* 08/09/2019 zd  subtype update\r\n--***************************************************************************************\r\nCREATE PROCEDURE [Temporal].[HashValueUpdateforPublishedTables]\r\n(\r\n\t@PublishedBillingPeriod AS VARCHAR(6)\r\n)  \r\nAS \r\nBEGIN\r\n\tSET NOCOUNT ON;\r\n\r\n\tUPDATE Published.AccountLevelRawDataForCurrentPeriod\r\n\tSET hashValue = (SELECT hashbytes('md5', (SELECT BillingPeriod\r\n\t\t,LastPeriodModified\r\n        ,BillingMonth\r\n        ,BillingMonthActualOrEstimated\r\n        ,BillingMonthOriginalBilledDollars\r\n        ,BillingMonthOriginalPaidAdjustmentDollars\r\n        ,BillingMonthOriginalTotalDueDollars\r\n        ,BillingMonthOriginalEnergyUsage\r\n        ,BillingMonthOriginalDemandUsage\r\n        ,BillingMonthRevisedBilledDollars\r\n        ,BillingMonthRevisedEnergyUsage\r\n        ,BillingMonthRevisedDemandUsage\r\n        ,BillingMonthNetDollarChange\r\n        ,BillingMonthNetEnergyUsageChange\r\n        ,BillingMonthNetDemandUsageChange\r\n        ,FiscalYear\r\n        ,ActualOrEstimated\r\n        ,TotalAmountDue\r\n        ,NetDollarChange\r\n        ,OriginalBilledAmount\r\n        ,RevisedBilledAmount\r\n        ,OriginalBilledAmountPaid\r\n        ,PaidAdjustmentAmount\r\n        ,OriginalEnergyUsage\r\n        ,OriginalDemandUsage\r\n        ,AccountEnergyUsage\r\n        ,AccountDemandUsage\r\n        ,NetEnergyUsageChange\r\n        ,NetDemandUsageChange\r\n        ,UtilityCompany\r\n        ,EnergySource\r\n        ,EnergyType\r\n        ,CurrentInvoiceAccountBillingGroup\r\n        ,InvoiceAccountBillingGroupDesc\r\n        ,AgencyCodeOEC\r\n        ,AgencyName\r\n        ,OecFacilityNumber\r\n        ,FacilityName\r\n        ,Address1\r\n        ,CurrentAccountNumber\r\n        ,OriginalAccountNumber\r\n        ,BillToAgencyCode\r\n        ,Borough\r\n        ,Block\r\n        ,LotNumber\r\n        ,CityPlanningBIN\r\n        ,EnergyUnit\r\n        ,AccountStatus\r\n        ,AccountPreviousStatus\r\n        ,AccountStatusCodePeriod\r\n        ,IsTimeOfDayAccount\r\n        ,SalesType\r\n        ,DeliveryTariffRate\r\n        ,CommodityTariffRate\r\n        ,BudgetGroupDEM\r\n        ,BudgetGroupDEMName\r\n        ,BudgetRateClassDescription\r\n        ,BillingCycle\r\n        ,UtilityServiceAddress\r\n        ,AccountBillingStatus\r\n        ,PreviousAccountBillingStatus\r\n        ,AccountBillingStatusCodePeriod\r\n        ,BillingPeriodDays\r\n        ,UtilityCompanySeqid\r\n        ,EnergyDeliveryType\r\n        ,AccountSeqid\r\n        ,AccountBillingSeqid\r\n        ,IsRentalSpace\r\n        ,FromDate\r\n        ,ToDate\r\n        ,AccountEffectiveTurnOn\r\n        ,AccountEffectiveTurnOff\r\n        ,AccountEnergyType\r\n        ,UtilityTariffRateInformationSeqid\r\n        ,BTUfactor\r\n        ,BTU\r\n        ,CO2factor\r\n        ,CO2\r\n        ,OnPeakEnergyUsage\r\n        ,OffPeakEnergyUsage\r\n        ,RevisedEnergyDollar\r\n        ,RevisedDemandDollar\r\n        ,RevisedFacilityPointDollar\r\n        ,RevisedReactivePowerDollars\r\n        ,StreetLightingFacilityPoints\r\n        ,OriginalReactivePowerDollars\r\n        ,CommodityAllocationCharge\r\n        ,NetchangeReactivePowerDollars\r\n        ,CustomerLevelAdjustmentAmount\r\n        ,OriginalAccountReactivePowerEnergy\r\n        ,AccountReactivePowerEnergy\r\n        ,NetChangeAccountReactivePowerEnergy\r\n        ,IsMinimumBilledCharged\r\n        ,DeliveryAllocationCharge\r\n        ,MinimumBilledEnergyDollars\r\n        ,GrossDemandUsageChange\r\n        ,MinimumBilledDemandDollars\r\n        ,AccountBillingStatusDescription\r\n        ,MaxBilledDemandUsage\r\n        ,GrossEnergyUsageChange\r\n        ,InvoiceAccountGroupSeqid\r\n        ,GrossDollarChange\r\n        ,AgencyDivisionSeqid\r\n        ,FacilitySeqid\r\n        ,MaxBilledDemandPeriod\r\n        ,MinimumBilledDemandUsage\r\n        ,IsDeliveryMinimumBilledFlag\r\n        ,DeliveryMinimumBilledAmount\r\n        ,DeliveryMinimumBilledDemand\r\n        ,DeliveryMaximumBilledDemand\r\n        ,DeliveryMaximumBilledDemandPeriod\r\n        ,MinimumBilledEnergyUsage\r\n        ,ManualPaymentOverride\r\n        ,ManualPaymentOverrideAmount FOR xml raw)))\r\n\tWHERE HashValue IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\t\r\n\tUPDATE Published.AccountLevelRawDataForCurrentPeriod\r\n\tSET HashValue2 = (SELECT hashbytes('md5', \r\n\t(SELECT  \r\n\t    UniqueAccountSeqid\r\n\t    ,RevisedDeliveryDollars\r\n\t\t,RevisedTotalReactivePowerDollars\r\n\t\t,RevisedCommodityDollars\r\n\t\t,ZECsCharge\r\n\t\t, EnergyDeliverySubType\r\n\t\t, EnergyDeliverySubTypeID\r\n\tFOR xml raw)))\r\n\tWHERE HashValue2 IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.AccountLevelSummaryByAgency\r\n\tSET hashValue = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tBillingPeriod\r\n\t\t,AgencyCodeOEC\r\n\t\t,FiscalYear\r\n\t\t,EnergyType\r\n\t\t,CalendarYear\r\n\t\t,MonthName\r\n\t\t,MonthNameYear\r\n\t\t,AgencyName\r\n\t\t,BilledAmount\r\n\t\t,EnergyUsage\r\n\t\t,DemandUsage\r\n\t\t,EnergySource\r\n\t\t,BTUfactor\r\n\t\t,Co2factor\r\n\t\t,BTU\r\n\t\t,CO2\r\n\t\t,BillingPeriodLastYear\r\n\t\t,BilledAmountLastYear\r\n\t\t,DemandUsageLastYear\r\n\t\t,EnergyUsageLastYear\r\n\t\t,BTULastYear\r\n\t\t,BTUFiscalYearVariance\r\n\t\t,BilledAmountFiscalYearVariance\r\n\t\t,Notes\r\n\t\t,AuthenticatedUserID\r\n\tFOR xml raw)))\r\n\tWHERE HashValue IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.AccountLevelSummaryByCityWide\r\n\tSET hashValue = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tBillingPeriod\r\n\t\t,FiscalYear\r\n\t\t,EnergyType\r\n\t\t,CalendarYear\r\n\t\t,MonthName\r\n\t\t,MonthNameYear\r\n\t\t,BilledAmount\r\n\t\t,EnergyUsage\r\n\t\t,DemandUsage\r\n\t\t,EnergySource\r\n\t\t,BTUfactor\r\n\t\t,Co2factor\r\n\t\t,BTU\r\n\t\t,CO2\r\n\t\t,BillingPeriodLastYear\r\n\t\t,BilledAmountLastYear\r\n\t\t,DemandUsageLastYear\r\n\t\t,EnergyUsageLastYear\r\n\t\t,BTULastYear\r\n\t\t,BTUFiscalYearVariance\r\n\t\t,BilledAmountFiscalYearVariance\r\n\t\t,Notes\r\n\t\t,AuthenticatedUserID\r\n\tFOR xml raw)))\r\n\tWHERE HashValue IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.AccountLevelSummaryByFacility\r\n\tSET hashValue = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tBillingPeriod\r\n\t\t,AgencyCodeOEC\r\n\t\t,FiscalYear\r\n\t\t,EnergyType\r\n\t\t,CalendarYear\r\n\t\t,MonthName\r\n\t\t,MonthNameYear\r\n\t\t,AgencyName\r\n\t\t,OecFacilityNumber\r\n\t\t,FacilityName\r\n\t\t,Address1\r\n\t\t,BilledAmount\r\n\t\t,EnergyUsage\r\n\t\t,DemandUsage\r\n\t\t,EnergySource\r\n\t\t,BTUfactor\r\n\t\t,Co2factor\r\n\t\t,BTU\r\n\t\t,CO2\r\n\t\t,BillingPeriodLastYear\r\n\t\t,BilledAmountLastYear\r\n\t\t,DemandUsageLastYear\r\n\t\t,EnergyUsageLastYear\r\n\t\t,BTULastYear\r\n\t\t,BTUFiscalYearVariance\r\n\t\t,BilledAmountFiscalYearVariance\r\n\t\t,Notes\r\n\t\t,AuthenticatedUserID\r\n\tFOR xml raw)))\r\n\tWHERE HashValue IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.AccountLevelSummaryForDollarsBtusAndCo2\r\n\tSET hashValue = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tCitywideAgencyOrFacility\r\n\t\t,Month\r\n\t\t,FiscalYear\r\n\t\t,PublishedPeriodCurrentFiscalYear\r\n\t\t,PublishedPeriodPriorFiscalYear\r\n\t\t,CurrentFiscalYear\r\n\t\t,PriorFiscalYear\r\n\t\t,BillingPeriod\r\n\t\t,SummaryORDetail\r\n\t\t,AgencyCodeOEC\r\n\t\t,FacilityName\r\n\t\t,FacilityNumber\r\n\t\t,EnergyType\r\n\t\t,EnergyUsage\r\n\t\t,DemandUsage\r\n\t\t,TotalBilledAmount\r\n\t\t,TotalCO2\r\n\t\t,TotalBTU\r\n\t\t,PublishedBillingPeriodRunningTotalCO2\r\n\t\t,YtdRunningTotalCO2\r\n\t\t,AgencyName\r\n\t\t,Address1\r\n\t\t,Borough\r\n\t\t,Block\r\n\t\t,LotNumber\r\n\t\t,CityPlanningBIN\r\n\t\t,Notes\r\n\t\t,AuthenticatedUserID\r\n\tFOR xml raw)))\r\n\tWHERE HashValue IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.AccountMeterLevelRawDataForCurrentPeriod\r\n\tSET hashValue = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tFiscalYear\r\n\t\t,CurrentFiscalYear\r\n\t\t,PriorFiscalYear\r\n\t\t,BillingPeriod\r\n\t\t,LastPeriodModified\r\n\t\t,BillingMonthConsumption\r\n\t\t,BillingMonthDemand\r\n\t\t,mbOriginalAccountNumber\r\n\t\t,mbOriginalMeterNumber\r\n\t\t,EstimatedReading\r\n\t\t,ConsecutivePeriodsEstimatedReading\r\n\t\t,MeterBillingStatus\r\n\t\t,PreviousMeterBillingStatus\r\n\t\t,MeterBillingStatusCodePeriod\r\n\t\t,IsTodMeterBilling\r\n\t\t,BillingPeriodDays\r\n\t\t,mbMeterConstant\r\n\t\t,Tension\r\n\t\t,FromDate\r\n\t\t,ToDate\r\n\t\t,FromReadingDate\r\n\t\t,ToReadingDate\r\n\t\t,Consumption\r\n\t\t,Demand\r\n\t\t,AdjustmentRecordSeqid\r\n\t\t,EnergySource\r\n\t\t,IsTimeOfDayAccount\r\n\t\t,SalesType\r\n\t\t,DeliveryTariffRate\r\n\t\t,CommodityTariffRate\r\n\t\t,BillingCycle\r\n\t\t,CurrentAccountNumber\r\n\t\t,OriginalAccountNumber\r\n\t\t,AccountEffectiveTurnOn\r\n\t\t,AccountEffectiveTurnOff\r\n\t\t,AccountStatus\r\n\t\t,AccountPreviousStatus\r\n\t\t,AccountStatusCodePeriod\r\n\t\t,meterOriginalAccountNumber\r\n\t\t,CurrentMeterNumber\r\n\t\t,meterOriginalMeterNumber\r\n\t\t,UtilityServiceAddress\r\n\t\t,MeterEffectiveOnDate\r\n\t\t,MeterEffectiveOffDate\r\n\t\t,MeterType\r\n\t\t,MeterDials\r\n\t\t,MeterConstant\r\n\t\t,MeterStatus\r\n\t\t,MeterPreviousStatus\r\n\t\t,MeterStatusCodePeriod\r\n\t\t,OecFacilityNumber\r\n\t\t,FacilityName\r\n\t\t,Borough\r\n\t\t,Block\r\n\t\t,LotNumber\r\n\t\t,CityPlanningBIN\r\n\t\t,IsRentalSpace\r\n\t\t,Address1\r\n\t\t,BillToAgencyCode\r\n\t\t,AgencyCodeOEC\r\n\t\t,AgencyName\r\n\t\t,EnergyType\r\n\t\t,EnergyDeliverySubType\r\n\t\t,EnergyDeliverySubTypeID\r\n\t\t,InvoiceAccountBillingGroupDesc\r\n\t\t,UtilityCompany\r\n\t\t,EnergyUnit\r\n\t\t,UtilityCompanySeqid\r\n\t\t,EnergyDeliveryType\r\n\t\t,MeterSeqid\r\n\t\t,MeterBillingSeqid\r\n\t\t,AccountExchangeMeterTrackSeqid\r\n\t\t,FacilitySeqid\r\n\t\t,AgencyDivisionSeqid\r\n\t\t,AccountSeqid\r\n\t\t,UtilityServiceAccountName\r\n\t\t,meterUtilityServiceAddress\r\n\t\t,AgencyELOMeterLocationSeqid\r\n\t\t,OnPeakEnergyUsage\r\n\t\t,OffPeakEnergyUsage\r\n\t\t,AssociatedDemandMeter\r\n\t\t,NgridCorrectorMeterId\r\n\t\t,UniqueMeterSeqid\r\n\t\t,UniqueAccountSeqID\r\n\tFOR xml raw)))\r\n\tWHERE HashValue IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.EnergyUsageSummaryGroupByAgencyAndEnergyType\r\n\tSET hashValue = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tPeriodSpan\r\n\t\t,TypeOfCalculation\r\n\t\t,TotalUsage\r\n\t\t,TotalBTU\r\n\t\t,EnergyType\r\n\t\t,AgencyCodeOEC\r\n\t\t,AgencyName\r\n\tFOR xml raw)))\r\n\tWHERE HashValue IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.FiscalYearPivotByAgencyAndFacilityDollarsAndUsage\r\n\tSET hashValue1 = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tBillToAgencyCode\r\n\t\t,AgencyCodeOEC\r\n\t\t,AgencyName\r\n\t\t,OecFacilityNumber\r\n\t\t,Address1\r\n\t\t,Borough\r\n\t\t,Block\r\n\t\t,LotNumber\r\n\t\t,CityPlanningBIN\r\n\t\t,CurrentInvoiceAccountBillingGroup\r\n\t\t,InvoiceAccountBillingGroupDesc\r\n\t\t,FiscalYear\r\n\t\t,UtilityCompany\r\n\t\t,EnergyType\r\n\t\t,JulyOriginalBilledDollars\r\n\t\t,AugustOriginalBilledDollars\r\n\t\t,SeptemberOriginalBilledDollars\r\n\t\t,OctoberOriginalBilledDollars\r\n\t\t,NovemberOriginalBilledDollars\r\n\t\t,DecemberOriginalBilledDollars\r\n\t\t,JanuaryOriginalBilledDollars\r\n\t\t,FebruaryOriginalBilledDollars\r\n\t\t,MarchOriginalBilledDollars\r\n\t\t,AprilOriginalBilledDollars\r\n\t\t,MayOriginalBilledDollars\r\n\t\t,JuneOriginalBilledDollars\r\n\t\t,FiscalYearToDateOriginalBilledDollars\r\n\t\t,JulyOriginalPaidAdjustmentDollars\r\n\t\t,AugustOriginalPaidAdjustmentDollars\r\n\t\t,SeptemberOriginalPaidAdjustmentDollars\r\n\t\t,OctoberOriginalPaidAdjustmentDollars\r\n\t\t,NovemberOriginalPaidAdjustmentDollars\r\n\t\t,DecemberOriginalPaidAdjustmentDollars\r\n\t\t,JanuaryOriginalPaidAdjustmentDollars\r\n\t\t,FebruaryOriginalPaidAdjustmentDollars\r\n\t\t,MarchOriginalPaidAdjustmentDollars\r\n\t\t,AprilOriginalPaidAdjustmentDollars\r\n\t\t,MayOriginalPaidAdjustmentDollars\r\n\t\t,JuneOriginalPaidAdjustmentDollars\r\n\t\t,FiscalYearToDateOriginalPaidAdjustmentDollars\r\n\t\t,JulyOriginalTotalDueDollars\r\n\t\t,AugustOriginalTotalDueDollars\r\n\t\t,SeptemberOriginalTotalDueDollars\r\n\t\t,OctoberOriginalTotalDueDollars\r\n\t\t,NovemberOriginalTotalDueDollars\r\n\t\t,DecemberOriginalTotalDueDollars\r\n\t\t,JanuaryOriginalTotalDueDollars\r\n\t\t,FebruaryOriginalTotalDueDollars\r\n\t\t,MarchOriginalTotalDueDollars\r\n\t\t,AprilOriginalTotalDueDollars\r\n\t\t,MayOriginalTotalDueDollars\r\n\t\t,JuneOriginalTotalDueDollars\r\n\t\t,FiscalYearToDateOriginalTotalDueDollars\r\n\t\t,FiscalYearToDateOriginalEnergyUsage\r\n\t\t,JulyOriginalEnergy\r\n\t\t,AugustOriginalEnergy\r\n\t\t,SeptemberOriginalEnergy\r\n\t\t,OctoberOriginalEnergy\r\n\t\t,NovemberOriginalEnergy\r\n\tFOR xml raw)))\r\n\tWHERE HashValue1 IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.FiscalYearPivotByAgencyAndFacilityDollarsAndUsage\r\n\tSET hashValue2 = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tDecemberOriginalEnergy\r\n\t\t,JanuaryOriginalEnergy\r\n\t\t,FebruaryOriginalEnergy\r\n\t\t,MarchOriginalEnergy\r\n\t\t,AprilOriginalEnergy\r\n\t\t,MayOriginalEnergy\r\n\t\t,JuneOriginalEnergy\r\n\t\t,JulyOriginalDemand\r\n\t\t,AugustOriginalDemand\r\n\t\t,SeptemberOriginalDemand\r\n\t\t,OctoberOriginalDemand\r\n\t\t,NovemberOriginalDemand\r\n\t\t,DecemberOriginalDemand\r\n\t\t,JanuaryOriginalDemand\r\n\t\t,FebruaryOriginalDemand\r\n\t\t,MarchOriginalDemand\r\n\t\t,AprilOriginalDemand\r\n\t\t,MayOriginalDemand\r\n\t\t,JuneOriginalDemand\r\n\t\t,FiscalYearToDateOriginalDemand\r\n\t\t,JulyRevisedBilledDollars\r\n\t\t,AugustRevisedBilledDollars\r\n\t\t,SeptemberRevisedBilledDollars\r\n\t\t,OctoberRevisedBilledDollars\r\n\t\t,NovemberRevisedBilledDollars\r\n\t\t,DecemberRevisedBilledDollars\r\n\t\t,JanuaryRevisedBilledDollars\r\n\t\t,FebruaryRevisedBilledDollars\r\n\t\t,MarchRevisedBilledDollars\r\n\t\t,AprilRevisedBilledDollars\r\n\t\t,MayRevisedBilledDollars\r\n\t\t,JuneRevisedBilledDollars\r\n\t\t,FiscalYearToDateRevisedBilledDollars\r\n\t\t,FiscalYearToDateRevisedEnergy\r\n\t\t,JulyRevisedEnergy\r\n\t\t,AugustRevisedEnergy\r\n\t\t,SeptemberRevisedEnergy\r\n\t\t,OctoberRevisedEnergy\r\n\t\t,NovemberRevisedEnergy\r\n\t\t,DecemberRevisedEnergy\r\n\t\t,JanuaryRevisedEnergy\r\n\t\t,FebruaryRevisedEnergy\r\n\t\t,MarchRevisedEnergy\r\n\t\t,AprilRevisedEnergy\r\n\t\t,MayRevisedEnergy\r\n\t\t,JuneRevisedEnergy\r\n\t\t,JulyRevisedDemand\r\n\t\t,AugustRevisedDemand\r\n\t\t,SeptemberRevisedDemand\r\n\t\t,OctoberRevisedDemand\r\n\t\t,NovemberRevisedDemand\r\n\t\t,DecemberRevisedDemand\r\n\t\t,JanuaryRevisedDemand\r\n\t\t,FebruaryRevisedDemand\r\n\t\t,MarchRevisedDemand\r\n\t\t,AprilRevisedDemand\r\n\t\t,MayRevisedDemand\r\n\t\t,JuneRevisedDemand\r\n\t\t,FiscalYearToDateRevisedDemand\r\n\t\t,JulyNetDollarChange\r\n\t\t,AugustNetDollarChange\r\n\t\t,SeptemberNetDollarChange\r\n\t\t,OctoberNetDollarChange\r\n\t\t,NovemberNetDollarChange\r\n\t\t,DecemberNetDollarChange\r\n\t\t,JanuaryNetDollarChange\r\n\t\t,FebruaryNetDollarChange\r\n\t\t,MarchNetDollarChange\r\n\t\t,AprilNetDollarChange\r\n\t\t,MayNetDollarChange\r\n\t\t,JuneNetDollarChange\r\n\t\t,FiscalYearToDateNetDollarChange\r\n\t\t,FiscalYearToDateNetEnergyUsageChange\r\n\t\t,JulyEnergyUsageChange\r\n\t\t,AugustEnergyUsageChange\r\n\t\t,SeptemberEnergyUsageChange\r\n\t\t,OctoberEnergyUsageChange\r\n\t\t,NovemberEnergyUsageChange\r\n\t\t,DecemberEnergyUsageChange\r\n\t\t,JanuaryEnergyUsageChange\r\n\t\t,FebruaryEnergyUsageChange\r\n\t\t,MarchEnergyUsageChange\r\n\t\t,AprilEnergyUsageChange\r\n\t\t,MayEnergyUsageChange\r\n\t\t,JuneEnergyUsageChange\r\n\t\t,JulyNetDemandUsageChange\r\n\t\t,AugustNetDemandUsageChange\r\n\t\t,SeptemberNetDemandUsageChange\r\n\t\t,OctoberNetDemandUsageChange\r\n\t\t,NovemberNetDemandUsageChange\r\n\t\t,DecemberNetDemandUsageChange\r\n\t\t,JanuaryNetDemandUsageChange\r\n\t\t,FebruaryNetDemandUsageChange\r\n\t\t,MarchNetDemandUsageChange\r\n\t\t,AprilNetDemandUsageChange\r\n\t\t,MayNetDemandUsageChange\r\n\t\t,JuneNetDemandUsageChange\r\n\t\t,FiscalYearToDateNetDemandUsageChange\r\n\t\t,FacilityName\r\n\tFOR xml raw)))\r\n\tWHERE HashValue2 IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.FiscalYearPivotByAgencyDollarsAndUsage\r\n\tSET hashValue1 = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tFiscalYear\r\n\t\t,CurrentFiscalYear\r\n\t\t,PriorFiscalYear\r\n\t\t,BillToAgencyCode\r\n\t\t,AgencyCodeOEC\r\n\t\t,AgencyName\r\n\t\t,CurrentInvoiceAccountBillingGroup\r\n\t\t,InvoiceAccountBillingGroupDesc\r\n\t\t,UtilityCompany\r\n\t\t,EnergyType\r\n\t\t,JulyOriginalBilledDollars\r\n\t\t,AugustOriginalBilledDollars\r\n\t\t,SeptemberOriginalBilledDollars\r\n\t\t,OctoberOriginalBilledDollars\r\n\t\t,NovemberOriginalBilledDollars\r\n\t\t,DecemberOriginalBilledDollars\r\n\t\t,JanuaryOriginalBilledDollars\r\n\t\t,FebruaryOriginalBilledDollars\r\n\t\t,MarchOriginalBilledDollars\r\n\t\t,AprilOriginalBilledDollars\r\n\t\t,MayOriginalBilledDollars\r\n\t\t,JuneOriginalBilledDollars\r\n\t\t,FiscalYearToDateOriginalBilledDollars\r\n\t\t,JulyOriginalPaidAdjustmentDollars\r\n\t\t,AugustOriginalPaidAdjustmentDollars\r\n\t\t,SeptemberOriginalPaidAdjustmentDollars\r\n\t\t,OctoberOriginalPaidAdjustmentDollars\r\n\t\t,NovemberOriginalPaidAdjustmentDollars\r\n\t\t,DecemberOriginalPaidAdjustmentDollars\r\n\t\t,JanuaryOriginalPaidAdjustmentDollars\r\n\t\t,FebruaryOriginalPaidAdjustmentDollars\r\n\t\t,MarchOriginalPaidAdjustmentDollars\r\n\t\t,AprilOriginalPaidAdjustmentDollars\r\n\t\t,MayOriginalPaidAdjustmentDollars\r\n\t\t,JuneOriginalPaidAdjustmentDollars\r\n\t\t,FiscalYearToDateOriginalPaidAdjustmentDollars\r\n\t\t,JulyOriginalTotalDueDollars\r\n\t\t,AugustOriginalTotalDueDollars\r\n\t\t,SeptemberOriginalTotalDueDollars\r\n\t\t,OctoberOriginalTotalDueDollars\r\n\t\t,NovemberOriginalTotalDueDollars\r\n\t\t,DecemberOriginalTotalDueDollars\r\n\t\t,JanuaryOriginalTotalDueDollars\r\n\t\t,FebruaryOriginalTotalDueDollars\r\n\t\t,MarchOriginalTotalDueDollars\r\n\t\t,AprilOriginalTotalDueDollars\r\n\t\t,MayOriginalTotalDueDollars\r\n\t\t,JuneOriginalTotalDueDollars\r\n\t\t,FiscalYearToDateOriginalTotalDueDollars\r\n\t\t,JulyOriginalEnergy\r\n\t\t,AugustOriginalEnergy\r\n\t\t,SeptemberOriginalEnergy\r\n\t\t,OctoberOriginalEnergy\r\n\t\t,NovemberOriginalEnergy\r\n\t\t,DecemberOriginalEnergy\r\n\t\t,JanuaryOriginalEnergy\r\n\t\t,FebruaryOriginalEnergy\r\n\t\t,MarchOriginalEnergy\r\n\t\t,AprilOriginalEnergy\r\n\t\t,MayOriginalEnergy\r\n\t\t,JuneOriginalEnergy\r\n\t\t,FiscalYearToDateOriginalEnergyUsage\r\n\t\t,JulyOriginalDemand\r\n\t\t,AugustOriginalDemand\r\n\t\t,SeptemberOriginalDemand\r\n\t\t,OctoberOriginalDemand\r\n\t\t,NovemberOriginalDemand\r\n\t\t,DecemberOriginalDemand\r\n\t\t,JanuaryOriginalDemand\r\n\t\t,FebruaryOriginalDemand\r\n\t\t,MarchOriginalDemand\r\n\t\t,AprilOriginalDemand\r\n\t\t,MayOriginalDemand\r\n\t\t,JuneOriginalDemand\r\n\t\t,FiscalYearToDateOriginalDemand\r\n\t\t,JulyRevisedBilledDollars\r\n\t\t,AugustRevisedBilledDollars\r\n\t\t,SeptemberRevisedBilledDollars\r\n\t\t,OctoberRevisedBilledDollars\r\n\t\t,NovemberRevisedBilledDollars\r\n\t\t,DecemberRevisedBilledDollars\r\n\tFOR xml raw)))\r\n\tWHERE HashValue1 IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.FiscalYearPivotByAgencyDollarsAndUsage\r\n\tSET hashValue2 = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tJanuaryRevisedBilledDollars\r\n\t\t,FebruaryRevisedBilledDollars\r\n\t\t,MarchRevisedBilledDollars\r\n\t\t,AprilRevisedBilledDollars\r\n\t\t,MayRevisedBilledDollars\r\n\t\t,JuneRevisedBilledDollars\r\n\t\t,FiscalYearToDateRevisedBilledDollars\r\n\t\t,JulyRevisedEnergy\r\n\t\t,AugustRevisedEnergy\r\n\t\t,SeptemberRevisedEnergy\r\n\t\t,OctoberRevisedEnergy\r\n\t\t,NovemberRevisedEnergy\r\n\t\t,DecemberRevisedEnergy\r\n\t\t,JanuaryRevisedEnergy\r\n\t\t,FebruaryRevisedEnergy\r\n\t\t,MarchRevisedEnergy\r\n\t\t,AprilRevisedEnergy\r\n\t\t,MayRevisedEnergy\r\n\t\t,JuneRevisedEnergy\r\n\t\t,FiscalYearToDateRevisedEnergy\r\n\t\t,JulyRevisedDemand\r\n\t\t,AugustRevisedDemand\r\n\t\t,SeptemberRevisedDemand\r\n\t\t,OctoberRevisedDemand\r\n\t\t,NovemberRevisedDemand\r\n\t\t,DecemberRevisedDemand\r\n\t\t,JanuaryRevisedDemand\r\n\t\t,FebruaryRevisedDemand\r\n\t\t,MarchRevisedDemand\r\n\t\t,AprilRevisedDemand\r\n\t\t,MayRevisedDemand\r\n\t\t,JuneRevisedDemand\r\n\t\t,FiscalYearToDateRevisedDemand\r\n\t\t,JulyNetDollarChange\r\n\t\t,AugustNetDollarChange\r\n\t\t,SeptemberNetDollarChange\r\n\t\t,OctoberNetDollarChange\r\n\t\t,NovemberNetDollarChange\r\n\t\t,DecemberNetDollarChange\r\n\t\t,JanuaryNetDollarChange\r\n\t\t,FebruaryNetDollarChange\r\n\t\t,MarchNetDollarChange\r\n\t\t,AprilNetDollarChange\r\n\t\t,MayNetDollarChange\r\n\t\t,JuneNetDollarChange\r\n\t\t,FiscalYearToDateNetDollarChange\r\n\t\t,JulyEnergyUsageChange\r\n\t\t,AugustEnergyUsageChange\r\n\t\t,SeptemberEnergyUsageChange\r\n\t\t,OctoberEnergyUsageChange\r\n\t\t,NovemberEnergyUsageChange\r\n\t\t,DecemberEnergyUsageChange\r\n\t\t,JanuaryEnergyUsageChange\r\n\t\t,FebruaryEnergyUsageChange\r\n\t\t,MarchEnergyUsageChange\r\n\t\t,AprilEnergyUsageChange\r\n\t\t,MayEnergyUsageChange\r\n\t\t,JuneEnergyUsageChange\r\n\t\t,FiscalYearToDateNetEnergyUsageChange\r\n\t\t,JulyNetDemandUsageChange\r\n\t\t,AugustNetDemandUsageChange\r\n\t\t,SeptemberNetDemandUsageChange\r\n\t\t,OctoberNetDemandUsageChange\r\n\t\t,NovemberNetDemandUsageChange\r\n\t\t,DecemberNetDemandUsageChange\r\n\t\t,JanuaryNetDemandUsageChange\r\n\t\t,FebruaryNetDemandUsageChange\r\n\t\t,MarchNetDemandUsageChange\r\n\t\t,AprilNetDemandUsageChange\r\n\t\t,MayNetDemandUsageChange\r\n\t\t,JuneNetDemandUsageChange\r\n\t\t,FiscalYearToDateNetDemandUsageChange\r\n\t\t,Notes\r\n\t\t,AuthenticatedUserID\r\n\tFOR xml raw)))\r\n\tWHERE HashValue2 IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.FiscalYearPivotByAgencyFacilityAndAccountDollarsAndUsage\r\n\tSET hashValue1 = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tCurrentFiscalYear\r\n\t\t,PriorFiscalYear\r\n\t\t,BillToAgencyCode\r\n\t\t,AgencyCodeOEC\r\n\t\t,AgencyName\r\n\t\t,OecFacilityNumber\r\n\t\t,FacilityName\r\n\t\t,Address1\r\n\t\t,Borough\r\n\t\t,Block\r\n\t\t,LotNumber\r\n\t\t,CityPlanningBIN\r\n\t\t,CurrentAccountNumber\r\n\t\t,OriginalAccountNumber\r\n\t\t,CurrentInvoiceAccountBillingGroup\r\n\t\t,InvoiceAccountBillingGroupDesc\r\n\t\t,FiscalYear\r\n\t\t,UtilityCompany\r\n\t\t,EnergyType\r\n\t\t,JulyOriginalBilledDollars\r\n\t\t,AugustOriginalBilledDollars\r\n\t\t,SeptemberOriginalBilledDollars\r\n\t\t,OctoberOriginalBilledDollars\r\n\t\t,NovemberOriginalBilledDollars\r\n\t\t,DecemberOriginalBilledDollars\r\n\t\t,JanuaryOriginalBilledDollars\r\n\t\t,FebruaryOriginalBilledDollars\r\n\t\t,MarchOriginalBilledDollars\r\n\t\t,AprilOriginalBilledDollars\r\n\t\t,MayOriginalBilledDollars\r\n\t\t,JuneOriginalBilledDollars\r\n\t\t,FiscalYearToDateOriginalBilledDollars\r\n\t\t,JulyOriginalPaidAdjustmentDollars\r\n\t\t,AugustOriginalPaidAdjustmentDollars\r\n\t\t,SeptemberOriginalPaidAdjustmentDollars\r\n\t\t,OctoberOriginalPaidAdjustmentDollars\r\n\t\t,NovemberOriginalPaidAdjustmentDollars\r\n\t\t,DecemberOriginalPaidAdjustmentDollars\r\n\t\t,JanuaryOriginalPaidAdjustmentDollars\r\n\t\t,FebruaryOriginalPaidAdjustmentDollars\r\n\t\t,MarchOriginalPaidAdjustmentDollars\r\n\t\t,AprilOriginalPaidAdjustmentDollars\r\n\t\t,MayOriginalPaidAdjustmentDollars\r\n\t\t,JuneOriginalPaidAdjustmentDollars\r\n\t\t,FiscalYearToDateOriginalPaidAdjustmentDollars\r\n\t\t,JulyOriginalTotalDueDollars\r\n\t\t,AugustOriginalTotalDueDollars\r\n\t\t,SeptemberOriginalTotalDueDollars\r\n\t\t,OctoberOriginalTotalDueDollars\r\n\t\t,NovemberOriginalTotalDueDollars\r\n\t\t,DecemberOriginalTotalDueDollars\r\n\t\t,JanuaryOriginalTotalDueDollars\r\n\t\t,FebruaryOriginalTotalDueDollars\r\n\t\t,MarchOriginalTotalDueDollars\r\n\t\t,AprilOriginalTotalDueDollars\r\n\t\t,MayOriginalTotalDueDollars\r\n\t\t,JuneOriginalTotalDueDollars\r\n\t\t,FiscalYearToDateOriginalTotalDueDollars\r\n\t\t,JulyOriginalEnergy\r\n\t\t,AugustOriginalEnergy\r\n\t\t,SeptemberOriginalEnergy\r\n\t\t,OctoberOriginalEnergy\r\n\t\t,NovemberOriginalEnergy\r\n\t\t,DecemberOriginalEnergy\r\n\t\t,JanuaryOriginalEnergy\r\n\t\t,FebruaryOriginalEnergy\r\n\t\t,MarchOriginalEnergy\r\n\t\t,AprilOriginalEnergy\r\n\t\t,MayOriginalEnergy\r\n\t\t,JuneOriginalEnergy\r\n\t\t,FiscalYearToDateOriginalEnergyUsage\r\n\t\t,JulyOriginalDemand\r\n\t\t,AugustOriginalDemand\r\n\t\t,SeptemberOriginalDemand\r\n\t\t,OctoberOriginalDemand\r\n\t\t,NovemberOriginalDemand\r\n\t\t,DecemberOriginalDemand\r\n\t\t,JanuaryOriginalDemand\r\n\t\t,FebruaryOriginalDemand\r\n\t\t,MarchOriginalDemand\r\n\t\t,AprilOriginalDemand\r\n\t\t,MayOriginalDemand\r\n\t\t,JuneOriginalDemand\r\n\t\t,FiscalYearToDateOriginalDemand\r\n\t\t,JulyRevisedBilledDollars\r\n\t\t,AugustRevisedBilledDollars\r\n\t\t,SeptemberRevisedBilledDollars\r\n\t\t,OctoberRevisedBilledDollars\r\n\t\t,NovemberRevisedBilledDollars\r\n\t\t,DecemberRevisedBilledDollars\r\n\tFOR xml raw)))\r\n\tWHERE HashValue1 IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.FiscalYearPivotByAgencyFacilityAndAccountDollarsAndUsage\r\n\tSET hashValue2 = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tJanuaryRevisedBilledDollars\r\n\t\t,FebruaryRevisedBilledDollars\r\n\t\t,MarchRevisedBilledDollars\r\n\t\t,AprilRevisedBilledDollars\r\n\t\t,MayRevisedBilledDollars\r\n\t\t,JuneRevisedBilledDollars\r\n\t\t,FiscalYearToDateRevisedBilledDollars\r\n\t\t,JulyRevisedEnergy\r\n\t\t,AugustRevisedEnergy\r\n\t\t,SeptemberRevisedEnergy\r\n\t\t,OctoberRevisedEnergy\r\n\t\t,NovemberRevisedEnergy\r\n\t\t,DecemberRevisedEnergy\r\n\t\t,JanuaryRevisedEnergy\r\n\t\t,FebruaryRevisedEnergy\r\n\t\t,MarchRevisedEnergy\r\n\t\t,AprilRevisedEnergy\r\n\t\t,MayRevisedEnergy\r\n\t\t,JuneRevisedEnergy\r\n\t\t,FiscalYearToDateRevisedEnergy\r\n\t\t,JulyRevisedDemand\r\n\t\t,AugustRevisedDemand\r\n\t\t,SeptemberRevisedDemand\r\n\t\t,OctoberRevisedDemand\r\n\t\t,NovemberRevisedDemand\r\n\t\t,DecemberRevisedDemand\r\n\t\t,JanuaryRevisedDemand\r\n\t\t,FebruaryRevisedDemand\r\n\t\t,MarchRevisedDemand\r\n\t\t,AprilRevisedDemand\r\n\t\t,MayRevisedDemand\r\n\t\t,JuneRevisedDemand\r\n\t\t,FiscalYearToDateRevisedDemand\r\n\t\t,JulyNetDollarChange\r\n\t\t,AugustNetDollarChange\r\n\t\t,SeptemberNetDollarChange\r\n\t\t,OctoberNetDollarChange\r\n\t\t,NovemberNetDollarChange\r\n\t\t,DecemberNetDollarChange\r\n\t\t,JanuaryNetDollarChange\r\n\t\t,FebruaryNetDollarChange\r\n\t\t,MarchNetDollarChange\r\n\t\t,AprilNetDollarChange\r\n\t\t,MayNetDollarChange\r\n\t\t,JuneNetDollarChange\r\n\t\t,FiscalYearToDateNetDollarChange\r\n\t\t,JulyEnergyUsageChange\r\n\t\t,AugustEnergyUsageChange\r\n\t\t,SeptemberEnergyUsageChange\r\n\t\t,OctoberEnergyUsageChange\r\n\t\t,NovemberEnergyUsageChange\r\n\t\t,DecemberEnergyUsageChange\r\n\t\t,JanuaryEnergyUsageChange\r\n\t\t,FebruaryEnergyUsageChange\r\n\t\t,MarchEnergyUsageChange\r\n\t\t,AprilEnergyUsageChange\r\n\t\t,MayEnergyUsageChange\r\n\t\t,JuneEnergyUsageChange\r\n\t\t,FiscalYearToDateNetEnergyUsageChange\r\n\t\t,JulyNetDemandUsageChange\r\n\t\t,AugustNetDemandUsageChange\r\n\t\t,SeptemberNetDemandUsageChange\r\n\t\t,OctoberNetDemandUsageChange\r\n\t\t,NovemberNetDemandUsageChange\r\n\t\t,DecemberNetDemandUsageChange\r\n\t\t,JanuaryNetDemandUsageChange\r\n\t\t,FebruaryNetDemandUsageChange\r\n\t\t,MarchNetDemandUsageChange\r\n\t\t,AprilNetDemandUsageChange\r\n\t\t,MayNetDemandUsageChange\r\n\t\t,JuneNetDemandUsageChange\r\n\t\t,FiscalYearToDateNetDemandUsageChange\r\n\t\t,JulyActualOrEstimated\r\n\t\t,AugustActualOrEstimated\r\n\t\t,SeptemberActualOrEstimated\r\n\t\t,OctoberActualOrEstimated\r\n\t\t,NovemberActualOrEstimated\r\n\t\t,DecemberActualOrEstimated\r\n\t\t,JanuaryActualOrEstimated\r\n\t\t,FebruaryActualOrEstimated\r\n\t\t,MarchActualOrEstimated\r\n\t\t,AprilActualOrEstimated\r\n\t\t,MayActualOrEstimated\r\n\t\t,JuneActualOrEstimated\r\n\t\t,Notes\r\n\t\t,AuthenticatedUserID\r\n\tFOR xml raw)))\r\n\tWHERE HashValue2 IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\n\r\n\tUPDATE Published.FiscalYearPivotByEncoreMonthlyPayments\r\n\tSET hashValue = (SELECT hashbytes('md5', (\r\n\tSELECT\r\n\t\tFiscalYear\r\n\t\t,JulyEncoreMonthlyDollars\r\n\t\t,AugustEncoreMonthlyDollars\r\n\t\t,SeptemberEncoreMonthlyDollars\r\n\t\t,OctoberEncoreMonthlyDollars\r\n\t\t,NovemberEncoreMonthlyDollars\r\n\t\t,DecemberEncoreMonthlyDollars\r\n\t\t,JanuaryEncoreMonthlyDollars\r\n\t\t,FebruaryEncoreMonthlyDollars\r\n\t\t,MarchEncoreMonthlyDollars\r\n\t\t,AprilEncoreMonthlyDollars\r\n\t\t,MayEncoreMonthlyDollars\r\n\t\t,JuneEncoreMonthlyDollars\r\n\t\t,FiscalYearToDateEncoreMonthlyDollars\r\n\t\t,Notes\r\n\t\t,AuthenticatedUserID\r\n\tFOR xml raw)))\r\n\tWHERE HashValue IS NULL AND PublishedBillingPeriod=@PublishedBillingPeriod;\r\nEND;"
        }
      ]
    }
  ]
}