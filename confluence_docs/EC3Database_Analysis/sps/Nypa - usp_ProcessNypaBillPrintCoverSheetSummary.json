{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Nypa",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_ProcessNypaBillPrintCoverSheetSummary",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_ProcessNypaBillPrintCoverSheetSummary",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to process and insert new cover sheet billing records into a specific table, "
        },
        {
          "type": "text",
          "text": "Voucher.NypaBillPrintCoverSheetNypaSap",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", from another table, "
        },
        {
          "type": "text",
          "text": "Nypa.UploadNYPACoverSheet",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ". The procedure is part of a billing system for a utility company, handling the insertion of billing data related to energy consumption, demand, and various financial adjustments. It also manages standby demand information, which was added in a revision."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity of this stored procedure is considered medium due to the following factors:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It involves a straightforward data insertion operation from one table to another."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It handles multiple fields, including financial calculations and adjustments."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It uses conditional logic with "
                },
                {
                  "type": "text",
                  "text": "ISNULL",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to handle potential null values."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It involves a significant number of columns, which increases the complexity of ensuring data integrity and correctness."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@StatusCode INT OUTPUT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This is an output parameter used to indicate the execution status of the procedure. It is set to "
                },
                {
                  "type": "text",
                  "text": "0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " for success and "
                },
                {
                  "type": "text",
                  "text": "9",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " for failure, although the failure condition is not explicitly handled in the provided code."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "orderedList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Initialization",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure begins by declaring two variables, "
                },
                {
                  "type": "text",
                  "text": "@OriginalBillDeliveryMinimumFromDate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and "
                },
                {
                  "type": "text",
                  "text": "@OriginalBillDeliveryMaximumToDate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", which are not used in the current logic. The "
                },
                {
                  "type": "text",
                  "text": "@StatusCode",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is initialized to "
                },
                {
                  "type": "text",
                  "text": "0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", indicating a successful execution by default."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Insertion",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The core operation is an "
                },
                {
                  "type": "text",
                  "text": "INSERT INTO ... SELECT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " statement that transfers data from "
                },
                {
                  "type": "text",
                  "text": "Nypa.UploadNYPACoverSheet",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to "
                },
                {
                  "type": "text",
                  "text": "Voucher.NypaBillPrintCoverSheetNypaSap",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". The fields being inserted include various billing and financial metrics, such as energy consumption, demand, and cost adjustments."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Handling Null Values",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure uses "
                },
                {
                  "type": "text",
                  "text": "ISNULL",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to replace null values with "
                },
                {
                  "type": "text",
                  "text": "0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " for specific fields like "
                },
                {
                  "type": "text",
                  "text": "EnergyKilowattHours",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", "
                },
                {
                  "type": "text",
                  "text": "DemandCommodityKilowatts",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", and "
                },
                {
                  "type": "text",
                  "text": "DemandDeliveryKilowatts",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", ensuring that null values do not cause issues during insertion."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Standby Information",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure includes fields related to standby demand, which were added in a revision. These fields handle standby contract demand and daily demand metrics, both net and canceled."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Bulk Insert",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure performs a bulk insert operation, which is generally efficient. However, the performance can be affected by the size of the data being inserted and the indexes on the target table."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Indexing",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Ensure that the target table, "
                },
                {
                  "type": "text",
                  "text": "Voucher.NypaBillPrintCoverSheetNypaSap",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", is properly indexed to optimize the insertion process and subsequent queries."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Transaction Management",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure does not explicitly manage transactions. If the insertion fails, it could leave the database in an inconsistent state. Consider wrapping the operation in a transaction to ensure atomicity."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Unused Variables",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The declared variables "
                },
                {
                  "type": "text",
                  "text": "@OriginalBillDeliveryMinimumFromDate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and "
                },
                {
                  "type": "text",
                  "text": "@OriginalBillDeliveryMaximumToDate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " are not used, which could indicate incomplete logic or a need for future enhancements."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure lacks explicit error handling. If an error occurs during the insertion, the "
                },
                {
                  "type": "text",
                  "text": "@StatusCode",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " will not reflect the failure, and the procedure will not roll back any partial changes."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Integrity",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure assumes that the data in "
                },
                {
                  "type": "text",
                  "text": "Nypa.UploadNYPACoverSheet",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is valid and complete. Any issues with the source data could lead to incorrect or incomplete records in the target table."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Scalability",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": As the volume of data grows, the performance of the procedure may degrade if not properly optimized with indexing and efficient query design."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE  PROCEDURE [Nypa].[usp_ProcessNypaBillPrintCoverSheetSummary]\n    (\r\n\r\n     @StatusCode INT OUTPUT\r\n    )\r\nAS --**************************************************************************************\r\n--* Name:         \r\n--*\r\n--* Description:  Get the new coversheet record types prior to loading the coversheet then load the coversheet.\r\n--*               \r\n--*               \r\n--*               \r\n--* Exec:       usp_GetNewCoverSheetRecordTypes\r\n--*\r\n--* Parameter(s):         \r\n--*                            UtilityCompanySeqid integer   \t - Current Utility Company that provides an electronic coversheet\r\n--*                            StatusCode  int output      \t -  Execution Return Status \r\n--*\r\n--                     Step 01)      Insert the new Cover sheet billing types\r\n--                     Step 02)      Get the original bills minimum Delivery From Date and  the maximum Delivery To Date for the billing period.\r\n--                     Step 03)      Insert the new Cover sheet billing items\r\n--*\r\n--* Database:     OEC\r\n--*\r\n--* Return:\t    0 Success\r\n--*                   9 Failure\r\n--*\r\n--* AUTHOR:       Peter Heller (PAH)\r\n--* Created On:   10/26/2005\r\n--**************************************************************************************\r\n--* Date         Tech Description of Change\r\n--* ---------- ----  -------------------------------------------------------------\r\n--* 10/26/2005 PAH  First Version  \r\n--* 04/14/2015 PAH  Revised to Add Standby information\r\n--*\t\t\t\t\t\tStandbyContractDemand\r\n--*\t\t\t\t\t\tCancelStandbyContractDemand\r\n--*\t\t\t\t\t\tNetStandbyContractDemand\r\n--*\t\t\t\t\t\tStandbyAsUsedDailyDemand\r\n--*\t\t\t\t\t\tCancelStandbyAsUsedDailyDemand\r\n--*\t\t\t\t\t\tNetBilledStandbyAsUsedDailyDemand\r\n--***************************************************************************************\r\n    BEGIN \r\n--************************************************************************************** \r\n--Declare Variables                                            \r\n--**************************************************************************************\r\n--\r\n        DECLARE @OriginalBillDeliveryMinimumFromDate VARCHAR(8)\r\n        DECLARE @OriginalBillDeliveryMaximumToDate VARCHAR(8)\r\n--\r\n--**************************************************************************************  \r\n--SET DEFAULTS                                                  \r\n--**************************************************************************************\r\n--\r\n--**************************************************************************************  \r\n--Main Process                                      \r\n--**************************************************************************************\r\n--\r\n        SET @StatusCode = 0\r\n        INSERT  INTO Voucher.NypaBillPrintCoverSheetNypaSap\r\n                ( UtilityCompanySeqid\r\n                ,InvoiceAcountBillingGroupSeqid\r\n                ,BillingPeriod\r\n                ,NypaCoverSheetRecordType\r\n                ,NypaCoverSheetDescription\r\n                ,EnergyKilowattHours\r\n                ,DemandCommodityKilowatts\r\n                ,DemandDeliveryKilowatts\r\n                ,ConsumptionCommodityKilowatts\r\n                ,ConsumptionDeliveryKilowatts\r\n                ,TotalDollars\r\n                ,IsMiscellaneousCharge\r\n                ,NetEnergyCostAdjustmentDollars\r\n                ,NetConsumptionDeliveryDollars\r\n                ,CancelEnergyCostAdjustmentDollars\r\n                ,NetMinimumBilledDemandDollars\r\n                ,NetDemandDeliveryKilowatts\r\n                ,NetConsumptionCommodityDollars\r\n                ,EnergyCostAdjustmentDollars\r\n                ,CancelMinimumBilledDemandDollars\r\n                ,NetDemandCommodityKilowatts\r\n                ,PrintSequenceNumber\r\n                ,GrossReceiptTaxDollars\r\n                ,NetGrossReceiptTaxDollars\r\n                ,CancelEnergyKilowattHours\r\n                ,CancelDemandCommodityKilowatts\r\n                ,CancelDemandDeliveryKilowatts\r\n                ,MinimumBilledDemandDollars\r\n                ,CancelConsumptionCommodityDollars\r\n                ,CancelConsumptionDeliveryDollars\r\n                ,CancelGrossReceiptTaxDollars\r\n                ,NetEnergyKilowattHours\r\n                ,AuthenticatedUserID\r\n                ,DateAdded\r\n                ,LastUpdate\r\n                ,Notes\r\n                ,IsDcasMiscellaneousCharges\r\n                ,MinimumBilledDeliveryDollars\r\n                ,CancelMinimumBilledDeliveryDollars\r\n                ,NetMinimumBilledDeliveryDollars\r\n                ,StandbyContractDemand\r\n                ,CancelStandbyContractDemand\r\n                ,NetStandbyContractDemand\r\n                ,StandbyAsUsedDailyDemand\r\n                ,CancelStandbyAsUsedDailyDemand\r\n                ,NetBilledStandbyAsUsedDailyDemand\r\n                )\r\n        SELECT  CoverSheetUtilityCompany\r\n        ,       CoverSheetAccountBillingGroup\r\n        ,       BillingPeriod\r\n        ,       CoverSheetRecordType\r\n        ,       CoverSheetRecordDesc\r\n        ,       ISNULL(EnergyKilowattHours, 0)\r\n        ,       ISNULL(DemandCommodityKilowatts, 0)\r\n        ,       ISNULL(DemandDeliveryKilowatts, 0)\r\n        ,       ConsumptionCommodityDollars\r\n        ,       ConsumptionDeliveryDollars\r\n        ,       TotalDollars\r\n        ,       MiscellaneousCharges\r\n        ,       NetEnergyCostAdjustmentDollars\r\n        ,       NetConsumptionDeliveryDollars\r\n        ,       CancelEnergyCostAdjustmentDollars\r\n        ,       NetMinimumBilledDemandDollars\r\n        ,       NetDemandDeliveryKilowatts\r\n        ,       NetConsumptionCommodityDollars\r\n        ,       EnergyCostAdjustmentDollars\r\n        ,       CancelMinimumBilledDemandDollars\r\n        ,       NetDemandCommodityKilowatts\r\n        ,       PrintSequenceNumber\r\n        ,       GrossReceiptTaxDollars\r\n        ,       NetGrossReceiptTaxDollars\r\n        ,       CancelEnergyKilowattHours\r\n        ,       CancelDemandCommodityKilowatts\r\n        ,       CancelDemandDeliveryKilowatts\r\n        ,       MinimumBilledDemandDollars\r\n        ,       CancelConsumptionCommodityDollars\r\n        ,       CancelConsumptionDeliveryDollars\r\n        ,       CancelGrossReceiptTaxDollars\r\n        ,       NetEnergyKilowattHours\r\n        ,       AuthenticatedUserID\r\n        ,       DateAdded\r\n        ,       LastUpdate\r\n        ,       Notes\r\n        ,       IsDcasMiscellaneousCharges\r\n        ,       MinimumBilledDeliveryDollars\r\n        ,       CancelMinimumBilledDeliveryDollars\r\n        ,       NetMinimumBilledDeliveryDollars\r\n        ,       StandbyContractDemand\r\n        ,       CancelStandbyContractDemand\r\n        ,       NetStandbyContractDemand\r\n        ,       StandbyAsUsedDailyDemand\r\n        ,       CancelStandbyAsUsedDailyDemand\r\n        ,       NetBilledStandbyAsUsedDailyDemand\r\n        FROM Nypa.UploadNYPACoverSheet\r\n    END"
        }
      ]
    }
  ]
}