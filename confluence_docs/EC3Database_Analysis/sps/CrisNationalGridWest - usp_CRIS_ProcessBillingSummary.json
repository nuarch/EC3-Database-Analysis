{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "CrisNationalGridWest",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_CRIS_ProcessBillingSummary",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Low",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_CRIS_ProcessBillingSummary",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to process billing summary data by inserting records from the "
        },
        {
          "type": "text",
          "text": "CrisNationalGridWest.UploadBillingSummary",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table into the "
        },
        {
          "type": "text",
          "text": "Voucher.CrisNationalGridWestBillingSummary",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table. It is part of the "
        },
        {
          "type": "text",
          "text": "CrisNationalGridWest",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " schema within the "
        },
        {
          "type": "text",
          "text": "OEC",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " database. The procedure takes an authenticated user ID as input and outputs a status code indicating success or failure."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Low"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level of this stored procedure is low. It primarily performs a straightforward data insertion operation from one table to another without any conditional logic, loops, or complex transformations."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@AuthenticatedUserID int",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This parameter represents the ID of the user who is authenticated and executing the procedure. It is used to track who performed the operation."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@StatusCode int OUTPUT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This is an output parameter that returns the execution status of the procedure. It is set to "
                },
                {
                  "type": "text",
                  "text": "0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to indicate success."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Insertion",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The core functionality of the procedure is to insert data from the "
                },
                {
                  "type": "text",
                  "text": "CrisNationalGridWest.UploadBillingSummary",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table into the "
                },
                {
                  "type": "text",
                  "text": "Voucher.CrisNationalGridWestBillingSummary",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table. The columns in both tables are matched directly, indicating that the schema of the source and destination tables is identical or compatible."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Status Code Setting",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": After the insertion operation, the "
                },
                {
                  "type": "text",
                  "text": "@StatusCode",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is set to "
                },
                {
                  "type": "text",
                  "text": "0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", indicating that the procedure completed successfully. There is no error handling or alternative status codes defined within the procedure."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Bulk Insert",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure performs a bulk insert operation, which can be efficient if the "
                },
                {
                  "type": "text",
                  "text": "UploadBillingSummary",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table contains a large number of records. However, the performance will depend on the size of the data and the indexes on the destination table."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Indexing",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Ensure that the "
                },
                {
                  "type": "text",
                  "text": "Voucher.CrisNationalGridWestBillingSummary",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table is appropriately indexed to handle large insert operations efficiently. This can help in maintaining performance, especially if the table is queried frequently after data insertion."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Transaction Management",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure does not explicitly manage transactions. If the insert operation fails, it could leave the database in an inconsistent state. Consider wrapping the insert operation in a transaction to ensure atomicity."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Lack of Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure does not include any error handling mechanisms. If the insert operation fails due to constraints or other issues, the procedure will not capture or report the error, and the "
                },
                {
                  "type": "text",
                  "text": "@StatusCode",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " will still be set to "
                },
                {
                  "type": "text",
                  "text": "0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Integrity",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Without validation or checks, there is a risk of inserting invalid or duplicate data into the "
                },
                {
                  "type": "text",
                  "text": "Voucher.CrisNationalGridWestBillingSummary",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table. Implementing data validation or constraints could mitigate this risk."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Concurrency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If multiple users execute this procedure simultaneously, it could lead to concurrency issues, especially if the "
                },
                {
                  "type": "text",
                  "text": "UploadBillingSummary",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table is being modified concurrently. Consider implementing locking mechanisms if necessary."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Scalability",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": As the volume of data grows, the procedure may need optimization to handle larger datasets efficiently. This could involve partitioning the tables or optimizing the insert operation further."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "create PROCEDURE [CrisNationalGridWest].[usp_CRIS_ProcessBillingSummary] @AuthenticatedUserID int , @StatusCode int  OUTPUT\n   \r\nAS \r\n--**************************************************************************************\r\n--* Name:         \r\n--*\r\n--* Description:  \r\n--*               \r\n--*               \r\n--*               \r\n--* Exec:         [CrisNationalGridWest].[usp_CrisTransformUploadedData]\r\n--*\r\n--* Parameter(s):         \r\n--*                            StatusCode  int output       \t   -  Execution Return Status \r\n--*\r\n--* Database:     OEC\r\n--*\r\n--* Return:\t    0 Success\r\n--*                   9 Failure\r\n--*\r\n--* AUTHOR:       Peter Heller (PAH)\r\n--* Created On:   10/17/2006\r\n--**************************************************************************************\r\n--* Date         Tech Description of Change\r\n--* ---------- ----  -------------------------------------------------------------\r\n--* 11/24/2009 PAH  First Version  \r\n--***************************************************************************************\r\nBegin \r\n--************************************************************************************** \r\n--Declare Variables                                            \r\n--**************************************************************************************\r\n\r\n--************************************************************************************** \r\n--\tDeclare Cursor\r\n--**************************************************************************************\r\n--\r\n--************************************************************************************** \r\n--\tMain Processing\r\n--**************************************************************************************\r\n--\r\n--\tInsert Applied payment details to the prior months account billing row\r\n--\r\nINSERT INTO Voucher.CrisNationalGridWestBillingSummary\r\n\t\t(UtilityCompanySeqid, InvoiceBillingGroup, BillingPeriod, OriginalAdjustment, GasRateCode, TotalBilledAmount, TotalCanceledAmount, \r\n\t\tTotalNetAmount, TotalBilledCCF, TotalCanceledCCF, TotalNetCCF, TotalBilledTherms, TotalCanceledTherms, TotalNetTherms, \r\n\t\tTotalBilledMTACommodityTax, TotalBilledMTADeliveryTax, TotalBilledDeliveryChargeAmount, TotalBilledCommodityChargeAmount, \r\n\t\tTotalBilledSalesTax, TotalBilledSystemBenefitsCharge, TotalBilledRetailDecouplingMechanismCharge, TotalDeliveryRateSurcharge, \r\n\t\tTotalRealTimeNormalizationCharge, TotalBilledPaperBillCharge, TotalCanceledMTACommodityTax, TotalCanceledMTADeliveryTax, \r\n\t\tTotalCanceledDeliveryChargeAmount, TotalCanceledCommodityChargeAmount, TotalCanceledSalesTax, TotalCanceledSystemBenefitsCharge, \r\n\t\tTotalCanceledRetailDecouplingMechanismCharge, TotalCanceledDeliveryRateSurcharge, TotalCanceledRealTimeNormalizationCharge, \r\n\t\tTotalCanceledPaperBillCharge, TotalNetMTACommodityTax, TotalNetMTADeliveryTax, TotalNetDeliveryChargeAmount, \r\n\t\tTotalNetCommodityChargeAmount, TotalNetSalesTax, TotalNetSystemBenefitsCharge, TotalNetRetailDecouplingMechanismCharge, \r\n\t\tTotalNetDeliveryRateSurcharge, TotalNetRealTimeNormalizationCharge, TotalNetPaperBillCharge, TotalPaymentsPosted, TotalNetCredits, \r\n\t\tTotalNetCreditsFinalledAccounts, FireAuditTrigger, Notes, AuthenticatedUserID, DateAdded, LastUpdate)\r\nselect \r\n\t\tUtilityCompanySeqid, InvoiceBillingGroup, BillingPeriod, OriginalAdjustment, GasRateCode, TotalBilledAmount, TotalCanceledAmount, \r\n\t\tTotalNetAmount, TotalBilledCCF, TotalCanceledCCF, TotalNetCCF, TotalBilledTherms, TotalCanceledTherms, TotalNetTherms, \r\n\t\tTotalBilledMTACommodityTax, TotalBilledMTADeliveryTax, TotalBilledDeliveryChargeAmount, TotalBilledCommodityChargeAmount, \r\n\t\tTotalBilledSalesTax, TotalBilledSystemBenefitsCharge, TotalBilledRetailDecouplingMechanismCharge, TotalDeliveryRateSurcharge, \r\n\t\tTotalRealTimeNormalizationCharge, TotalBilledPaperBillCharge, TotalCanceledMTACommodityTax, TotalCanceledMTADeliveryTax, \r\n\t\tTotalCanceledDeliveryChargeAmount, TotalCanceledCommodityChargeAmount, TotalCanceledSalesTax, TotalCanceledSystemBenefitsCharge, \r\n\t\tTotalCanceledRetailDecouplingMechanismCharge, TotalCanceledDeliveryRateSurcharge, TotalCanceledRealTimeNormalizationCharge, \r\n\t\tTotalCanceledPaperBillCharge, TotalNetMTACommodityTax, TotalNetMTADeliveryTax, TotalNetDeliveryChargeAmount, \r\n\t\tTotalNetCommodityChargeAmount, TotalNetSalesTax, TotalNetSystemBenefitsCharge, TotalNetRetailDecouplingMechanismCharge, \r\n\t\tTotalNetDeliveryRateSurcharge, TotalNetRealTimeNormalizationCharge, TotalNetPaperBillCharge, TotalPaymentsPosted, TotalNetCredits, \r\n\t\tTotalNetCreditsFinalledAccounts, FireAuditTrigger, Notes, AuthenticatedUserID, DateAdded, LastUpdate\r\nfrom CrisNationalGridWest.UploadBillingSummary\r\n--\r\nset @StatusCode = 0\r\n--\r\nend"
        }
      ]
    }
  ]
}