{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Published",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "PrePublishing_NypaAccountBilledESTOrACTcorrection",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "PrePublishing_NypaAccountBilledESTOrACTcorrection",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to correct discrepancies in the billing data for New York Power Authority (NYPA) accounts. Specifically, it addresses a programming error where the billing status ("
        },
        {
          "type": "text",
          "text": "ESTOrACT",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ") is incorrectly set to values other than 'ACT' (Actual) or 'EST' (Estimated). The procedure updates these incorrect values to 'ACT' and ensures consistency between the "
        },
        {
          "type": "text",
          "text": "MeterBillingAdjustmentElectric",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " and "
        },
        {
          "type": "text",
          "text": "AccountBilling",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " tables. It also logs the corrections in a temporary table and updates the "
        },
        {
          "type": "text",
          "text": "AccountBilling",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table accordingly."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The procedure involves multiple SQL operations, including "
        },
        {
          "type": "text",
          "text": "SELECT",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "UPDATE",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "JOIN",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", and "
        },
        {
          "type": "text",
          "text": "GROUP BY",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " clauses, as well as the use of a temporary table. The complexity arises from the need to ensure data consistency across multiple related tables and the use of aggregate functions and conditional logic."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The procedure does not take any input parameters. It operates on the entire dataset within the specified tables, focusing on records where the billing period is greater than '200712'."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "orderedList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Initial Data Selection",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": "
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "The procedure first selects records from the "
                        },
                        {
                          "type": "text",
                          "text": "MeterBillingAdjustmentElectric",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " table where "
                        },
                        {
                          "type": "text",
                          "text": "ESTOrACT",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " is not 'ACT' or 'EST'. This identifies records with incorrect billing status."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Correction",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "It updates these records, setting "
                        },
                        {
                          "type": "text",
                          "text": "ESTOrACT",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " to 'ACT' to correct the error."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Consistency Check",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "The procedure performs a complex query to join "
                        },
                        {
                          "type": "text",
                          "text": "Account",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ", "
                        },
                        {
                          "type": "text",
                          "text": "MeterBillingAdjustmentElectric",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ", and "
                        },
                        {
                          "type": "text",
                          "text": "AccountExchangeMeterTrack",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " tables to aggregate billing data."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "It compares this aggregated data with the "
                        },
                        {
                          "type": "text",
                          "text": "AccountBilling",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " table to identify discrepancies in the "
                        },
                        {
                          "type": "text",
                          "text": "ActualOrEstimated",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " field."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Temporary Table Creation",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Discrepancies are logged into a temporary table "
                        },
                        {
                          "type": "text",
                          "text": "#NYPAESTOrACT",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " for further processing."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Final Update",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "The "
                        },
                        {
                          "type": "text",
                          "text": "AccountBilling",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " table is updated using the data from the temporary table to correct the "
                        },
                        {
                          "type": "text",
                          "text": "ActualOrEstimated",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " field."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "Additional fields such as "
                        },
                        {
                          "type": "text",
                          "text": "FireAuditTrigger",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " and "
                        },
                        {
                          "type": "text",
                          "text": "Notes",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " are updated to reflect the correction."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Cleanup",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "The temporary table "
                        },
                        {
                          "type": "text",
                          "text": "#NYPAESTOrACT",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " is dropped at the end of the procedure."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Index Usage",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Ensure that the relevant columns used in "
                },
                {
                  "type": "text",
                  "text": "JOIN",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and "
                },
                {
                  "type": "text",
                  "text": "WHERE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " clauses are indexed to improve query performance."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Temporary Table",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The use of a temporary table can impact performance, especially if the dataset is large. Consider optimizing the query to minimize the size of the temporary table."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Batch Processing",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If the dataset is large, consider processing the updates in batches to reduce locking and improve concurrency."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Integrity",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure assumes that setting "
                },
                {
                  "type": "text",
                  "text": "ESTOrACT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to 'ACT' is the correct correction for all records. This may not be accurate for all cases, and additional validation may be necessary."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Concurrency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure updates multiple records, which could lead to locking issues in a high-concurrency environment."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure lacks explicit error handling. Consider adding try-catch blocks to handle potential runtime errors gracefully."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hardcoded Values",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure uses hardcoded values (e.g., '200712') which may need to be updated over time or parameterized for flexibility."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE    procedure [Published].[PrePublishing_NypaAccountBilledESTOrACTcorrection]\nas --**************************************************************************************\r\n--* Name:         \r\n--*\r\n--* Description:  Corrected programming error: Accountbilling from Actual to Estimated for NYPA\r\n--*               \r\n--* Exec:        PrePublishing_NypaAccountBilledESTOrACTcorrection\r\n--*\r\n--* Parameter(s):         \r\n--*\r\n--*\r\n--* Database:     OEC\r\n--*\r\n--* Return:\t    \r\n--*             \r\n--*\r\n--* AUTHOR:       Peter Heller (PAH)\r\n--* Created On:   06/06/2014\r\n--**************************************************************************************\r\n--* Date         Tech Description of Change\r\n--* ---------- ----  -------------------------------------------------------------\r\n--* 06/06/2014 PAH  First Version  \r\n--***************************************************************************************\r\n    begin \r\n--************************************************************************************** \r\n--Declare Variables                                            \r\n--**************************************************************************************    \r\n\r\n\r\n--**************************************************************************************    \r\n\r\n        select  BillingPeriod\r\n        ,       ESTOrACT\r\n        ,       BillingPeriodRevision\r\n        FROM Billing.MeterBillingAdjustmentElectric\r\n        where   ESTOrACT not in ( 'ACT', 'EST' )\r\n\r\n        update  Billing.MeterBillingAdjustmentElectric\r\n        set     ESTOrACT = 'ACT'\r\n        where   ( ESTOrACT not in ( 'ACT', 'EST' ) )\r\n\r\n        select  ESTOrACT.AccountSeqid\r\n        ,       BillingPeriod\r\n        ,       ESTOrACT.BillingPeriodRevision\r\n        ,       AccountBilledESTOrACT\r\n        ,       NumberOfMeters\r\n        ,       ab.AccountSeqid\r\n        ,       LastPeriodModified\r\n        ,       ActualOrEstimated\r\n        ,       ab.BillingPeriodRevision\r\n        FROM ( select    Billing.Account.AccountSeqid\r\n                  ,         Billing.MeterBillingAdjustmentElectric.BillingPeriod\r\n                  ,         Billing.MeterBillingAdjustmentElectric.BillingPeriodRevision\r\n                  ,         max(Billing.MeterBillingAdjustmentElectric.ESTOrACT) as AccountBilledESTOrACT\r\n                  ,         count(*) as NumberOfMeters\r\n                  FROM   Billing.Account\r\n                            inner join Billing.MeterBillingAdjustmentElectric on Billing.Account.AccountSeqid = Billing.MeterBillingAdjustmentElectric.AccountBilled\r\n                            inner join Billing.AccountExchangeMeterTrack on Billing.Account.AccountSeqid = Billing.AccountExchangeMeterTrack.OriginalAccountSeqid\r\n                                                              and Billing.MeterBillingAdjustmentElectric.AccountExchangeMeterTrackSeqid = Billing.AccountExchangeMeterTrack.AccountExchangeMeterTrackSeqid\r\n                  WHERE Billing.MeterBillingAdjustmentElectric.BillingPeriod > '200712'\r\n                  group by  Billing.Account.AccountSeqid\r\n                  ,         Billing.MeterBillingAdjustmentElectric.BillingPeriod\r\n                  ,         Billing.MeterBillingAdjustmentElectric.BillingPeriodRevision\r\n                ) as ESTOrACT\r\n                inner join ( select Billing.Account.AccountSeqid\r\n                             ,      Billing.AccountBilling.LastPeriodModified\r\n                             ,      Billing.AccountBilling.ActualOrEstimated\r\n                             ,      Billing.AccountBilling.BillingPeriodRevision\r\n                             FROM Billing.Account\r\n                                    inner join Billing.AccountBilling on Billing.AccountBilling.AccountSeqid = Billing.Account.AccountSeqid\r\n                           ) ab on ab.AccountSeqid = ESTOrACT.AccountSeqid\r\n                                   and ab.BillingPeriodRevision = ESTOrACT.BillingPeriodRevision\r\n                                   and ab.LastPeriodModified = ESTOrACT.BillingPeriod\r\n        where   ab.ActualOrEstimated <> ESTOrACT.AccountBilledESTOrACT\r\n\r\n\r\n        select  --ESTOrACT.AccountSeqid ,\r\n                BillingPeriod\r\n        ,\r\n        --ESTOrACT.BillingPeriodRevision ,\r\n                AccountBilledESTOrACT\r\n        ,       NumberOfMeters\r\n        ,       ab.AccountSeqid\r\n        ,       ab.AccountBillingSeqid\r\n        ,       LastPeriodModified\r\n        ,       ActualOrEstimated\r\n        ,       ab.BillingPeriodRevision\r\n        into    #NYPAESTOrACT\r\n        FROM ( select    Billing.Account.AccountSeqid\r\n                  ,         Billing.MeterBillingAdjustmentElectric.BillingPeriod\r\n                  ,         Billing.MeterBillingAdjustmentElectric.BillingPeriodRevision\r\n                  ,         max(Billing.MeterBillingAdjustmentElectric.ESTOrACT) as AccountBilledESTOrACT\r\n                  ,         count(*) as NumberOfMeters\r\n                  FROM   Billing.Account\r\n                            inner join Billing.MeterBillingAdjustmentElectric on Billing.Account.AccountSeqid = Billing.MeterBillingAdjustmentElectric.AccountBilled\r\n                            inner join Billing.AccountExchangeMeterTrack on Billing.Account.AccountSeqid = Billing.AccountExchangeMeterTrack.OriginalAccountSeqid\r\n                                                              and Billing.MeterBillingAdjustmentElectric.AccountExchangeMeterTrackSeqid = Billing.AccountExchangeMeterTrack.AccountExchangeMeterTrackSeqid\r\n                  WHERE Billing.MeterBillingAdjustmentElectric.BillingPeriod > '200712'\r\n                  group by  Billing.Account.AccountSeqid\r\n                  ,         Billing.MeterBillingAdjustmentElectric.BillingPeriod\r\n                  ,         Billing.MeterBillingAdjustmentElectric.BillingPeriodRevision\r\n                ) as ESTOrACT\r\n                inner join ( select Billing.Account.AccountSeqid\r\n                             ,      Billing.AccountBilling.AccountBillingSeqid\r\n                             ,      Billing.AccountBilling.LastPeriodModified\r\n                             ,      Billing.AccountBilling.ActualOrEstimated\r\n                             ,      Billing.AccountBilling.BillingPeriodRevision\r\n                             FROM Billing.Account\r\n                                    inner join Billing.AccountBilling on Billing.AccountBilling.AccountSeqid = Billing.Account.AccountSeqid\r\n                             where  Billing.AccountBilling.BillingPeriod > '200712'\r\n                           ) ab on ab.AccountSeqid = ESTOrACT.AccountSeqid\r\n                                   and ab.BillingPeriodRevision = ESTOrACT.BillingPeriodRevision\r\n                                   and ab.LastPeriodModified = ESTOrACT.BillingPeriod\r\n        where   ab.ActualOrEstimated <> ESTOrACT.AccountBilledESTOrACT\r\n\r\n        select  *\r\n        FROM #NYPAESTOrACT as noa\r\n\r\n        update  Billing.AccountBilling\r\n        set     ActualOrEstimated = t.AccountBilledESTOrACT\r\n        ,       FireAuditTrigger = 'N'\r\n        ,       Notes = 'Corrected programming error: Accountbilling from Actual to Estimated for NYPA'\r\n        --,       LastUpdate = getdate()\r\n        FROM Billing.AccountBilling\r\n                inner join [#NYPAESTOrACT] as t on t.AccountBillingSeqid = Billing.AccountBilling.AccountBillingSeqid\r\n\r\n\r\n        drop table #NYPAESTOrACT\t\r\n    end"
        }
      ]
    }
  ]
}