{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "ManualBill",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_ManualBilling_ProcessAccountUnspanned",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Low",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "[ManualBill].[usp_ManualBilling_ProcessAccountUnspanned]",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to transfer records from the "
        },
        {
          "type": "text",
          "text": "UploadManualBillingAccount",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table to the "
        },
        {
          "type": "text",
          "text": "UploadManualBillingAccountSummary",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table within the "
        },
        {
          "type": "text",
          "text": "ManualBill",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " schema. This procedure specifically handles records that are not \"spanned,\" meaning they do not require additional processing related to spanning periods. The procedure sets a status output parameter to indicate success or failure of the operation."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Low"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The procedure is straightforward, involving a single "
        },
        {
          "type": "text",
          "text": "INSERT INTO ... SELECT",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " operation with a simple condition. It does not involve complex logic, multiple steps, or intricate data transformations."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@BillingPeriod varchar(6)",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Represents the billing period for which the records are being processed. It is used in the "
                },
                {
                  "type": "text",
                  "text": "SELECT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " statement to filter or set the billing period in the target table."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@authenticatedID int",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The ID of the user executing the procedure, used to populate the "
                },
                {
                  "type": "text",
                  "text": "AuthenticatedUserID",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " field in the target table."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@utilityCompany dbo.seqid",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": A sequence ID for the utility company, though not directly used in the procedure logic."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@Status int OUTPUT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": An output parameter used to indicate the status of the procedure execution. It is set to "
                },
                {
                  "type": "text",
                  "text": "9",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " initially and "
                },
                {
                  "type": "text",
                  "text": "0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " upon successful completion."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "orderedList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Initialization",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure begins by setting the "
                },
                {
                  "type": "text",
                  "text": "@Status",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " parameter to "
                },
                {
                  "type": "text",
                  "text": "9",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", indicating a default state before processing."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Transfer",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": It performs an "
                },
                {
                  "type": "text",
                  "text": "INSERT INTO ... SELECT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " operation to copy records from "
                },
                {
                  "type": "text",
                  "text": "UploadManualBillingAccount",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to "
                },
                {
                  "type": "text",
                  "text": "UploadManualBillingAccountSummary",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". The selection criteria are based on "
                },
                {
                  "type": "text",
                  "text": "DeltaNumberOfPeriods <= 1",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", indicating non-spanned records."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Field Mapping",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The fields from the source table are mapped directly to the target table, with some fields set to constant values (e.g., "
                },
                {
                  "type": "text",
                  "text": "DerivedFromSpannedBill",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is set to "
                },
                {
                  "type": "text",
                  "text": "'N'",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", and "
                },
                {
                  "type": "text",
                  "text": "NumberOfTransactions",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is set to "
                },
                {
                  "type": "text",
                  "text": "1",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ")."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Completion",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": After the data transfer, the "
                },
                {
                  "type": "text",
                  "text": "@Status",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " parameter is set to "
                },
                {
                  "type": "text",
                  "text": "0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", indicating successful execution."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Indexing",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Ensure that the "
                },
                {
                  "type": "text",
                  "text": "UploadManualBillingAccount",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table is indexed on "
                },
                {
                  "type": "text",
                  "text": "DeltaNumberOfPeriods",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to optimize the "
                },
                {
                  "type": "text",
                  "text": "WHERE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " clause filtering."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Batch Processing",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If the source table contains a large number of records, consider implementing batch processing to avoid potential locking and performance issues."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Minimal Logic",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure's simplicity contributes to its performance efficiency, as it involves a single data transfer operation without complex computations."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Integrity",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure assumes that all necessary fields in the source table are correctly populated. Missing or incorrect data could lead to incomplete or incorrect records in the target table."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Concurrency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If multiple instances of this procedure are executed simultaneously, there could be potential for data contention or locking issues, especially if the source table is large."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure lacks explicit error handling mechanisms. If an error occurs during the "
                },
                {
                  "type": "text",
                  "text": "INSERT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " operation, it may not be captured or logged, leaving the "
                },
                {
                  "type": "text",
                  "text": "@Status",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " parameter unchanged from its initial value."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hardcoded Values",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The use of hardcoded values (e.g., "
                },
                {
                  "type": "text",
                  "text": "1",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " for "
                },
                {
                  "type": "text",
                  "text": "NumberOfTransactions",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ") may not be flexible for future changes in business logic or requirements."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE PROCEDURE [ManualBill].[usp_ManualBilling_ProcessAccountUnspanned]\n\t@BillingPeriod varchar(6),\r\n\t@authenticatedID int,\r\n\t@utilityCompany dbo.seqid,\r\n\t@Status int  OUTPUT      \r\n   \r\n AS \r\n  begin\r\n --********************************************************************************\r\n --\tAuthor: MOHAMMED BELARREM\r\n -- Description: Copy NON span records from UploadManualBillingAccount to UploadManualBillingAccountSummary\r\n --\r\n --\tLog: \r\n --\t\tCreation 02/10/2009\r\n --\t\tUpdate   02/11/2009\tUpdated the tables and needes to reflect changes \r\n --     Update\t 12/28/2009 Updated the tables and needes to reflect changes \r\n --\t\tUpdate\t 01/13/2010 Updated the tables and added AccountSeqid\r\n --     Update   03/04/2010 Added set @Status = 0 to reflect that all went ok\r\n --     Update   12/17/2019 VY - update for UniqueAccountSeqID \r\n --********************************************************************************\r\n \r\n\tset @Status = 9\r\n\t\r\n\t-- since these records are not spanned there is no processing required they are just moved over the UploadManualBillingAccountSummary as is\r\n\t\r\n\tINSERT INTO ManualBill.[UploadManualBillingAccountSummary]\r\n           ([UtilityCompanySeqid]\r\n           ,[InvoiceAccountBillingGroupSeqid]\r\n           ,[AccountManualBillingHeaderSeqid]\r\n           ,[AccountSeqid]\r\n\t\t   ,[UniqueAccountSeqID] /* added on 12/17/2018 */\r\n           ,[OriginalAccountNumber]\r\n           ,[NumberOfTransactions]\r\n           ,[NumberOfRebillTransactions]\r\n           ,[NumberOfCancelTransactions]\r\n           ,[BillingPeriod]\r\n           ,[BillingPeriodRevision]\r\n           ,[BillingAction]\r\n           ,[ActualOrEstimated]\r\n           ,[FromDate]\r\n           ,[ToDate]\r\n           ,[BillingPeriodDays]\r\n           ,[NetBilledAmount]\r\n           ,[EnergyUsage]\r\n           ,[DemandUsage]\r\n           ,[EnergySource]\r\n           ,[DerivedFromSpannedBill]\r\n           ,[SpannedFromDate]\r\n           ,[SpannedToDate]\r\n           ,[SpannedBillingPeriodDays]\r\n           ,[SpannedBillingPeriodRevision]\r\n           ,[SpannedFirstBillingPeriodCanceled]\r\n           ,[SpannedNetBilledAmount]\r\n           ,[SpannedEnergyUsage]\r\n           ,[SpannedDemandUsage]\r\n           ,[SpannedMonthlyPercentage]\r\n           ,[SpannedTotalPercentage]\r\n           ,[Notes]\r\n           ,[AuthenticatedUserID]\r\n           ,[DateAdded]\r\n           ,[LastUpdate])\r\n\r\n\t\r\n\tselect \r\n\t\t\tUtilityCompanySeqid\t\t\t\t\t--[UtilityCompanySeqid]\r\n\t\t   ,InvoiceAccountBillingGroupSeqid\t\t--[InvoiceAccountBillingGroupSeqid]\r\n\t\t   ,AccountmanualBillingHeaderSeqid\t\t--[AccountManualBillingHeaderSeqid]\r\n           ,AccountSeqid\t\t\t\t\t\t--[AccountSeqid]\r\n\t\t   ,UniqueAccountSeqId                  --[UniqueAccountSeqid]\r\n\t\t   ,OriginalAccountNumber\t\t\t\t--[OriginalAccountNumber]\r\n\t\t   ,1\t\t\t\t\t\t\t\t\t--[[NumberOfTransactions]\r\n\t\t   ,1\t\t\t\t\t\t\t\t\t--[NumberOfRebillTransactions]\r\n\t\t   ,0\t\t\t\t\t\t\t\t\t--[NumberOfCancelTransactions]\r\n\t\t   ,BillingPeriod\t\t\t\t\t\t--[BillingPeriod]\r\n\t\t   ,BillingPeriodRevision\t\t\t\t--[BillingPeriodRevision]\r\n\t\t   ,BillingAction\t\t\t\t\t\t--[BillingAction]\r\n\t\t   ,ActualOrEstimated\t\t\t\t\t--[ActualOrEstimated]\r\n\t\t   ,FromDate\t\t\t\t\t\t\t--[FromDate]\r\n\t\t   ,ToDate\t\t\t\t\t\t\t\t--[ToDate]\r\n\t\t   ,BillingPeriodDays\t\t\t\t\t--[BillingPeriodDays]\r\n\t\t   ,NetBilledAmount\t\t\t\t\t\t--[NetBilledAmount]\r\n\t\t   ,EnergyUsage\t\t\t\t\t\t\t--[EnergyUsage]\r\n\t\t   ,DemandUsage\t\t\t\t\t\t\t--[DemandUsage]\r\n\t\t   ,EnergySource\t\t\t\t\t\t--[EnergySource]\r\n\t\t   ,'N'\t\t\t\t\t\t\t\t\t--[DerivedFromSpannedBill]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[SpannedFromDate]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[SpannedToDate]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[SpannedBillingPeriodDays]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[SpannedBillingPeriodRevision]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[SpannedFirstBillingPeriodCanceled]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[SpannedNetBilledAmount]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[SpannedEnergyUsage]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[SpannedDemandUsage]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[SpannedMonthlyPercentage]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[SpannedTotalPercentage]\r\n\t\t   ,null\t\t\t\t\t\t\t\t--[Notes]\r\n\t\t   ,@authenticatedID\t\t\t\t\t--[AuthenticatedUserID]\r\n\t\t   ,getdate()\t\t\t\t\t\t\t--[DateAdded]\r\n\t\t   ,getdate()\t\t\t\t\t\t\t--[LastUpdate])\r\n\t\r\n\tFROM ManualBill.UploadManualBillingAccount\r\n\tWHERE  (DeltaNumberOfPeriods <= 1)\r\n\t\r\n\tset @Status = 0\r\n\t\r\n end"
        }
      ]
    }
  ]
}