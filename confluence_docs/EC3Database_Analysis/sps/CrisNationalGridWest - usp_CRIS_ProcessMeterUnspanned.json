{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "CrisNationalGridWest",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_CRIS_ProcessMeterUnspanned",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_CRIS_ProcessMeterUnspanned",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to process meter reading transactions for a specified billing period. It inserts data from the "
        },
        {
          "type": "text",
          "text": "UploadMeterReadDetail",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table into the "
        },
        {
          "type": "text",
          "text": "UploadMeterBillingCRISTransaction",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table, specifically for transactions that are not excluded and have a billing transaction code of 'BI'. The procedure includes error handling to manage any exceptions that occur during the transaction."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level is considered medium due to the following factors:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure involves a transactional operation with error handling."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It performs a conditional data insertion based on specific criteria."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It uses dynamic error messages and logging, which adds to the complexity."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@BillingPeriod varchar(6)",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Represents the billing period for which the meter readings are being processed. It is used in error messages but not directly in the logic."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@authenticatedID int",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This parameter is declared but not used within the procedure, suggesting it might be intended for future use or was part of a previous implementation."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@StatusCode int OUTPUT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": An output parameter that indicates the success or failure of the procedure. It is set to 0 for success and 1 for failure."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "orderedList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Initialization",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure begins by declaring local variables for account and meter numbers, and a carriage return/line feed string for formatting error messages."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Transaction Start",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": A transaction named "
                },
                {
                  "type": "text",
                  "text": "unspannedTrans",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is initiated to ensure atomicity of the data insertion operation."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Insertion",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure inserts records from "
                },
                {
                  "type": "text",
                  "text": "CrisNationalGridWest.UploadMeterReadDetail",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " into "
                },
                {
                  "type": "text",
                  "text": "CrisNationalGridWest.UploadMeterBillingCRISTransaction",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". The selection criteria ensure that only non-excluded transactions with a billing transaction code of 'BI' and matching billing period revisions are processed."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": A "
                },
                {
                  "type": "text",
                  "text": "TRY...CATCH",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " block is used to handle exceptions. If an error occurs, detailed error information is captured, formatted, and logged using "
                },
                {
                  "type": "text",
                  "text": "RAISERROR",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". The transaction is rolled back, and the "
                },
                {
                  "type": "text",
                  "text": "@StatusCode",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is set to 1."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Transaction Commit",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If no errors occur, the transaction is committed, and the "
                },
                {
                  "type": "text",
                  "text": "@StatusCode",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " remains 0."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Transaction Scope",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The transaction scope is limited to the insertion operation, which is efficient. However, the performance could be impacted by the volume of data being processed."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Indexing",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Ensure that the "
                },
                {
                  "type": "text",
                  "text": "UploadMeterReadDetail",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table is properly indexed on columns used in the "
                },
                {
                  "type": "text",
                  "text": "WHERE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " clause to optimize the selection process."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling Overhead",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The error handling mechanism, while robust, could introduce some overhead due to the detailed logging and message formatting."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Unused Parameter",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The "
                },
                {
                  "type": "text",
                  "text": "@authenticatedID",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " parameter is not used, which could lead to confusion or maintenance challenges. It should be removed or implemented as intended."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Message Length",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The error message construction could exceed the maximum length for "
                },
                {
                  "type": "text",
                  "text": "RAISERROR",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", especially if the error message or custom message is lengthy."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Integrity",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If the selection criteria are not correctly aligned with business rules, there is a risk of incorrect data being inserted."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Concurrency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If multiple instances of this procedure are run simultaneously, there could be contention issues, especially if the tables involved are heavily accessed by other processes."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE PROCEDURE [CrisNationalGridWest].[usp_CRIS_ProcessMeterUnspanned]\n\t@BillingPeriod varchar(6),\r\n\t@authenticatedID int,\r\n\t@StatusCode int  OUTPUT      \r\n   \r\n AS \r\n BEGIN\r\n\t\t--********************************************************************************\r\n\t\t--\tAuthor: MOHAMMED BELARREM\r\n\t\t--\tDescription: Process\r\n\t\t--\r\n\t\t--\tLog: \r\n\t\t--\t05/27/2010\tMOH\tCreation \r\n\t\t--\t06/14/2010\tMOH\tUpdate:\tAdded Therms, ThermsFactor and GasRateCode\t\r\n\t\t--\t07/09/2010\tMOH\tUpdate:\tAdded CurrentMeterNumber\r\n\t\t--  01/11/2010  MOH Update: Added the condition to test and pickup only non excluded transaction\r\n\t\t--********************************************************************************\r\n\t \r\n\t\t--********************************************************************************\r\n\t\tDECLARE @AccountNumber acctnum\r\n\t\tDECLARE @MeterNumber MeterNumber\r\n\r\n\t\tdeclare @crlf varchar(2)\r\n\t\tset @crlf = CHAR(13) + CHAR(10) \r\n\r\n\t\r\n\t\t\t\r\n\t\tbegin try\t\r\n\t\t\r\n\t\t\t\tbegin TRANSACTION unspannedTrans\r\n\t\t\t\tset @StatusCode  = 0\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t-- copy over all the single period transactions\r\n\t\t\t\tINSERT INTO [CrisNationalGridWest].[UploadMeterBillingCRISTransaction]\r\n\t\t\t\t\t\t   ([UploadMeterReadDetailSeqid]\r\n\t\t\t\t\t\t   ,[UtilityCompanySeqid]\r\n\t\t\t\t\t\t   ,[AccountInvoiceBillingGroup]\r\n\t\t\t\t\t\t   ,[BillingPeriod]\r\n\t\t\t\t\t\t   ,[BillingPeriodRevision]\r\n\t\t\t\t\t\t   ,[OriginalAccountNumber]\r\n\t\t\t\t\t\t   ,[MeterReadWorkDay]\r\n\t\t\t\t\t\t   ,[UtilityServiceAccountName]\r\n\t\t\t\t\t\t   ,[UtilityServiceAddress]\r\n\t\t\t\t\t\t   ,[Borough]\r\n\t\t\t\t\t\t   ,[Zipcode]\r\n\t\t\t\t\t\t   ,[State]\r\n\t\t\t\t\t\t   ,[ActivityCode]\r\n\t\t\t\t\t\t   ,[ActivityDateTime]\r\n\t\t\t\t\t\t   ,[TransactionCode]\r\n\t\t\t\t\t\t   ,[SpecialLedgerAccountNumber]\r\n\t\t\t\t\t\t   ,[MeterNumber]\r\n\t\t\t\t\t\t   ,[CurrentMeterNumber]\r\n\t\t\t\t\t\t   ,[MeterConstant]\r\n\t\t\t\t\t\t   ,[NumberOfDials]\r\n\t\t\t\t\t\t   ,[MeterReadType]\r\n\t\t\t\t\t\t   ,[EstimatedOrActual]\r\n\t\t\t\t\t\t   ,[MeterReadStatus]\r\n\t\t\t\t\t\t   ,[MeterReadSource]\r\n\t\t\t\t\t\t   ,[MeterReadReason]\r\n\t\t\t\t\t\t   ,[MeterType]\r\n\t\t\t\t\t\t   ,[FromDate]\r\n\t\t\t\t\t\t   ,[ToDate]\r\n\t\t\t\t\t\t   ,[MeterFromReading]\r\n\t\t\t\t\t\t   ,[MeterToReading]\r\n\t\t\t\t\t\t   ,[MeterReadTime]\r\n\t\t\t\t\t\t   ,[MeterCCF]\r\n\t\t\t\t\t\t   ,Therms\r\n\t\t\t\t\t\t   ,ThermsFactor\r\n\t\t\t\t\t\t   ,GasRateCode\r\n\t\t\t\t\t\t   ,[FixFactor]\r\n\t\t\t\t\t\t   ,[PartSupplied]\r\n\t\t\t\t\t\t   ,[MeterBillingStatus]\r\n\t\t\t\t\t\t   ,[PreviousMeterBillingStatus]\r\n\t\t\t\t\t\t   ,[MeterBillingStatusCodePeriod]\r\n\t\t\t\t\t\t   ,[SpannedMeterCCF]\r\n\t\t\t\t\t\t   ,[SpannedFromDate]\r\n\t\t\t\t\t\t   ,[SpannedToDate]\r\n\t\t\t\t\t\t   ,[SpannedMeterReadingFrom]\r\n\t\t\t\t\t\t   ,[SpannedMeterReadingTo]\r\n\t\t\t\t\t\t   ,[SpannedMonthlyPercentage]\r\n\t\t\t\t\t\t   ,[SpannedTotalPercentage])\r\n\t\t\t\tSELECT\t\r\n\t\t\t\t\t\t\t UploadMeterReadDetailSeqid                     --- [UploadMeterReadDetailSeqid]\r\n\t\t\t\t\t\t\t,UtilityCompanySeqid                            --- [UtilityCompanySeqid]\r\n\t\t\t\t\t\t\t,AccountInvoiceBillingGroup                     --- [AccountInvoiceBillingGroup]\r\n\t\t\t\t\t\t\t,BillingPeriod                                  --- [BillingPeriod]\r\n\t\t\t\t\t\t\t,CalculatedBillingPeriodRevision\t\t\t\t--- [BillingPeriodRevision]\r\n\t\t\t\t\t\t\t,AccountNumber\t\t\t\t\t\t\t\t\t--- [OriginalAccountNumber]\r\n\t\t\t\t\t\t\t,MeterReadWorkDay                               --- [MeterReadWorkDay]\r\n\t\t\t\t\t\t\t,UtilityServiceAccountName\t\t\t\t\t\t--- [UtilityServiceAccountName]\r\n\t\t\t\t\t\t\t,UtilityServiceAddress                          --- [UtilityServiceAddress]\r\n\t\t\t\t\t\t\t,Borough                                        --- [Borough]\r\n\t\t\t\t\t\t\t,Zipcode                                        --- [Zipcode]\r\n\t\t\t\t\t\t\t,[State]                                        --- [State]\r\n\t\t\t\t\t\t\t,ActivityCode                                   --- [ActivityCode]\r\n\t\t\t\t\t\t\t,ActivityDateTime                               --- [ActivityDateTime]\r\n\t\t\t\t\t\t\t,TransactionCode                                --- [TransactionCode]\r\n\t\t\t\t\t\t\t,SpecialLedgerAccountNumber                     --- [SpecialLedgerAccountNumber]\r\n\t\t\t\t\t\t\t,MeterNumber\t                                --- [MeterNumber]\r\n\t\t\t\t\t\t\t,CurrentMeterNumber\t\t\t\t\t\t\t\t--- [CurrentMeterNumber]\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t,MeterConstant                                  --- [MeterConstant]\r\n\t\t\t\t\t\t\t,NumberOfDials                                  --- [NumberOfDials]\r\n\t\t\t\t\t\t\t,MeterReadType                                  --- [MeterReadType]\r\n\t\t\t\t\t\t\t,EstimatedOrActual                              --- [EstimatedOrActual]\r\n\t\t\t\t\t\t\t,MeterReadStatus                                --- [MeterReadStatus]\r\n\t\t\t\t\t\t\t,MeterReadSource                                --- [MeterReadSource]\r\n\t\t\t\t\t\t\t,MeterReadReason                                --- [MeterReadReason]\r\n\t\t\t\t\t\t\t,MeterType                                      --- [MeterType]\r\n\t\t\t\t\t\t\t,MeterReadingFromDate                           --- [FromDate]\r\n\t\t\t\t\t\t\t,MeterReadingToDate                             --- [ToDate]\r\n\t\t\t\t\t\t\t,MeterFromReading                               --- [MeterFromReading]\r\n\t\t\t\t\t\t\t,MeterToReading                                 --- [MeterToReading]\r\n\t\t\t\t\t\t\t,MeterReadTime                                  --- [MeterReadTime]\r\n\t\t\t\t\t\t\t,MeterCCF                                       --- [MeterCCF]\r\n\t\t\t\t\t\t\t,Therms\t\t\t\t\t\t\t\t\t\t\t--- therms\r\n\t\t\t\t\t\t\t,ThermsFactor\t\t\t\t\t\t\t\t\t--- ThermsFactor\r\n\t\t\t\t\t\t\t,GasRateCode\t\t\t\t\t\t\t\t\t--- GasRateCode\r\n\t\t\t\t\t\t\t,FixFactor                                      --- [FixFactor]\r\n\t\t\t\t\t\t\t,PartSupplied                                   --- [PartSupplied]\r\n\t\t\t\t\t\t\t,NULL                                           --- [MeterBillingStatus]\r\n\t\t\t\t\t\t\t,NULL                                           --- [PreviousMeterBillingStatus]\r\n\t\t\t\t\t\t\t,NULL                                           --- [MeterBillingStatusCodePeriod]\r\n\t\t\t\t\t\t\t,NULL                                           --- [SpannedMeterCCF]\r\n\t\t\t\t\t\t\t,NULL                                           --- [SpannedFromDate]\r\n\t\t\t\t\t\t\t,NULL                                           --- [SpannedToDate]\r\n\t\t\t\t\t\t\t,NULL                                           --- [SpannedMeterReadingFrom]\r\n\t\t\t\t\t\t\t,NULL                                           --- [SpannedMeterReadingTo]\r\n\t\t\t\t\t\t\t,NULL                                           --- [SpannedMonthlyPercentage]\r\n\t\t\t\t\t\t\t,NULL                                           --- [SpannedTotalPercentage])\r\n\t\t\t\tFROM CrisNationalGridWest.UploadMeterReadDetail\r\n\t\t\t\tWHERE FirstBillingPeriodCanceled = CalculatedBillingPeriodRevision\r\n\t\t\t\t\t  AND ExcludeTest = 'N' AND BillingTransactionCode = 'BI'\r\n\r\n\r\n\r\n\t\t\t\tcommit TRANSACTION unspannedTrans\r\n\r\n\r\n\t\tEND TRY\r\n\t\tBEGIN CATCH\r\n\t\t\r\n\t\t\t\tDECLARE @CustomErrorMessage NVARCHAR(4000);\r\n\t\t\t\tDECLARE @ErrorMessage NVARCHAR(4000);\r\n\t\t\t\tDECLARE @ErrorSeverity INT;\r\n\t\t\t\tDECLARE @ErrorState INT;\r\n\t\t\t\tDECLARE @ErrorNumber INT;\r\n\t\t\t\tDECLARE @ErrorLine INT;\r\n\t\t\t\tDECLARE @ErrorProcedure NVARCHAR(126);\r\n\t\t\t\t--\r\n\t\t\t\tSELECT \r\n\t\t\t\t\t@CustomErrorMessage ='Error in StoredProcedure %s at line number %d' + @crlf + 'Billing Period: %s' + @crlf + 'Account:Meter (%s : %s)  ' + @crlf,\r\n\t\t\t\t\t@ErrorMessage\t= ERROR_MESSAGE(),\r\n\t\t\t\t\t@ErrorSeverity\t= ERROR_SEVERITY(),\r\n\t\t\t\t\t@ErrorState\t\t= ERROR_STATE(),\r\n\t\t\t\t\t@ErrorNumber\t= ERROR_NUMBER(),\r\n\t\t\t\t\t@ErrorProcedure = ERROR_PROCEDURE(),\r\n\t\t\t\t\t@ErrorLine\t\t= ERROR_LINE();\t\t\t\r\n\t\t\t\t--\r\n\t\t\t\tset\t@ErrorMessage = @CustomErrorMessage + @ErrorMessage + @crlf + 'ErrorNumber: ' + cast(@ErrorNumber as varchar(10)) + @crlf\r\n\t\t\t\t--\r\n\t\t\t\tRAISERROR (@ErrorMessage, -- Message text.\r\n\t\t\t\t\t\t   @ErrorSeverity, -- Severity.\r\n\t\t\t\t\t\t   @ErrorState, -- State.\r\n\t\t\t\t\t\t   @ErrorProcedure,\r\n\t\t\t\t\t\t   @ErrorLine,\r\n\t\t\t\t\t\t   @BillingPeriod,\r\n\t\t\t\t\t\t   @AccountNumber,\r\n\t\t\t\t\t\t   @MeterNumber\r\n\t\t\t\t\t\t   ) with log;\r\n\t\t\t\t\r\n\t\t\t\tset @StatusCode  = 1\r\n\t\t\t\t\t\t   \r\n\t\t\t\tROLLBACK TRANSACTION unspannedTrans\t\r\n\t\t\t\t\t\t   \r\n\t\tEND CATCH\r\n\r\n\r\n\r\n\r\n\t\r\n end"
        }
      ]
    }
  ]
}