{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "SBMR",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_Select_GetSBMRRecordDetail",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_Select_GetSBMRRecordDetail",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to retrieve detailed information about a specific SBMR (presumably \"Submittal and Billing Management Record\") from the "
        },
        {
          "type": "text",
          "text": "SBMR.SBMRHeader",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table. It uses a series of "
        },
        {
          "type": "text",
          "text": "LEFT JOIN",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " operations to gather related data from multiple tables, including contact information and facility details, based on a unique identifier provided as an input parameter."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity of this stored procedure is considered medium due to the following factors:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It involves multiple "
                },
                {
                  "type": "text",
                  "text": "LEFT JOIN",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " operations across different tables, which increases the complexity of the query."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It constructs a composite field ("
                },
                {
                  "type": "text",
                  "text": "CommoditySBMRHeader",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ") by concatenating two fields, which adds a layer of complexity."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It retrieves data from various related tables, requiring a good understanding of the database schema."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@SBMRHeaderSeqID INT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This parameter is used to specify the unique identifier for the SBMR record in the "
                },
                {
                  "type": "text",
                  "text": "SBMR.SBMRHeader",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table. It acts as a filter to select the specific record for which details are to be retrieved."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure begins by selecting all columns from the "
                },
                {
                  "type": "text",
                  "text": "SBMR.SBMRHeader",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table for the record identified by "
                },
                {
                  "type": "text",
                  "text": "@SBMRHeaderSeqID",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It joins the "
                },
                {
                  "type": "text",
                  "text": "SBMR.SBMRHeader",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table with the "
                },
                {
                  "type": "text",
                  "text": "Billing.Facility",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table to retrieve the "
                },
                {
                  "type": "text",
                  "text": "OecFacilityNumber",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It performs a self-join on the "
                },
                {
                  "type": "text",
                  "text": "SBMR.SBMRHeader",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table to obtain the "
                },
                {
                  "type": "text",
                  "text": "CommoditySBMRHeader",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", which is a concatenation of "
                },
                {
                  "type": "text",
                  "text": "SbmrReferenceNumber",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and "
                },
                {
                  "type": "text",
                  "text": "ELOAddress",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It joins with the "
                },
                {
                  "type": "text",
                  "text": "Contact.ContactAddress",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table multiple times to retrieve contact names for various roles such as Construction Manager, Agency, Utility Company, Contractor, etc."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It joins with the "
                },
                {
                  "type": "text",
                  "text": "Membership.EC3Membership",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table to retrieve the reviewer's email address."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure filters the results to return only the record matching the provided "
                },
                {
                  "type": "text",
                  "text": "@SBMRHeaderSeqID",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The use of multiple "
                },
                {
                  "type": "text",
                  "text": "LEFT JOIN",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " operations can impact performance, especially if the tables involved are large. Indexing on the join columns can help mitigate this."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The self-join on "
                },
                {
                  "type": "text",
                  "text": "SBMR.SBMRHeader",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " could be resource-intensive if the table is large and not properly indexed."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The concatenation operation for "
                },
                {
                  "type": "text",
                  "text": "CommoditySBMRHeader",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " might have a negligible performance impact but should be considered if the dataset is large."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "If the "
                },
                {
                  "type": "text",
                  "text": "SBMR.SBMRHeader",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table or any of the joined tables lack proper indexing, the query could perform poorly, especially with large datasets."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure assumes that all "
                },
                {
                  "type": "text",
                  "text": "LEFT JOIN",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " operations will find matching records, which might not always be the case, potentially leading to "
                },
                {
                  "type": "text",
                  "text": "NULL",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " values in the result set."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The concatenation of "
                },
                {
                  "type": "text",
                  "text": "SbmrReferenceNumber",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and "
                },
                {
                  "type": "text",
                  "text": "ELOAddress",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " assumes both fields are non-nullable; if they are nullable, the result might not be as expected."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure does not handle potential errors or exceptions, such as invalid "
                },
                {
                  "type": "text",
                  "text": "@SBMRHeaderSeqID",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " values, which could lead to unexpected results or failures."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "-- ================================================\n-- Template generated from Template Explorer using:\r\n-- Create Procedure (New Menu).SQL\r\n--\r\n-- Use the Specify Values for Template Parameters \r\n-- command (Ctrl-Shift-M) to fill in the parameter \r\n-- values below.\r\n--\r\n-- This block of comments will not be included in\r\n-- the definition of the procedure.\r\n-- ================================================\r\n--SET ANSI_NULLS ON\r\n--GO\r\n--SET QUOTED_IDENTIFIER ON\r\n--GO\r\n---- =============================================\r\n---- Author:\t\t<Author,,Name>\r\n---- Create date: <Create Date,,>\r\n---- Description:\t<Description,,>\r\n---- =============================================\r\nCREATE PROCEDURE [SBMR].[usp_Select_GetSBMRRecordDetail]\r\n\t@SBMRHeaderSeqID INT\r\nAS\r\nBEGIN\r\n\t\r\n\t\r\n\tSELECT  \r\n\t\tSBMR.SBMRHeader.*,\r\n\t\tcommoditySBMR.SbmrReferenceNumber + ' - ' + commoditySBMR.ELOAddress AS CommoditySBMRHeader,\r\n\t\tContactAgencyConstructionManager.ContactName ContactAgencyConstructionManager,\r\n\t\tContactAgency.ContactName ContactAgency,\r\n\t\tContactCommodityUtilityCompany.ContactName ContactCommodityUtilityCompany,\r\n\t\tContactContractor.ContactName ContactContractor,\t\t\r\n\t\tContactDeliveryUtilityCompany.ContactName ContactDeliveryUtilityCompany,\r\n\t\tContactFacilityAccess.ContactName ContactFacilityAccess,\r\n\t\tContactPersonRequestingService.ContactName ContactPersonRequestingService,\r\n\t\tfac.OecFacilityNumber,\r\n\t\tmem.Email ReviewerName\r\n\tFROM \r\n\t\tSBMR.SBMRHeader \r\n\t\tLEFT JOIN Billing.Facility AS fac\r\n\t\tON SBMR.SBMRHeader.FacilitySeqid = fac.FacilitySeqid\r\n\t\tLEFT JOIN\r\n\t\tSBMR.SBMRHeader commoditySBMR \r\n\t\tON SBMR.SBMRHeader.CommoditySBMRHeaderSeqid = commoditySBMR.SBMRHeaderSeqid\r\n\t\tLEFT JOIN\r\n\t\tContact.ContactAddress ContactAgencyConstructionManager\r\n\t\tON SBMR.SBMRHeader.ContactAgencyConstructionManagerSeqid = ContactAgencyConstructionManager.ContactAddressSeqid\r\n\t\tLEFT JOIN\r\n\t\tContact.ContactAddress ContactAgency\r\n\t\tON SBMR.SBMRHeader.ContactAgencySeqid = ContactAgency.ContactAddressSeqid\r\n\t\tLEFT JOIN\r\n\t\tContact.ContactAddress ContactCommodityUtilityCompany\r\n\t\tON SBMR.SBMRHeader.ContactCommodityUtilityCompanySeqid = ContactCommodityUtilityCompany.ContactAddressSeqid\r\n\t\tLEFT JOIN\r\n\t\tContact.ContactAddress ContactContractor\r\n\t\tON SBMR.SBMRHeader.ContactContractorSeqid = ContactContractor.ContactAddressSeqid\t\t\r\n\t\tLEFT JOIN\r\n\t\tContact.ContactAddress ContactDeliveryUtilityCompany\r\n\t\tON SBMR.SBMRHeader.ContactDeliveryUtilityCompanySeqid = ContactDeliveryUtilityCompany.ContactAddressSeqid\r\n\t\tLEFT JOIN\r\n\t\tContact.ContactAddress ContactFacilityAccess\r\n\t\tON SBMR.SBMRHeader.ContactFacilityAccessSeqid = ContactFacilityAccess.ContactAddressSeqid\r\n\t\tLEFT JOIN\r\n\t\tContact.ContactAddress ContactPersonRequestingService\r\n\t\tON SBMR.SBMRHeader.ContactPersonRequestingServiceSeqid = ContactPersonRequestingService.ContactAddressSeqid\r\n\t\tLEFT JOIN Membership.EC3Membership AS mem\r\n\t\tON sbmr.SBMRHeader.ReviewerAuthenticatedUserID = mem.AuthenticatedUserID\r\n\tWHERE SBMR.SBMRHeader.SBMRHeaderSeqid = @SBMRHeaderSeqID\t\r\n\t\t\r\nEND"
        }
      ]
    }
  ]
}