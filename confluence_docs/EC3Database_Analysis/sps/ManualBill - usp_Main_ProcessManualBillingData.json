{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "ManualBill",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_Main_ProcessManualBillingData",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_Main_ProcessManualBillingData",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to handle the processing of manual billing data within a specific schema ("
        },
        {
          "type": "text",
          "text": "ManualBill",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": "). It is structured to transform, process, consolidate, prepare, transfer, and mark billing data records as processed. However, all the core logic is currently commented out, leaving only a placeholder "
        },
        {
          "type": "text",
          "text": "SELECT 1",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " statement and a print statement indicating that the procedure is inactive."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level of this stored procedure is medium. Although the current implementation is inactive, the commented-out sections suggest a multi-step process involving several sub-procedures. Each step handle different aspects of billing data processing, which requires a good understanding of the business logic and data flow."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@BillingPeriod varchar(6)",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Represents the billing period for which the data is being processed. It is expected to be in a specific format, "
                },
                {
                  "type": "text",
                  "text": "YYYYMM",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@authenticatedID int",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": An identifier for the authenticated user or process initiating the procedure. This be used for auditing or security purposes."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@utilityCompany dbo.seqid",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": A sequence identifier for the utility company involved in the billing process. This parameter helps in filtering or processing data specific to a utility company."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@invoiceBillingGroup dbo.seqid",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": A sequence identifier for the invoice billing group. This parameter is intended to group or categorize billing data for processing."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@Status int OUTPUT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": An output parameter intended to return the status of the procedure execution. This be used to indicate success, failure, or specific error codes."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The procedure is structured to perform the following steps, although they are currently commented out:"
        }
      ]
    },
    {
      "type": "orderedList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Transform Account and Cancellation Data",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This step involves preparing raw billing data for further processing by transforming it into a suitable format."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Process Account Data",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This involves handling both unspanned and spanned account data records, as well as processing account cancellations. The comments suggest considerations for handling original versus current account numbers and updating account billing statuses."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Consolidate Data",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Data is consolidated into a specific table ("
                },
                {
                  "type": "text",
                  "text": "ManualBill.UploadManualBillingAccountAdjustment",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "), for further analysis or reporting."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Prepare Data for Transfer",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This step involves preparing the processed data for transfer to another system or schema."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Transfer Data",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The data is transferred to the "
                },
                {
                  "type": "text",
                  "text": "AccountBilling",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " schema, indicating integration with another part of the system."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Mark Records as Processed",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Finally, records are marked as processed to prevent re-processing and maintain data integrity."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Batch Processing",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If the procedure processes large volumes of data, consider implementing batch processing to manage memory and CPU usage effectively."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Indexing",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Ensure that the tables involved in the procedure are properly indexed to optimize data retrieval and manipulation."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Concurrency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Consider the impact of concurrent executions of this procedure on shared resources and implement appropriate locking mechanisms if necessary."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Commented-Out Logic",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The entire core logic is commented out, which means the procedure currently does nothing. This could lead to confusion or errors if someone expects it to perform its intended functions."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": There is no error handling implemented in the procedure. Consider adding TRY-CATCH blocks to manage exceptions and ensure graceful failure."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Dependency on Sub-Procedures",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure relies heavily on other stored procedures. Any changes or issues in these sub-procedures could impact the overall process."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Parameter Validation",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": There is no validation for input parameters, which could lead to unexpected behavior if invalid data is passed."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Scalability",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": As the procedure is designed to handle billing data, it should be tested for scalability to ensure it can handle increasing data volumes over time."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE PROCEDURE [ManualBill].[usp_Main_ProcessManualBillingData]\n\t@BillingPeriod varchar(6),\r\n\t@authenticatedID int,\r\n\t@utilityCompany dbo.seqid,\r\n\t@invoiceBillingGroup dbo.seqid,\r\n\t@Status int  OUTPUT   \r\n   \r\n AS \r\n begin\r\n\t\t-- testing\r\n\t\tselect 1\t\t\r\n\t\t/*************************** \r\n\t\t[1] Transform account and cancellation data\r\n\t\t****************************/\r\n\t\t--[DONE]  [UPDATED]\r\n\t\t--exec ManualBill.usp_ManualBilling_TransformAccountAndCancellationData  @BillingPeriod, @authenticatedID, @utilityCompany, @invoiceBillingGroup, @Status\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t/*************************** \r\n\t\t[1] process account data\r\n\t\t****************************/\r\n\t\t\t\r\n\t\t/************************************************************************************************************************************\r\n\t\tIMPORTANT UPDATE TO BE IMPLEMENTED\r\n\t\t\r\n\t\t* make processing independant of the invoice billing group\r\n\t\t* check out the Original account vs current account number processing\r\n\t\t* originally i was thinking about converting all numbers into current account number, but now i have to check how this affeects BAs\r\n\t\t* implement how to change AccountBillingStatus\r\n\t\t\r\n\t\t*************************************************************************************************************************************/\t\r\n\t\t\t\r\n\r\n\t\t-- (1.1) process account level unspanned data record\r\n\t\t--[DONE] [UPDATED]\r\n\t\t--exec ManualBill.usp_ManualBilling_ProcessAccountUnspanned @BillingPeriod, @authenticatedID, @utilityCompany, @invoiceBillingGroup, @Status\r\n\r\n\t\t-- (1.2) process account level spanned data record\r\n\t\t--[DONE] [UPDATED]\r\n\t\t--exec ManualBill.usp_ManualBilling_ProcessAccountSpanned @BillingPeriod, @authenticatedID, @utilityCompany, @invoiceBillingGroup, @Status\t\r\n\t\t\r\n\t\t\r\n\r\n\r\n\t\t-- (1.3) process account cancellation record\r\n\t\t--[DONE] [UPDATED]\r\n\t\t--exec ManualBill.usp_ManualBilling_ProcessAccountCancellationUnspanned  @BillingPeriod, @authenticatedID, @utilityCompany, @invoiceBillingGroup, @Status\t\t\r\n\t\t-- (1.4) process account cancellation spanned\r\n\t\t--[DONE] [UPDATED]\r\n\t\t--exec ManualBill.usp_ManualBilling_ProcessAccountCancellationSpanned  @BillingPeriod, @authenticatedID, @utilityCompany, @invoiceBillingGroup, @Status\t\t\r\n\r\n\r\n\t\t/*************************** \r\n\t\t[2] Consalidate data into ManualBill.UploadManualBillingAccountAdjustment\r\n\t\t****************************/\r\n\t\t--[DONE] [UPDATED]\r\n\t\t--exec ManualBill.usp_ManualBilling_MoveDataFromSummaryIntoAdjustment @BillingPeriod, @authenticatedID, @utilityCompany, @invoiceBillingGroup, @Status\t\t\r\n\t\t\t\r\n\t\t/*************************** \r\n\t\t[3] prepare data for transfer\r\n\t\t****************************/\r\n\t\t--[DONE] [UPDATED]\r\n\t    --EXEC ManualBill.usp_ManualBilling_PrepareDataTransfer @BillingPeriod, @authenticatedID, @utilityCompany, @invoiceBillingGroup\t, @Status\t\t\r\n    \r\n\t    /*************************** \r\n\t\t[4] transfer data to schema \r\n\t\t****************************/\r\n\t\t--[DONE] [UPDATED][still needs revision]\r\n\t    --exec ManualBill.usp_ManualBilling_TransferDataToAccountBilling  @BillingPeriod, @authenticatedID, @utilityCompany, @invoiceBillingGroup, @Status\r\n\t    \r\n\t    \r\n\t    /*************************** \r\n\t\t[5] Mark records as processed \r\n\t\t****************************/\r\n\t\t--[DONE]\r\n\t    --exec ManualBill.usp_ManualBilling_MarkRecordsAsProcessed @BillingPeriod, @authenticatedID, @utilityCompany, @invoiceBillingGroup, @Status\r\n\r\n\t\tprint 'the stored procedure is all commented out '\r\n \r\n end"
        }
      ]
    }
  ]
}