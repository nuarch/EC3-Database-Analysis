{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Batch",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_Process_MatchCoverLetter",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_Process_MatchCoverLetter",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to process cover letter PDF files associated with input files, specifically for financial transactions or billing summaries. It aims to match cover letter charges at the customer level to page 3 totals, sum up various charges, and ensure that the cover sheet matches the uploaded files. The procedure involves executing other stored procedures, performing calculations, and querying data from specific tables to verify consistency and correctness."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level of this stored procedure is considered medium due to the following reasons:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It involves multiple steps and interactions with other stored procedures."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It performs calculations and data retrieval operations."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It includes conditional logic and comments indicating areas for manual checks and potential future enhancements."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "This stored procedure does not take any input parameters directly. However, it interacts with other stored procedures that require parameters, such as "
        },
        {
          "type": "text",
          "text": "usp_PreProcessingMatchCoverLetterToEfileCoversheet",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " and "
        },
        {
          "type": "text",
          "text": "usp_PreProcessingAddMiscellaneousChargesToEfileCoversheet",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ". These interactions suggest that parameters like status codes, charge amounts, and user IDs are relevant to the procedure's operations."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Initialization",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure begins by declaring several variables for storing monetary values and status codes."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Execution of Sub-Procedures",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": It executes the "
                },
                {
                  "type": "text",
                  "text": "usp_PreProcessingMatchCoverLetterToEfileCoversheet",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " stored procedure with hardcoded parameters, which processes the matching of cover letters to e-file coversheets."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Commented Logic",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": There are commented-out sections for adding miscellaneous charges, indicating optional or conditional logic that be executed under certain circumstances."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Retrieval",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure retrieves data from the "
                },
                {
                  "type": "text",
                  "text": "Nypa.UploadNYPACoverSheet",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table to check miscellaneous charges and cover sheet records."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Validation",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": It performs a validation check by selecting data from "
                },
                {
                  "type": "text",
                  "text": "Nypa.uvw_PreProcessingCoversheetVsAccountVsMeterBillingSummary",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to ensure that the total amount due matches the PDF coversheet total amount due."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Completion",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure concludes with comments indicating that pre-processing is complete and the cover sheet matches the uploaded files, suggesting readiness for further processing or updates."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hardcoded Values",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The use of hardcoded values in the execution of sub-procedures limit flexibility and require updates if business rules change."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Commented-Out Code",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The presence of commented-out code can lead to confusion and maintenance challenges, as it is unclear whether these sections are obsolete or conditionally required."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Retrieval",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure performs data retrieval operations that impact performance if the underlying tables contain large volumes of data. Indexing and query optimization should be considered."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Lack of Input Parameters",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The absence of input parameters in the main procedure may limit its reusability and adaptability to different scenarios or datasets."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hardcoded Values",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The reliance on hardcoded values for executing sub-procedures can lead to errors if these values are not updated in line with business changes."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Manual Checks",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The presence of comments indicating the need for manual checks suggests potential gaps in automation and error handling."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Commented-Out Logic",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The commented-out sections may represent incomplete or deprecated logic, posing a risk if they are inadvertently executed or left unmaintained."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Consistency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure relies on external stored procedures and data sources, which may introduce risks related to data consistency and integrity if not properly managed."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE   PROC [Batch].[usp_Process_MatchCoverLetter]\nAS\r\nBEGIN\r\n\t\r\n\t-- Go find the cover letter PDF file came along with the imput files\r\n\t-- Add cover letter Customer level charges to page 3 totals.\r\n\t-- sum up CIC loans together,DCAS charges, sum up cuny charges together \r\n\r\n\t-- TODO\r\n\t-- #CHECK and manual input\r\n\r\n\tdeclare @RC int\r\n\tdeclare @TotalCicMonthlyPaymentAmount money\r\n\tdeclare @DcasWindCharges money\r\n\tdeclare @CunyWindCharges MONEY\r\n\tDECLARE @ShorePowerCredit MONEY\r\n\tdeclare @AuthenticatedUserId int\r\n\tdeclare @Status int\r\n\r\n\tEXECUTE [Nypa].[usp_PreProcessingMatchCoverLetterToEfileCoversheet] 0, 0 , 0, -31437.01, 1, @Status\r\n\r\n\t--EXECUTE [Nypa].[usp_PreProcessingMatchCoverLetterToEfileCoversheet] 0, 0 , 0, -90208.60, 1, @Status\r\n\r\n\tSELECT  120840.56+34110.76\r\n\r\n\t------ Add Miscellaneous Charges To Efile Coversheet Is Optional\r\n\t----DECLARE @RC int\r\n\t----DECLARE @IsDelete int\r\n\t----DECLARE @MiscellaneousCharges varchar(1)\r\n\t----DECLARE @BillingPeriod varchar(6)\r\n\t----DECLARE @CoverSheetRecordType varchar(2)\r\n\t----DECLARE @CoverSheetRecordDesc varchar(35)\r\n\t----DECLARE @MicellaneousChargeAmount money\r\n\t----DECLARE @Notes varchar(300)\r\n\t----DECLARE @AuthenticatedUserId int\r\n\t----DECLARE @Status int\r\n\t----\r\n\t------ @IsDelete ==0 ?  Do not delete : Delete \r\n\t----\r\n\t--EXECUTE @RC = [Nypa].[usp_PreProcessingAddMiscellaneousChargesToEfileCoversheet] \r\n\t--   0 -- @IsDelete\r\n\t--  ,@MiscellaneousCharges\r\n\t--  ,@BillingPeriod\r\n\t--  ,@CoverSheetRecordType\r\n\t--  ,@CoverSheetRecordDesc\r\n\t--  ,@MicellaneousChargeAmount\r\n\t--  ,@Notes\r\n\t--  ,@AuthenticatedUserId\r\n\t--  ,@Status OUTPUT  \r\n\t--68104.61   $(46,832.16)\r\n \r\n\t--execute [Nypa].[usp_PreProcessingAddMiscellaneousChargesToEfileCoversheet] 0, 'N', '201310',60,'Constellallation ADJ not used',1209070.16,'Added Ammount to net zero the credit until OMB decides , how to apply it to EC3',1,0\r\n\t--execute [Nypa].[usp_PreProcessingAddMiscellaneousChargesToEfileCoversheet] 0, 'N', '201211',60,'DEP ADJ added to Billing 104,183.31',0,'Added a account billing transaction for this DEP Jan 2006 ADJ 490118530000006 $104,183.31',1,0\r\n\t--execute [Nypa].[usp_PreProcessingAddMiscellaneousChargesToEfileCoversheet] 0, 'N', '201208',62,'Pg 3 Alloc discrepancy $338.62 ',-338.62,'Page 3 Allocation discrepancy $338.62',1,0\r\n\r\n\t\r\n\r\n\t-- Check CoverSheet\r\n\t-------------------------------------------------------------------------------------------------------------------------\r\n\tSELECT MiscellaneousCharges, CoverSheetRecordType, CoverSheetRecordDesc, TotalDollars,Notes\r\n\tFROM Nypa.UploadNYPACoverSheet\r\n\torder by cast(CoverSheetRecordType as int)\r\n\t-----------------------------------------------------------------------------------------------------------------------\r\n\r\n\t--SELECT 48318267.41 + 259505.66\r\n\t---------------------------------------------------------------------------------------------------------------\r\n\t-- IMPORTANT CHECK\r\n\t-- you can ship this check\r\n\t-- TotalAmountDue on CUSTOMER TOTAL should match PDF Coversheet TOTAL AMOUNT DUE\r\n\tselect * from Nypa.uvw_PreProcessingCoversheetVsAccountVsMeterBillingSummary\r\n\r\n\t------------------------------------------------------------------------------------------------------------------\r\n\r\n---------************************************************************************************************************\r\n---------******************  Pre-Processing is Complete and the cover sheet matches the uploaded files.\r\n---------******************  Proceed to the actual insertion and updating EC3 with the NYPA.\r\n---------******************  \r\n---------******************  If they do not match what is the procedure to follow ??????\r\n---------******************  \r\n---------************************************************************************************************************\r\n\r\n\r\n\r\n\r\n\t\r\nEND"
        }
      ]
    }
  ]
}