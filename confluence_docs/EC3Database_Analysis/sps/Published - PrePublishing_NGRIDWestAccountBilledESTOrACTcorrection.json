{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Published",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "PrePublishing_NGRIDWestAccountBilledESTOrACTcorrection",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Low",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "PrePublishing_NGRIDWestAccountBilledESTOrACTcorrection",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to correct discrepancies between estimated and actual billing codes for accounts in the National Grid West CRIS system. It identifies records where the "
        },
        {
          "type": "text",
          "text": "EstimatedOrActualBillingCode",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " in the "
        },
        {
          "type": "text",
          "text": "AccountBillingCrisGas",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table does not match the "
        },
        {
          "type": "text",
          "text": "ActualOrEstimated",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " field in the "
        },
        {
          "type": "text",
          "text": "AccountBilling",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table. The procedure then updates the "
        },
        {
          "type": "text",
          "text": "ActualOrEstimated",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " field in the "
        },
        {
          "type": "text",
          "text": "AccountBilling",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table to match the "
        },
        {
          "type": "text",
          "text": "EstimatedOrActualBillingCode",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " from the "
        },
        {
          "type": "text",
          "text": "AccountBillingCrisGas",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " table, ensuring consistency between these two fields."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Low"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The procedure is relatively straightforward, involving a simple SELECT query to identify discrepancies and an UPDATE statement to correct them. There are no complex joins, subqueries, or conditional logic that would increase its complexity."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure does not take any input parameters. It operates on the entire dataset within the relevant tables, specifically targeting records where there is a mismatch between the billing codes."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Identify Discrepancies",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure first selects records from the "
                },
                {
                  "type": "text",
                  "text": "AccountBillingCrisGas",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", "
                },
                {
                  "type": "text",
                  "text": "AccountBilling",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", and "
                },
                {
                  "type": "text",
                  "text": "Account",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " tables where the "
                },
                {
                  "type": "text",
                  "text": "EstimatedOrActualBillingCode",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " does not match the "
                },
                {
                  "type": "text",
                  "text": "ActualOrEstimated",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " field. This is done using an INNER JOIN to link the tables based on their sequence IDs."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Correct Discrepancies",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": It then updates the "
                },
                {
                  "type": "text",
                  "text": "ActualOrEstimated",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " field in the "
                },
                {
                  "type": "text",
                  "text": "AccountBilling",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table to match the "
                },
                {
                  "type": "text",
                  "text": "EstimatedOrActualBillingCode",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " from the "
                },
                {
                  "type": "text",
                  "text": "AccountBillingCrisGas",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " table for the identified records. The "
                },
                {
                  "type": "text",
                  "text": "FireAuditTrigger",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is set to 'N', and a note is added to indicate the correction."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Audit and Notes",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure includes a comment for a potential "
                },
                {
                  "type": "text",
                  "text": "LastUpdate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " field update, which is currently commented out, suggesting that the procedure might have been intended to log the update time."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Index Usage",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The performance of the procedure largely depends on the indexing of the "
                },
                {
                  "type": "text",
                  "text": "AccountBillingSeqid",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and "
                },
                {
                  "type": "text",
                  "text": "AccountSeqid",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " fields. Proper indexing can significantly improve the efficiency of the JOIN operations."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Table Size",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure operates on potentially large tables without any filtering criteria other than the mismatch condition, which could lead to performance issues if the tables are large."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Concurrency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure does not include any transaction handling, which might be necessary if the procedure is run in a high-concurrency environment to prevent potential data inconsistencies."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Integrity",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure assumes that the "
                },
                {
                  "type": "text",
                  "text": "EstimatedOrActualBillingCode",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " in "
                },
                {
                  "type": "text",
                  "text": "AccountBillingCrisGas",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is the correct value. If this assumption is incorrect, the procedure could propagate errors."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Lack of Transaction Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Without explicit transaction management, there is a risk of partial updates if the procedure is interrupted, leading to data inconsistency."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Audit Trail",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure sets "
                },
                {
                  "type": "text",
                  "text": "FireAuditTrigger",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to 'N', which might disable auditing for these changes. If auditing is required for compliance or tracking purposes, this could be a risk."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Commented Code",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The commented-out "
                },
                {
                  "type": "text",
                  "text": "LastUpdate",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " field suggests incomplete implementation. If this field is necessary for tracking changes, its absence could be a risk for data tracking and auditing."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Overall, while the procedure is simple, careful consideration of indexing, transaction management, and auditing is necessary to ensure it operates efficiently and maintains data integrity."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE    procedure [Published].[PrePublishing_NGRIDWestAccountBilledESTOrACTcorrection]\nAS --**************************************************************************************\r\n--* Name:         \r\n--*\r\n--* Description:  Corrected programming error: Accountbilling from Actual to Estimated\r\n--*\t\t\t\t\t\t\t\t\t\t\t   for National Grid West CRIS\r\n--*               \r\n--* Exec:        PrePublishing_NGRIDWestAccountBilledESTOrACTcorrection\r\n--*\r\n--* Parameter(s):         \r\n--*\r\n--*\r\n--* Database:     OEC\r\n--*\r\n--* Return:\t    \r\n--*             \r\n--*\r\n--* AUTHOR:       Peter Heller (PAH)\r\n--* Created On:   06/06/2014\r\n--**************************************************************************************\r\n--* Date         Tech Description of Change\r\n--* ---------- ----  -------------------------------------------------------------\r\n--* 06/06/2014 PAH  First Version  \r\n--***************************************************************************************\r\nBegin \r\n--************************************************************************************** \r\n--Declare Variables                                            \r\n--**************************************************************************************    \r\n\r\n\r\n--**************************************************************************************    \r\n\r\n  select    Billing.AccountBillingCrisGas.BillingPeriod\r\n  ,         Billing.AccountBillingCrisGas.BillingPeriodRevision\r\n  ,         Billing.AccountBillingCrisGas.EstimatedOrActualBillingCode\r\n  ,         Billing.AccountBilling.ActualOrEstimated\r\n  ,         Billing.Account.UtilityAccountProvider\r\n  ,         Billing.Account.CurrentInvoiceAccountGroup\r\n  FROM   Billing.AccountBillingCrisGas\r\n            inner join Billing.AccountBilling on Billing.AccountBillingCrisGas.AccountBillingSeqid = Billing.AccountBilling.AccountBillingSeqid\r\n            inner join Billing.Account on Billing.AccountBilling.AccountSeqid = Billing.Account.AccountSeqid\r\n  WHERE Billing.AccountBillingCrisGas.EstimatedOrActualBillingCode <> Billing.AccountBilling.ActualOrEstimated\r\n\r\n\r\n  update    Billing.AccountBilling\r\n  set       ActualOrEstimated = Billing.AccountBillingCrisGas.EstimatedOrActualBillingCode\r\n  ,         FireAuditTrigger = 'N'\r\n  ,         Notes = 'Corrected programming error: Accountbilling from Actual to Estimated for National Grid West CRIS'\r\n -- ,         LastUpdate = getdate()\r\n  FROM   Billing.AccountBillingCrisGas\r\n            inner join Billing.AccountBilling on Billing.AccountBillingCrisGas.AccountBillingSeqid = Billing.AccountBilling.AccountBillingSeqid\r\n                                                 and Billing.AccountBillingCrisGas.EstimatedOrActualBillingCode <> Billing.AccountBilling.ActualOrEstimated\r\n            inner join Billing.Account on Billing.AccountBilling.AccountSeqid = Billing.Account.AccountSeqid\r\n\t\r\n    end"
        }
      ]
    }
  ]
}