{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "dbo",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_NYPATruncateMonthlyUploadAndReSeedIdentityKey",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Low",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_NYPATruncateMonthlyUploadAndReSeedIdentityKey",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to clear data from several tables within a SQL Server database and reset their identity columns. Specifically, it truncates data from multiple tables related to NYPA (New York Power Authority) uploads and then reseeds the identity columns to start from the initial value. This operation is typically used to prepare tables for a fresh batch of data, ensuring that identity values start from the beginning."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Low"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The procedure is straightforward, consisting of repetitive operations applied to multiple tables. It uses basic SQL commands like "
        },
        {
          "type": "text",
          "text": "TRUNCATE TABLE",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " and "
        },
        {
          "type": "text",
          "text": "DBCC CHECKIDENT",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", which are simple to understand and implement."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "This stored procedure does not take any input parameters. It operates on a predefined set of tables within the database."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Truncate Tables",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure begins by truncating each specified table. The "
                },
                {
                  "type": "text",
                  "text": "TRUNCATE TABLE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " command is used to remove all rows from a table without logging individual row deletions, making it faster than "
                },
                {
                  "type": "text",
                  "text": "DELETE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Reset Identity Columns",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": After truncating a table, the procedure uses "
                },
                {
                  "type": "text",
                  "text": "DBCC CHECKIDENT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " to manage the identity column:"
                }
              ]
            },
            {
              "type": "bulletList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "DBCC CHECKIDENT ('table_name', NoRESEED)",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ": This checks the current identity value without changing it."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "DBCC CHECKIDENT ('table_name', RESEED)",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": ": This resets the identity value to the seed value defined in the table schema, typically 1."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Repeat for Each Table",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The above steps are repeated for each of the tables listed in the procedure."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Efficiency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The use of "
                },
                {
                  "type": "text",
                  "text": "TRUNCATE TABLE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is efficient for removing all rows because it minimally logs the operation. This is beneficial for performance, especially with large tables."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Identity Reseeding",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The reseeding operation is lightweight but necessary to ensure that new data starts with the correct identity values."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Concurrency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If these tables are accessed by other processes, truncating them could lead to locking issues or conflicts. It is important to ensure that this procedure is run during a maintenance window or when the tables are not in use."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Loss",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Truncating tables results in complete data loss for those tables. It is crucial to ensure that any necessary data is backed up or no longer needed before executing this procedure."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Concurrency and Locking",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Running this procedure while other processes are accessing the tables could lead to blocking or deadlocks. Proper scheduling and coordination are necessary."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Identity Reseeding",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If the identity reseeding is not desired (e.g., if identity continuity is important for business logic), this procedure would not be suitable."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure lacks error handling. If any command fails, it could leave the database in an inconsistent state. Implementing try-catch blocks or transaction management could mitigate this risk."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE  PROCEDURE [dbo].[usp_NYPATruncateMonthlyUploadAndReSeedIdentityKey]\nAS\r\nBegin\r\n\r\ntruncate table  [dbo].[UploadNYPAAccountBilling]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAAccountBilling]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAAccountBilling]', RESEED)\r\n\r\ntruncate table  [dbo].[UploadNYPAAccountBillingPreload]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAAccountBillingPreload]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAAccountBillingPreload]', RESEED)\r\n\r\ntruncate table  [dbo].[UploadNYPAMeterBilling]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAMeterBilling]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAMeterBilling]', RESEED)\r\n\r\ntruncate table  [dbo].[UploadNYPAMeterBillingPreload]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAMeterBillingPreload]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAMeterBillingPreload]', RESEED)\r\n\r\ntruncate table  [dbo].[UploadNYPAMeterBillingTemporary]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAMeterBillingTemporary]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAMeterBillingTemporary]', RESEED)\r\n\r\ntruncate table  [dbo].[UploadNYPACoverSheet]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPACoverSheet]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPACoverSheet]', RESEED)\r\n\r\ntruncate table  [dbo].[UploadNYPAExchangeData]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAExchangeData]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAExchangeData]', RESEED)\r\n\r\ntruncate table  [dbo].[UploadNYPAStreetLighting]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAStreetLighting]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAStreetLighting]', RESEED)\r\n\r\ntruncate table  [dbo].[UploadNYPAEncoreMonthlyBilling]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAEncoreMonthlyBilling]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAEncoreMonthlyBilling]', RESEED)\r\n\r\ntruncate table  [dbo].[UploadNYPAGrossReceiptTaxDetail]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAGrossReceiptTaxDetail]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAGrossReceiptTaxDetail]', RESEED)\r\n\r\ntruncate table  [dbo].[UploadNYPAGrossReceiptTaxSummary]\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAGrossReceiptTaxSummary]', NoRESEED)\r\nDBCC CHECKIDENT ('[dbo].[UploadNYPAGrossReceiptTaxSummary]', RESEED)\r\n\r\n\r\n\r\nEnd"
        }
      ]
    }
  ]
}