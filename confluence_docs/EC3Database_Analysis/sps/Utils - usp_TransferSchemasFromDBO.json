{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Utils",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_TransferSchemasFromDBO",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_TransferSchemasFromDBO",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to transfer a large number of database objects from the "
        },
        {
          "type": "text",
          "text": "dbo",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " schema to various other schemas within a SQL Server database. The procedure uses the "
        },
        {
          "type": "text",
          "text": "ALTER SCHEMA",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " command to move tables, views, or other objects from the "
        },
        {
          "type": "text",
          "text": "dbo",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " schema to specified target schemas such as "
        },
        {
          "type": "text",
          "text": "Billing",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "Gbat",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "Voucher",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "Encore",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "FMS",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "Revenue",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "Budget",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "Nypa",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "CityPlanning",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "Contact",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", and "
        },
        {
          "type": "text",
          "text": "Common",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ". This operation is typically performed to organize database objects into logical groupings, improve security, or adhere to a new database design."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level of this stored procedure is considered medium. While the individual "
        },
        {
          "type": "text",
          "text": "ALTER SCHEMA",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " operations are straightforward, the procedure involves a large number of such operations, which increases the overall complexity. Additionally, the procedure affects multiple schemas and a wide range of objects, which requires careful management and understanding of the database structure."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "This stored procedure does not take any input parameters. It is designed to execute a predefined set of schema transfer operations without requiring external input."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Objective",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The primary objective is to reorganize database objects by transferring them from the "
                },
                {
                  "type": "text",
                  "text": "dbo",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " schema to more specific schemas. This can help in better organization, security, and management of database objects."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Workflow",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                }
              ]
            },
            {
              "type": "orderedList",
              "content": [
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "The procedure begins execution without any input parameters."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "It sequentially executes a series of "
                        },
                        {
                          "type": "text",
                          "text": "ALTER SCHEMA",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " commands to transfer each specified object from the "
                        },
                        {
                          "type": "text",
                          "text": "dbo",
                          "marks": [
                            {
                              "type": "code"
                            }
                          ]
                        },
                        {
                          "type": "text",
                          "text": " schema to its target schema."
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "listItem",
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "type": "text",
                          "text": "The procedure completes once all specified objects have been transferred."
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Execution Time",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The execution time of this procedure is generally low, as "
                },
                {
                  "type": "text",
                  "text": "ALTER SCHEMA",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " operations are metadata changes and do not involve moving data physically. However, the large number of operations could lead to a noticeable execution time."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Locking and Blocking",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": While "
                },
                {
                  "type": "text",
                  "text": "ALTER SCHEMA",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " operations are typically quick, they may acquire schema modification locks. If other transactions are accessing the objects being transferred, this could lead to blocking."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Transaction Management",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure does not explicitly use transactions. If an error occurs during execution, it could leave the database in a partially modified state."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure lacks error handling. If an error occurs during one of the "
                },
                {
                  "type": "text",
                  "text": "ALTER SCHEMA",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " operations, subsequent operations will not execute, and the database could be left in an inconsistent state."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Dependencies",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Transferring objects between schemas can affect dependencies such as stored procedures, views, or functions that reference these objects. These dependencies need to be updated to reflect the new schema."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Security",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Changing the schema of an object can affect permissions. Ensure that appropriate permissions are granted on the objects in their new schemas."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Testing and Validation",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Before executing this procedure in a production environment, it should be thoroughly tested in a development or staging environment to ensure that all dependencies and permissions are correctly handled."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Overall, while the procedure is straightforward in its operations, careful consideration of dependencies, permissions, and error handling is crucial to avoid potential issues."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE PROCEDURE [Utils].[usp_TransferSchemasFromDBO]\nAS\r\n\r\nalter schema Billing transfer dbo.Account\r\nalter schema Billing transfer dbo.AccountBilling\r\nalter schema Billing transfer dbo.AccountBillingAdjustmentElectric\r\nalter schema Billing transfer dbo.AccountBillingAdjustmentGas\r\nalter schema Billing transfer dbo.AccountBillingAdjustmentSteam\r\nalter schema Billing transfer dbo.AccountBillingDisputes\r\nalter schema Billing transfer dbo.AccountBillingElectric\r\nalter schema Billing transfer dbo.AccountBillingGas\r\nalter schema Billing transfer dbo.AccountBillingGasSpannedPeriods\r\nalter schema Billing transfer dbo.AccountBillingMiscCharge\r\nalter schema Billing transfer dbo.AccountBillingSteam\r\nalter schema Billing transfer dbo.AccountCICBilling\r\nalter schema Billing transfer dbo.AccountExchangeMeterTrack\r\nalter schema Billing transfer dbo.AccountJournalEntry\r\nalter schema Billing transfer dbo.AccountManualBillingImage\r\nalter schema Billing transfer dbo.AccountMeterStatus\r\nalter schema Billing transfer dbo.AccountOneShotBilling\r\nalter schema Billing transfer dbo.AcctBillingMiscChargeDesc\r\nalter schema Billing transfer dbo.Address\r\nalter schema Billing transfer dbo.AddressMeterLocation\r\nalter schema Billing transfer dbo.Agency\r\nalter schema Billing transfer dbo.AgencyDivision\r\nalter schema Billing transfer dbo.AgencyDivisionContractBudgetLine\r\nalter schema Billing transfer dbo.AgencyDivisionType\r\nalter schema Billing transfer dbo.AgencyFunding\r\nalter schema Billing transfer dbo.ApplicationTimeFrame\r\nalter schema Billing transfer dbo.BillingPeriodKeyspanWestWD\r\nalter schema Billing transfer dbo.BillingPeriodProjected\r\nalter schema Billing transfer dbo.CampusFacility\r\nalter schema Billing transfer dbo.CampusFacilitySpecificAccount\r\nalter schema Billing transfer dbo.CampusType\r\nalter schema Billing transfer dbo.ContactAddress\r\nalter schema Billing transfer dbo.ContactFacilityAccess\r\nalter schema Billing transfer dbo.EnergyDeliveryType\r\nalter schema Billing transfer dbo.DisputeReasonCode\r\nalter schema Billing transfer dbo.Facility\r\nalter schema Billing transfer dbo.FacilityKemaPlaNycBuildingData\r\nalter schema Billing transfer dbo.FacilitySpaceManagement\r\nalter schema Billing transfer dbo.FacilityType\r\nalter schema Billing transfer dbo.FacilityUsageType\r\nalter schema Billing transfer dbo.FMSClosingPeriod\r\n\r\nalter schema Gbat transfer dbo.GBATerror\r\nalter schema Gbat transfer dbo.GBATInputFileFormatTable\r\nalter schema Gbat transfer dbo.GBAToutput\r\nalter schema Billing transfer dbo.InvoiceAccountGroup\r\n\r\nalter schema Voucher transfer dbo.InvoiceContractBudgetLine\r\nalter schema Voucher transfer dbo.InvoiceContractBudgetLineModifcation\r\nalter schema Voucher transfer dbo.InvoiceContractDescriptionType\r\nalter schema Voucher transfer dbo.InvoiceContractNumber\r\nalter schema Voucher transfer dbo.InvoiceCoverPaymentAllocation\r\nalter schema Voucher transfer dbo.InvoiceCoverSheetRecordType\r\nalter schema Voucher transfer dbo.InvoicePaymentContracts\r\nalter schema Voucher transfer dbo.InvoiceTracking\r\nalter schema Voucher transfer dbo.InvoiceUtilityCompanyCoverSheet\r\n\r\n\r\nalter schema Billing transfer dbo.Meter\r\nalter schema Billing transfer dbo.MeterBillingAdjustmentElectric\r\nalter schema Billing transfer dbo.MeterBilling\r\nalter schema Billing transfer dbo.MeterBillingAdjustmentGas\r\nalter schema Billing transfer dbo.MeterBillingAdjustmentSteam\r\nalter schema Billing transfer dbo.MeterBillingElectric\r\nalter schema Billing transfer dbo.MeterBillingGas\r\nalter schema Billing transfer dbo.MeterBillingGasSpannedPeriods\r\nalter schema Billing transfer dbo.MeterBillingSteam\r\nalter schema CityPlanning transfer dbo.NycPlanningPluto\r\nalter schema CityPlanning transfer dbo.NycPlanningPlutoPreload\r\nalter schema Billing transfer dbo.OilDelivery\r\n\r\n\r\nalter schema Encore transfer dbo.ProjectAccountIssue\r\nalter schema Encore transfer dbo.ProjectAssociatedFacilities\r\nalter schema Encore transfer dbo.ProjectCompletionPhases\r\nalter schema Encore transfer dbo.ProjectContactList\r\nalter schema Encore transfer dbo.ProjectCostTrack\r\nalter schema Encore transfer dbo.ProjectedBudgetRates\r\nalter schema Encore transfer dbo.ProjectedBudgetRatesHistory\r\nalter schema Encore transfer dbo.ProjectEncoreNumberExchanged\r\nalter schema Encore transfer dbo.ProjectsAccount\r\nalter schema Encore transfer dbo.ProjectType\r\n\r\n\r\nalter schema FMS transfer dbo.PVEBatchHeaderRecord\r\nalter schema FMS transfer dbo.PVEDocumentDetailRecord\r\nalter schema FMS transfer dbo.PVEDocumentHeaderRecord\r\n\r\nalter schema Revenue transfer dbo.SourceOfRevenueAccount\r\nalter schema Revenue transfer dbo.AccountSourceOfRevenue\r\nalter schema Revenue transfer dbo.AccountSourceOfRevenueReceipt\r\n\r\nalter schema Budget transfer dbo.BudgetaryInformation\r\nalter schema Budget transfer dbo.BudgetaryType\r\n\r\nalter schema Nypa transfer dbo._UploadNypaCorrectedAccounts\r\nalter schema Nypa transfer dbo.UploadNYPAAccountBilling\r\nalter schema Nypa transfer dbo.UploadNYPAAccountBillingAdjustmentPreload\r\nalter schema Nypa transfer dbo.UploadNYPAAccountBillingPreload\r\nalter schema Nypa transfer dbo.UploadNYPAAccountBillingPreloadWrongEAC\r\nalter schema Nypa transfer dbo.UploadNypaAllActiveAccountsPreload\r\nalter schema Nypa transfer dbo.UploadNypaAllActiveMeters\r\nalter schema Nypa transfer dbo.UploadNypaAllActiveMetersPreload\r\nalter schema Nypa transfer dbo.UploadNypaBackAccountBilling\r\nalter schema Nypa transfer dbo.UploadNYPACoverSheet\r\nalter schema Nypa transfer dbo.UploadNYPACoverSheetPreload\r\nalter schema Nypa transfer dbo.UploadNypaEncoreMismatchesProjectNumberAndCICnumber\r\nalter schema Nypa transfer dbo.UploadNYPAEncoreMonthlyBilling\r\nalter schema Nypa transfer dbo.UploadNYPAEncoreMonthlyBillingPreload\r\nalter schema Nypa transfer dbo.UploadNYPAExchangeData\r\nalter schema Nypa transfer dbo.UploadNYPAExchangeDataPreload\r\nalter schema Nypa transfer dbo.UploadNYPAGrossReceiptTaxDetail\r\nalter schema Nypa transfer dbo.UploadNYPAGrossReceiptTaxSummary\r\nalter schema Nypa transfer dbo.UploadNYPAMeterBilling\r\nalter schema Nypa transfer dbo.UploadNYPAMeterBillingPreload\r\nalter schema Nypa transfer dbo.UploadNYPAMeterBillingSummarization\r\nalter schema Nypa transfer dbo.UploadNYPAMeterBillingTemporary\r\nalter schema Nypa transfer dbo.UploadNYPAMissingAccount\r\nalter schema Nypa transfer dbo.UploadNYPAMissingExchangeData\r\nalter schema Nypa transfer dbo.UploadNYPAMissingMeter\r\nalter schema Nypa transfer dbo.UploadNYPAPostExchange\r\nalter schema Nypa transfer dbo.UploadNypaReportedTRNSMmeters\r\nalter schema Nypa transfer dbo.UploadNYPAStreetLighting\r\nalter schema Nypa transfer dbo.UploadNYPAStreetLightingPreload\r\nalter schema Nypa transfer dbo.UploadNYPASummaryPaidBillAdj\r\n\r\nalter schema Billing transfer dbo.UtilityCompany\r\nalter schema Billing transfer dbo.UtilityReadingCode\r\nalter schema Billing transfer dbo.UtilityTariffRate\r\n\r\nalter schema Contact transfer dbo.ContactProfile\r\nalter schema Contact transfer dbo.ContactProfileAddress\r\nalter schema Contact transfer dbo.ContactAddress\r\nalter schema Contact transfer dbo.ContactFacilityAccess\r\n\r\nalter schema Common transfer dbo.UploadCycleParameters\r\n\r\nalter schema Contact transfer dbo.usp_Contact_UpdateContactProfile\r\nalter schema Contact transfer dbo.usp_Contact_UpdateFacilityAccess"
        }
      ]
    }
  ]
}