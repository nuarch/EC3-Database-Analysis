{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Batch",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_Process_Main_UtilityCycle",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_Process_Main_UtilityCycle",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to manage and process utility billing cycles. It sets up various parameters related to billing periods, fiscal years, and other dates relevant to the billing process. The procedure then calls another stored procedure, "
        },
        {
          "type": "text",
          "text": "usp_UploadUtilityCycleParameters",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", to upload these parameters into the system for further processing. This procedure is part of a batch processing system, likely used in a utility company's billing operations."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level of this stored procedure is medium. It involves setting multiple date-related parameters and executing another stored procedure with a variety of inputs. The logic is straightforward, but the number of parameters and the dependency on another procedure increases its complexity."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "This stored procedure does not take any input parameters directly. Instead, it initializes several local variables within the procedure body, which are used as inputs for the "
        },
        {
          "type": "text",
          "text": "usp_UploadUtilityCycleParameters",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " procedure."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Initialization",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure begins by declaring several local variables to store information such as billing period, fiscal year, and various dates related to the billing cycle."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Setting Parameters",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure sets the billing period to May 2023 and the fiscal year to 2023. It calculates specific dates for bill creation, postmark, payment due, and acceptance into OEC based on the billing period."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Execution of Another Procedure",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure calls "
                },
                {
                  "type": "text",
                  "text": "usp_UploadUtilityCycleParameters",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", passing the initialized variables as parameters. This call is responsible for uploading the utility cycle parameters into the system."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hardcoded Values",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Some values, such as "
                },
                {
                  "type": "text",
                  "text": "@UtilityCompanySeqid",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", "
                },
                {
                  "type": "text",
                  "text": "@InvoiceAccountGroupSeqid",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", and "
                },
                {
                  "type": "text",
                  "text": "@AuthenticatedUserID",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", are hardcoded, indicating specific configurations for this execution."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Parameter Initialization",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure initializes and sets several parameters, which is efficient for the scope of this task. However, hardcoding values like billing period and fiscal year can limit flexibility and require manual updates for each cycle."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Procedure Call",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The execution of "
                },
                {
                  "type": "text",
                  "text": "usp_UploadUtilityCycleParameters",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is a critical part of the workflow. The performance of this procedure will significantly impact the overall performance of "
                },
                {
                  "type": "text",
                  "text": "usp_Process_Main_UtilityCycle",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Concurrency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If this procedure is executed concurrently by multiple processes, it could lead to contention issues, especially if the underlying tables or resources are not optimized for concurrent access."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hardcoded Values",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The use of hardcoded values for billing period and fiscal year can lead to maintenance challenges. It requires manual updates for each new billing cycle, increasing the risk of human error."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Lack of Input Parameters",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The absence of input parameters limits the procedure's flexibility and adaptability to different billing cycles without code modification."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": There is no explicit error handling within the procedure. If "
                },
                {
                  "type": "text",
                  "text": "usp_UploadUtilityCycleParameters",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " fails, the procedure does not handle the error or provide feedback, which could lead to silent failures."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Integrity",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure assumes that the dates calculated from the billing period are valid and do not perform any validation checks. This could lead to incorrect data being processed if the billing period is set incorrectly."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE   PROC [Batch].[usp_Process_Main_UtilityCycle]\nAS\r\nBEGIN\r\n\t-- 12.\t“usp_UploadUtilityCycleParameters” is the stored procedure to add the cycle dates.\r\n\t-- UPDATE and set  @BillingPeriod and @FiscalYear = '2016' PARAMETERS to current\r\n\r\n\t-- TODO parametarize all the billing period and fiscal year\r\n\r\n\tdeclare @RC int\r\n\tdeclare @UtilityCompanySeqid int\r\n\tdeclare @BillingPeriod yyyymm\r\n\tdeclare @FiscalYear yyyy\r\n\tdeclare @CanProcessData yesno\r\n\tdeclare @IsCurrentPeriodProcessingComplete yesno\r\n\tdeclare @CurrentProcessingPeriodCompleted yyyymmdd\r\n\tdeclare @BillCreationDate yyyymmdd\r\n\tdeclare @PostMarkDate yyyymmdd\r\n\tdeclare @DatePaymentDue yyyymmdd\r\n\tdeclare @DateAcceptanceIntoOEC yyyymmdd\r\n\tdeclare @UtilityComapnyFolderName varchar(20)\r\n\tdeclare @AuthenticatedUserID int\r\n\tdeclare @StatusCode int\r\n\tdeclare\t@return_value int\r\n\r\n\tset  @BillingPeriod = '202305'\r\n\tset  @FiscalYear = '2023'\r\n\tset  @BillCreationDate = @BillingPeriod + '05'\r\n\tset  @PostMarkDate = @BillingPeriod + '08'\r\n\tset  @DatePaymentDue = @BillingPeriod + '15'\r\n\tset  @DateAcceptanceIntoOEC = @BillingPeriod + '09'\r\n\tset  @AuthenticatedUserID = 1\r\n\tset  @StatusCode = 0\r\n\r\n\texec\t@return_value = [Common].[usp_UploadUtilityCycleParameters]\r\n\t\t\t@UtilityCompanySeqid = 7,\r\n\t\t\t@InvoiceAccountGroupSeqid = 1,\r\n\t\t\t@BillingPeriod = @BillingPeriod,\r\n\t\t\t@FiscalYear = @FiscalYear,\r\n\t\t\t@CanProcessData = Y,\r\n\t\t\t@IsCurrentPeriodProcessingComplete = N,\r\n\t\t\t@CurrentProcessingPeriodCompleted = null,\r\n\t\t\t@BillCreationDate = @BillCreationDate,\r\n\t\t\t@PostMarkDate = @PostMarkDate,\r\n\t\t\t@DatePaymentDue = @DatePaymentDue,\r\n\t\t\t@DateAcceptanceIntoOEC = @DateAcceptanceIntoOEC,\r\n\t\t\t@UtilityComapnyFolderName = N'NYPA',\r\n\t\t\t@AuthenticatedUserID = 1,\r\n\t\t\t@StatusCode = @StatusCode output\r\n\r\nEND"
        }
      ]
    }
  ]
}