{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Temporal",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_ProcessAndInsertTemporalData",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_ProcessAndInsertTemporalData",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to process and insert data for a specified billing period into various temporal tables. It achieves this by executing a series of other stored procedures, each responsible for handling specific data transformations and insertions related to different aspects of account and energy usage summaries. The procedure logs the start and end times of each operation for monitoring purposes."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level of this stored procedure is considered medium. While the procedure itself is straightforward in terms of structure, it orchestrates multiple other stored procedures, each potentially containing complex logic. The complexity arises from the coordination of these operations and the dependencies between them."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@PublishedBillingPeriod",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This parameter is of type "
                },
                {
                  "type": "text",
                  "text": "BillingPeriod",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", which is likely a user-defined type or alias representing a billing period. It is used to specify the time frame for which data should be processed and inserted into the temporal tables."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure begins by printing a start message with the current timestamp for logging purposes."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It sequentially executes a series of stored procedures, each responsible for inserting data into different temporal tables. These procedures handle data at various levels of granularity, such as agency, city-wide, facility, and account levels."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Each execution is preceded by a print statement indicating the start of the operation, which helps in tracking the progress and duration of each task."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "After all the procedures have been executed, a final print statement logs the completion time."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure executes multiple stored procedures sequentially, which could lead to longer execution times if each procedure involves significant data processing."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The use of print statements for logging can be useful for monitoring but may not be efficient for high-volume operations. Consider using a logging table or system for better performance and persistence."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure does not include any error handling or transaction management, which could impact performance if any of the called procedures fail or encounter issues."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Lack of Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure does not include error handling mechanisms. If any of the called procedures fail, the entire process could be disrupted without any rollback or notification."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Sequential Execution",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The sequential execution of stored procedures may lead to performance bottlenecks, especially if any procedure takes a long time to complete."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Scalability",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": As the number of procedures or the volume of data increases, the current approach may not scale well. Consider parallel execution or optimization of individual procedures."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Logging Overhead",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The use of print statements for logging can introduce overhead and may not be suitable for production environments with high data volumes."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE PROCEDURE [Temporal].[usp_ProcessAndInsertTemporalData]\n\t@PublishedBillingPeriod BillingPeriod\r\nAS\r\nBEGIN\r\n\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalAccountLevelSummaryByAgency] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalAccountLevelSummaryByAgency] @PublishedBillingPeriod\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalAccountLevelSummaryByCityWide] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalAccountLevelSummaryByCityWide] @PublishedBillingPeriod\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalAccountLevelSummaryByFacility] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalAccountLevelSummaryByFacility] @PublishedBillingPeriod\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalAccountMeterLevelRawDataForCurrentPeriod] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalAccountMeterLevelRawDataForCurrentPeriod] @PublishedBillingPeriod\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalEnergyUsageSummaryGroupByAgencyAndEnergyType] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalEnergyUsageSummaryGroupByAgencyAndEnergyType] @PublishedBillingPeriod\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByAgencyAndFacilityDollarsAndUsage] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByAgencyAndFacilityDollarsAndUsage] @PublishedBillingPeriod\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByAgencyDollarsAndUsage] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByAgencyDollarsAndUsage] @PublishedBillingPeriod\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByAgencyFacilityAndAccountDollarsAndUsage] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByAgencyFacilityAndAccountDollarsAndUsage] @PublishedBillingPeriod\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByEncoreMonthlyPayments] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByEncoreMonthlyPayments] @PublishedBillingPeriod\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalForAccountLevelRawDataForCurrentPeriod] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalForAccountLevelRawDataForCurrentPeriod] @PublishedBillingPeriod\r\n\t\r\n\tPRINT 'Started at: ' + CAST(GETDATE() AS VARCHAR(23)) + 'Loading [usp_InsertNewPeriodFromPublishedToTemporalForAccountLevelSummaryForDollarsBtusAndCo2] ...................'\r\n\tEXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalForAccountLevelSummaryForDollarsBtusAndCo2] @PublishedBillingPeriod\r\n\r\n\tPRINT 'Finished at: ' + CAST(GETDATE() AS VARCHAR(23)) \r\n\r\n\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalAccountLevelSummaryByAgency] @PublishedBillingPeriod\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalAccountLevelSummaryByCityWide] @PublishedBillingPeriod\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalAccountLevelSummaryByFacility] @PublishedBillingPeriod\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalAccountMeterLevelRawDataForCurrentPeriod] @PublishedBillingPeriod\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalEnergyUsageSummaryGroupByAgencyAndEnergyType] @PublishedBillingPeriod\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByAgencyAndFacilityDollarsAndUsage] @PublishedBillingPeriod\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByAgencyDollarsAndUsage] @PublishedBillingPeriod\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByAgencyFacilityAndAccountDollarsAndUsage] @PublishedBillingPeriod\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalFiscalYearPivotByEncoreMonthlyPayments] @PublishedBillingPeriod\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalForAccountLevelRawDataForCurrentPeriod] @PublishedBillingPeriod\r\n\t--EXEC [Temporal].[usp_InsertNewPeriodFromPublishedToTemporalForAccountLevelSummaryForDollarsBtusAndCo2] @PublishedBillingPeriod\r\n\r\n\r\nEND"
        }
      ]
    }
  ]
}