{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "ActualBill",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_ArchiveConEdisonRawDataFile",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Medium",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_ArchiveConEdisonRawDataFile",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to archive raw data from Con Edison into historical tables. It performs this task by inserting data from three source tables ("
        },
        {
          "type": "text",
          "text": "ConEd.UploadConEdisonAccount",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "ConEd.UploadConEdisonMeter",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", and "
        },
        {
          "type": "text",
          "text": "ConEd.UploadConEdisonCancellation",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ") into corresponding historical tables ("
        },
        {
          "type": "text",
          "text": "ActualBill.HistoryUploadLegacyConEdisonRawAccountData",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", "
        },
        {
          "type": "text",
          "text": "ActualBill.HistoryUploadLegacyConEdisonRawMeterData",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": ", and "
        },
        {
          "type": "text",
          "text": "ActualBill.HistoryUploadLegacyConEdisonRawCancellationData",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": "). This procedure is part of a data archival process, ensuring that raw data is preserved for future reference or analysis."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Medium"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level is considered medium due to the following reasons:"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure involves multiple insert operations across different tables."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "It handles a significant number of columns, which requires careful mapping between source and destination tables."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure does not include any conditional logic or error handling, which simplifies its structure but require additional considerations for robustness."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "@Status AS INT OUTPUT",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": This is an output parameter intended to return the status of the procedure execution. However, the current implementation does not set or modify this parameter, which means it does not serve any functional purpose in the current code."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure begins by inserting data from "
                },
                {
                  "type": "text",
                  "text": "ConEd.UploadConEdisonAccount",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " into "
                },
                {
                  "type": "text",
                  "text": "ActualBill.HistoryUploadLegacyConEdisonRawAccountData",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ". It maps each column from the source table to the corresponding column in the destination table."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Next, it inserts data from "
                },
                {
                  "type": "text",
                  "text": "ConEd.UploadConEdisonMeter",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " into "
                },
                {
                  "type": "text",
                  "text": "ActualBill.HistoryUploadLegacyConEdisonRawMeterData",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", again mapping each column appropriately."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Finally, it inserts data from "
                },
                {
                  "type": "text",
                  "text": "ConEd.UploadConEdisonCancellation",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " into "
                },
                {
                  "type": "text",
                  "text": "ActualBill.HistoryUploadLegacyConEdisonRawCancellationData",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure does not include any transaction management, error handling, or logging, which are important for data integrity and troubleshooting."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure performs three separate insert operations, which be resource-intensive if the source tables contain a large volume of data. This impact performance, especially if the procedure is executed frequently or during peak database usage times."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Indexing on the destination tables can improve the performance of the insert operations, but it also slow down the process if the indexes need to be updated frequently."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The absence of transaction management means that if an error occurs during one of the insert operations, the previous successful inserts will not be rolled back, leading to partial data archival."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Lack of Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure does not include any error handling mechanisms. If an error occurs during any of the insert operations, it could lead to incomplete data archival without any notification or rollback."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Output Parameter Usage",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The "
                },
                {
                  "type": "text",
                  "text": "@Status",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " output parameter is not utilized within the procedure, which could lead to confusion or misinterpretation of the procedure's success or failure."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Integrity",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Without transaction management, there is a risk of data inconsistency if the procedure fails partway through execution."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Scalability",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": As data volume grows, the performance of the procedure may degrade, necessitating optimization or restructuring to handle larger datasets efficiently."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Maintenance",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure's lack of logging or status reporting makes it difficult to monitor and maintain, especially in a production environment where tracking the success of archival operations is crucial."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE PROCEDURE [ActualBill].[usp_ArchiveConEdisonRawDataFile]\n(\r\n\t@Status AS INT OUTPUT\r\n)\r\nAS\r\nBEGIN\r\n\tINSERT INTO ActualBill.HistoryUploadLegacyConEdisonRawAccountData\r\n\t\t(UploadConEdisonAccountSeqid, BillingPeriod, BillingPeriodRevision, FirstPeriodCanceled\r\n\t\t,DeltaNumberOfPeriods, RecordType, AccountNumber, FacilityName, ServiceAddress, FromDate, ToDate\r\n\t\t,BillingPeriodDays, CCF, BilledAmount, PreviousBalance, Therms, ThermFactor, TariffCode, Dials\r\n\t\t,FiscalYear, PostingDate, AuthenticatedUserID, DateAdded, LastUpdate)\r\n\tSELECT UploadConEdisonAccountSeqid,BillingPeriod, BillingPeriodRevision, FirstPeriodCanceled\r\n\t\t,DeltaNumberOfPeriods, RecordType, AccountNumber, FacilityName, ServiceAddress, FromDate, ToDate\r\n\t\t,BillingPeriodDays, CCF, BilledAmount, PreviousBalance, Therms, ThermFactor, TariffCode, Dials\r\n\t\t,FiscalYear, PostingDate, AuthenticatedUserID, DateAdded, LastUpdate\r\n\tFROM ConEd.UploadConEdisonAccount;\r\n\r\n\tINSERT INTO ActualBill.HistoryUploadLegacyConEdisonRawMeterData\r\n\t\t(UploadConEdisonMeterSeqid, BillingPeriod, BillingPeriodRevision, FirstPeriodCanceled, DeltaNumberOfPeriods\r\n\t\t,RecordType, AccountNumber, MeterNumber, FromDate, ToDate, FromReading, ToReading, CCF, FacilityName\r\n\t\t,ServiceAddress, ReadingCode, MeterConstant, ThermFactor, CycleBillingDays, Dials, FiscalYear, PostingDate\r\n\t\t,AuthenticatedUserID, DateAdded, LastUpdate)\r\n\tSELECT UploadConEdisonMeterSeqid, BillingPeriod, BillingPeriodRevision, FirstPeriodCanceled, DeltaNumberOfPeriods\r\n\t\t,RecordType, AccountNumber, MeterNumber, FromDate, ToDate, FromReading, ToReading, CCF, FacilityName\r\n\t\t,ServiceAddress, ReadingCode, MeterConstant, ThermFactor, CycleBillingDays, Dials, FiscalYear, PostingDate\r\n\t\t,AuthenticatedUserID, DateAdded, LastUpdate\r\n\tFROM ConEd.UploadConEdisonMeter;\r\n\r\n\tINSERT INTO ActualBill.HistoryUploadLegacyConEdisonRawCancellationData\r\n\t\t(UploadConEdisonCancellationSeqid, BillingPeriod, BillingPeriodRevision, FirstPeriodCanceled\r\n\t\t,DeltaNumberOfPeriods, RecordType, AccountNumber, MeterNumber, FacilityName, ServiceAddress, FromDate, ToDate\r\n\t\t,BillingPeriodDays, CCF, BilledAmount, Therms, ThermFactor, TariffCode, Dials, FiscalYear, PostingDate\r\n\t\t,AuthenticatedUserID, DateAdded, LastUpdate)\r\n\tSELECT UploadConEdisonCancellationSeqid, BillingPeriod, BillingPeriodRevision, FirstPeriodCanceled\r\n\t\t,DeltaNumberOfPeriods, RecordType, AccountNumber, MeterNumber, FacilityName, ServiceAddress, FromDate, ToDate\r\n\t\t,BillingPeriodDays, CCF, BilledAmount, Therms, ThermFactor, TariffCode, Dials, FiscalYear, PostingDate\r\n\t\t,AuthenticatedUserID, DateAdded, LastUpdate\r\n\tFROM ConEd.UploadConEdisonCancellation;\r\nEND;"
        }
      ]
    }
  ]
}