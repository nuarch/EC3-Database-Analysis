{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "NationalGridWest",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "usp_CreateNationalGridWestCrisLinkedServer",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Low",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "usp_CreateNationalGridWestCrisLinkedServer",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to create linked servers in a Microsoft SQL Server environment. Specifically, it sets up connections to external data sources, which in this case are Excel files and text files located on a network share. The procedure uses the "
        },
        {
          "type": "text",
          "text": "sp_addlinkedserver",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " system stored procedure to establish these connections, allowing SQL Server to query data from these external sources as if they were part of the local database."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Low"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The procedure is straightforward, primarily involving the execution of system stored procedures to create linked servers. It does not involve complex logic, conditional statements, or loops, which keeps the complexity low."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "This stored procedure does not take any input parameters. All necessary values for creating the linked servers are hardcoded within the procedure itself."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Declaration of Variables",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure begins by declaring several variables to hold the parameters required for creating linked servers."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Setting Parameter Values",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": It sets specific values for these variables, such as the server name, provider, and data source path."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Creating Linked Servers",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ":"
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The first linked server, "
                },
                {
                  "type": "text",
                  "text": "NationalGridWestCrisSummaryBill",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", is created to connect to an Excel file using the "
                },
                {
                  "type": "text",
                  "text": "Microsoft.Jet.OLEDB.4.0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " provider."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The second linked server, "
                },
                {
                  "type": "text",
                  "text": "NationalGridWestCrisAccountBilling",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", is created to connect to a directory containing text files, also using the "
                },
                {
                  "type": "text",
                  "text": "Microsoft.Jet.OLEDB.4.0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " provider."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "There are commented-out sections indicating potential additional linked servers for "
                },
                {
                  "type": "text",
                  "text": "AccountTranslation",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " and "
                },
                {
                  "type": "text",
                  "text": "MeterBilling",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ", suggesting these be added or removed as needed."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Network Dependency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The performance of queries against these linked servers will depend on network speed and reliability, as the data sources are located on a network share."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Provider Limitations",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The use of "
                },
                {
                  "type": "text",
                  "text": "Microsoft.Jet.OLEDB.4.0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " impose limitations on performance and scalability, especially with large datasets or high concurrency."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Resource Usage",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Creating and querying linked servers can consume significant resources, impacting the performance of the SQL Server instance if not managed properly."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Security Risks",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Accessing files over a network share can pose security risks, especially if the share is not properly secured. Ensure that only authorized users have access to the network path."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Provider Deprecation",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The "
                },
                {
                  "type": "text",
                  "text": "Microsoft.Jet.OLEDB.4.0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " provider is deprecated and not supported on 64-bit SQL Server environments. Consider using a more modern provider like "
                },
                {
                  "type": "text",
                  "text": "Microsoft.ACE.OLEDB.12.0",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Hardcoded Paths",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The use of hardcoded paths and server names reduces flexibility and can lead to maintenance challenges if the file locations change."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Error Handling",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The procedure lacks error handling, which means any issues during the execution of "
                },
                {
                  "type": "text",
                  "text": "sp_addlinkedserver",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " will not be captured or logged, potentially leading to silent failures."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Concurrency and Locking",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": If multiple processes attempt to access the same linked server simultaneously, it could lead to locking or concurrency issues, especially with file-based data sources."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "-- =============================================\n-- Author:\t\t<Author,,Name>\r\n-- Create date: <Create Date,,>\r\n-- Description:\t<Description,,>\r\n-- =============================================\r\nCREATE PROCEDURE [NationalGridWest].[usp_CreateNationalGridWestCrisLinkedServer]\r\nAS\r\nBEGIN\r\n\tDECLARE @RC int\r\n\tDECLARE @server nvarchar(128)\r\n\tDECLARE @srvproduct nvarchar(128)\r\n\tDECLARE @provider nvarchar(128)\r\n\tDECLARE @datasrc nvarchar(4000)\r\n\tDECLARE @location nvarchar(4000)\r\n\tDECLARE @provstr nvarchar(4000)\r\n\tDECLARE @catalog nvarchar(128)\r\n\t-- Set parameter values\r\n\tSET @server = 'NationalGridWestCrisSummaryBill'\r\n\tSET @srvproduct = 'Excel'\r\n\tSET @provider = 'Microsoft.Jet.OLEDB.4.0'\r\n\tSET @datasrc = '\\\\dcasec3\\UploadDataFiles\\KeyspanWestMainframeData\\KeyspanWestCurrentBillingCycle\\CRISS\\SummaryBill\\SummaryBill.xls'\r\n\tSET @provstr = 'Excel 8.0'\r\n\tEXEC @RC = [master].[dbo].[sp_addlinkedserver] @server, @srvproduct, @provider, \r\n\t@datasrc, @location, @provstr, @catalog\r\n\t--\r\n\tEXEC sp_addlinkedserver NationalGridWestCrisAccountBilling, 'Jet 4.0','Microsoft.Jet.OLEDB.4.0', '\\\\dcasec3\\UploadDataFiles\\KeyspanWestMainframeData\\KeyspanWestCurrentBillingCycle\\CRISS\\AccountBilling', NULL, 'Text' \r\n\t\r\n\t--EXEC sp_addlinkedserver NationalGridWestCrisAccountTranslation, 'Jet 4.0','Microsoft.Jet.OLEDB.4.0', '\\\\dcasec3\\UploadDataFiles\\KeyspanWestMainframeData\\KeyspanWestCurrentBillingCycle\\CRISS\\AccountTranslation', NULL, 'Text' \r\n--\t--\r\n--\tSET @server = 'NationalGridWestCrisAccountBilling'\r\n--\tSET @srvproduct = 'Text'\r\n--\tSET @provider = 'Microsoft.Jet.OLEDB.4.0'\r\n--\tSET @datasrc = '\\\\dcasec3\\UploadDataFiles\\KeyspanWestMainframeData\\KeyspanWestCurrentBillingCycle\\CRISS\\AccountBilling'\r\n--\tSET @provstr = 'Text'\r\n--\tEXEC @RC = [master].[dbo].[sp_addlinkedserver] @server, @srvproduct, @provider, \r\n--\t@datasrc, @location, @provstr, @catalog\r\n--\t--\r\n\t/*SET @server = 'NationalGridWestCrisMeterBilling'\r\n\tSET @srvproduct = 'Text'\r\n\tSET @provider = 'Microsoft.Jet.OLEDB.4.0'\r\n\tSET @datasrc = '\\\\dcasec3\\UploadDataFiles\\KeyspanWestMainframeData\\KeyspanWestCurrentBillingCycle\\CRISS\\MeterBilling\\CRISMeterBilling.TXT'\r\n\tSET @provstr = 'Text'\r\n\tEXEC @RC = [master].[dbo].[sp_addlinkedserver] @server, @srvproduct, @provider, \r\n\t@datasrc, @location, @provstr, @catalog\r\n\t*/\r\nEND"
        }
      ]
    }
  ]
}