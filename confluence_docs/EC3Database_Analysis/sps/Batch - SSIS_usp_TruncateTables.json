{
  "version": 1,
  "type": "doc",
  "content": [
    {
      "type": "bodiedExtension",
      "attrs": {
        "extensionType": "com.atlassian.confluence.macro.core",
        "extensionKey": "details",
        "parameters": {
          "macroParams": {
            "hidden": {
              "value": "true"
            }
          },
          "macroMetadata": {
            "schemaVersion": {
              "value": "1"
            },
            "title": "Page Properties"
          }
        }
      },
      "content": [
        {
          "type": "table",
          "attrs": {
            "isNumberColumnEnabled": false,
            "layout": "default"
          },
          "content": [
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Schema Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Batch",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Stored Procedure Name",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "SSIS_usp_TruncateTables",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "tableRow",
              "content": [
                {
                  "type": "tableHeader",
                  "attrs": {
                    "colspan": 1,
                    "background": "#f4f5f7",
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Complexity Level",
                          "type": "text",
                          "marks": [
                            {
                              "type": "strong"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "tableCell",
                  "attrs": {
                    "colspan": 1,
                    "rowspan": 1
                  },
                  "content": [
                    {
                      "type": "paragraph",
                      "content": [
                        {
                          "text": "Low",
                          "type": "text"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "1. Overview"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The stored procedure "
        },
        {
          "type": "text",
          "text": "SSIS_usp_TruncateTables",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " is designed to truncate a series of tables within the "
        },
        {
          "type": "text",
          "text": "Nypa",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " schema in a Microsoft SQL Server database. Truncating a table removes all rows from the table, effectively resetting it to an empty state, while maintaining the table structure and any associated indexes or constraints. This procedure is used as part of a data loading or ETL (Extract, Transform, Load) process, where existing data needs to be cleared before new data is loaded."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "2. Complexity Level: Low"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "The complexity level of this stored procedure is low. It consists solely of a series of "
        },
        {
          "type": "text",
          "text": "TRUNCATE TABLE",
          "marks": [
            {
              "type": "code"
            }
          ]
        },
        {
          "type": "text",
          "text": " statements, which are straightforward and do not involve any conditional logic, loops, or complex operations."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "3. Input Parameters"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "This stored procedure does not have any input parameters. It operates on a predefined set of tables, and its behavior is fixed, meaning it will always truncate the same tables each time it is executed."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "4. Business Logic and Workflow"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The procedure begins execution and sequentially truncates a list of tables within the "
                },
                {
                  "type": "text",
                  "text": "Nypa",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " schema."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The tables are divided into two groups: those with a \"Preload\" suffix and those without. This shows a possible staging or temporary data storage strategy, where \"Preload\" tables be used for initial data loading before processing or transferring data to the final destination tables."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "The workflow is linear and consists of executing each "
                },
                {
                  "type": "text",
                  "text": "TRUNCATE TABLE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " statement in the order they are written."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "5. Performance Considerations"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Efficiency",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": "
                },
                {
                  "type": "text",
                  "text": "TRUNCATE TABLE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " is more efficient than "
                },
                {
                  "type": "text",
                  "text": "DELETE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " without a "
                },
                {
                  "type": "text",
                  "text": "WHERE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " clause because it deallocates the data pages used by the table, rather than logging individual row deletions. This can result in faster execution and reduced transaction log usage."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Locking and Blocking",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": "
                },
                {
                  "type": "text",
                  "text": "TRUNCATE TABLE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " requires a schema modification (SCH-M) lock, which can block other operations on the table until the truncate operation is complete. This should be considered in environments with high concurrency."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Minimal Logging",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The operation is minimally logged, which is beneficial for performance but means that it cannot be rolled back in the same way as fully logged operations."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "6. Potential Issues or Risks"
        }
      ]
    },
    {
      "type": "bulletList",
      "content": [
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Data Loss",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Since "
                },
                {
                  "type": "text",
                  "text": "TRUNCATE TABLE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " removes all data without the possibility of recovery through standard transaction log backups, there is a risk of data loss if the procedure is executed unintentionally or at the wrong time."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Foreign Key Constraints",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": "
                },
                {
                  "type": "text",
                  "text": "TRUNCATE TABLE",
                  "marks": [
                    {
                      "type": "code"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": " cannot be used on tables that are referenced by a foreign key constraint. If any of the tables have such constraints, the procedure will fail unless those constraints are temporarily disabled or removed."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "Permissions",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": The user executing this procedure must have the necessary permissions to truncate tables, which typically requires ALTER permissions on the table."
                }
              ]
            }
          ]
        },
        {
          "type": "listItem",
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "text": "No Rollback",
                  "marks": [
                    {
                      "type": "strong"
                    }
                  ]
                },
                {
                  "type": "text",
                  "text": ": Once executed, the operation cannot be rolled back if the database is in simple recovery mode, which could be a risk if the procedure is run accidentally."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "text": "Overall, while the procedure is simple and efficient for its intended purpose, careful consideration should be given to its execution context to avoid unintended data loss or operational disruptions."
        }
      ]
    },
    {
      "type": "heading",
      "attrs": {
        "level": 1
      },
      "content": [
        {
          "type": "text",
          "text": "7. Stored Procedure Definition"
        }
      ]
    },
    {
      "type": "codeBlock",
      "attrs": {
        "language": "sql"
      },
      "content": [
        {
          "type": "text",
          "text": "CREATE   PROCEDURE [Batch].[SSIS_usp_TruncateTables]\nAS\r\nBEGIN\r\n\r\n\tTruncate table Nypa.UploadNypaPage3CutomerLevelAllocationPreload;\r\n\tTruncate table Nypa.UploadNYPAEncoreMonthlyBillingPreload;\r\n\tTruncate table Nypa.UploadNYPACoverSheetPreload;\r\n\tTruncate table Nypa.UploadNYPAExchangeDataPreload;\r\n\tTruncate table Nypa.UploadNYPAAccountBillingPreload;\r\n\tTruncate table Nypa.UploadNYPAMeterBillingPreload;\r\n\tTruncate table Nypa.UploadNYPAKvarAccountMeterDetailPreload;\r\n\tTruncate table Nypa.UploadNypaAllActiveAccountsPreload;\r\n\tTruncate table Nypa.UploadNypaIntervalMeterDataPreload;\r\n\r\n\tTRUNCATE TABLE Nypa.UploadNYPAEncoreMonthlyBilling;\r\n\tTRUNCATE TABLE Nypa.UploadNYPACoverSheet;\r\n\tTRUNCATE TABLE Nypa.UploadNYPAExchangeData;\r\n\tTRUNCATE TABLE Nypa.UploadNYPAAccountBilling;\r\n\tTRUNCATE TABLE Nypa.UploadNYPAMeterBilling;\r\n\tTRUNCATE TABLE Nypa.UploadNypaAllActiveAccounts;\r\n\tTRUNCATE TABLE Nypa.UploadNYPAKvarAccountMeterDetail;\r\n\tTRUNCATE TABLE Nypa.UploadNypaPage3CutomerLevelAllocation;\r\n\tTRUNCATE TABLE Nypa.UploadNypaIntervalMeterData;\r\n\r\nEND"
        }
      ]
    }
  ]
}